import{E as Ha}from"./engine-23af3b94.js";/*!
 * melonJS Game Engine - v14.4.0
 * http://www.melonjs.org
 * melonjs is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * @copyright (C) 2011 - 2023 Olivier Biot (AltByte Pte Ltd)
 */var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ee=function(s){return s&&s.Math==Math&&s},at=Ee(typeof globalThis=="object"&&globalThis)||Ee(typeof window=="object"&&window)||Ee(typeof self=="object"&&self)||Ee(typeof V=="object"&&V)||function(){return this}()||Function("return this")(),Tr={},mt=function(s){try{return!!s()}catch{return!0}},Xa=mt,Ut=!Xa(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),$a=mt,pn=!$a(function(){var s=function(){}.bind();return typeof s!="function"||s.hasOwnProperty("prototype")}),Ya=pn,Ce=Function.prototype.call,Ar=Ya?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},gn={},vn={}.propertyIsEnumerable,yn=Object.getOwnPropertyDescriptor,ja=yn&&!vn.call({1:2},1);gn.f=ja?function(t){var e=yn(this,t);return!!e&&e.enumerable}:vn;var mn=function(s,t){return{enumerable:!(s&1),configurable:!(s&2),writable:!(s&4),value:t}},_n=pn,xn=Function.prototype,Gi=xn.call,Wa=_n&&xn.bind.bind(Gi,Gi),ut=_n?Wa:function(s){return function(){return Gi.apply(s,arguments)}},wn=ut,qa=wn({}.toString),Ka=wn("".slice),bn=function(s){return Ka(qa(s),8,-1)},Za=ut,Qa=mt,Ja=bn,yi=Object,to=Za("".split),eo=Qa(function(){return!yi("z").propertyIsEnumerable(0)})?function(s){return Ja(s)=="String"?to(s,""):yi(s)}:yi,Tn=function(s){return s==null},io=Tn,ro=TypeError,Sr=function(s){if(io(s))throw ro("Can't call method on "+s);return s},so=eo,no=Sr,Er=function(s){return so(no(s))},Hi=typeof document=="object"&&document.all,ao=typeof Hi>"u"&&Hi!==void 0,An={all:Hi,IS_HTMLDDA:ao},Sn=An,oo=Sn.all,ot=Sn.IS_HTMLDDA?function(s){return typeof s=="function"||s===oo}:function(s){return typeof s=="function"},$r=ot,En=An,ho=En.all,we=En.IS_HTMLDDA?function(s){return typeof s=="object"?s!==null:$r(s)||s===ho}:function(s){return typeof s=="object"?s!==null:$r(s)},mi=at,lo=ot,uo=function(s){return lo(s)?s:void 0},Cr=function(s,t){return arguments.length<2?uo(mi[s]):mi[s]&&mi[s][t]},fo=ut,co=fo({}.isPrototypeOf),po=Cr,go=po("navigator","userAgent")||"",Cn=at,_i=go,Yr=Cn.process,jr=Cn.Deno,Wr=Yr&&Yr.versions||jr&&jr.version,qr=Wr&&Wr.v8,rt,Ue;qr&&(rt=qr.split("."),Ue=rt[0]>0&&rt[0]<4?1:+(rt[0]+rt[1]));!Ue&&_i&&(rt=_i.match(/Edge\/(\d+)/),(!rt||rt[1]>=74)&&(rt=_i.match(/Chrome\/(\d+)/),rt&&(Ue=+rt[1])));var vo=Ue,Kr=vo,yo=mt,Mn=!!Object.getOwnPropertySymbols&&!yo(function(){var s=Symbol();return!String(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&Kr&&Kr<41}),mo=Mn,Pn=mo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",_o=Cr,xo=ot,wo=co,bo=Pn,To=Object,In=bo?function(s){return typeof s=="symbol"}:function(s){var t=_o("Symbol");return xo(t)&&wo(t.prototype,To(s))},Ao=String,So=function(s){try{return Ao(s)}catch{return"Object"}},Eo=ot,Co=So,Mo=TypeError,Po=function(s){if(Eo(s))return s;throw Mo(Co(s)+" is not a function")},Io=Po,Ro=Tn,Oo=function(s,t){var e=s[t];return Ro(e)?void 0:Io(e)},xi=Ar,wi=ot,bi=we,Bo=TypeError,Lo=function(s,t){var e,i;if(t==="string"&&wi(e=s.toString)&&!bi(i=xi(e,s))||wi(e=s.valueOf)&&!bi(i=xi(e,s))||t!=="string"&&wi(e=s.toString)&&!bi(i=xi(e,s)))return i;throw Bo("Can't convert object to primitive value")},Ge={},Do={get exports(){return Ge},set exports(s){Ge=s}},Zr=at,Fo=Object.defineProperty,Mr=function(s,t){try{Fo(Zr,s,{value:t,configurable:!0,writable:!0})}catch{Zr[s]=t}return t},ko=at,zo=Mr,Qr="__core-js_shared__",Vo=ko[Qr]||zo(Qr,{}),Pr=Vo,Jr=Pr;(Do.exports=function(s,t){return Jr[s]||(Jr[s]=t!==void 0?t:{})})("versions",[]).push({version:"3.27.1",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.1/LICENSE",source:"https://github.com/zloirock/core-js"});var No=Sr,Uo=Object,Go=function(s){return Uo(No(s))},Ho=ut,Xo=Go,$o=Ho({}.hasOwnProperty),Gt=Object.hasOwn||function(t,e){return $o(Xo(t),e)},Yo=ut,jo=0,Wo=Math.random(),qo=Yo(1 .toString),Rn=function(s){return"Symbol("+(s===void 0?"":s)+")_"+qo(++jo+Wo,36)},Ko=at,Zo=Ge,ts=Gt,Qo=Rn,es=Mn,On=Pn,Ht=Zo("wks"),Bt=Ko.Symbol,is=Bt&&Bt.for,Jo=On?Bt:Bt&&Bt.withoutSetter||Qo,Ir=function(s){if(!ts(Ht,s)||!(es||typeof Ht[s]=="string")){var t="Symbol."+s;es&&ts(Bt,s)?Ht[s]=Bt[s]:On&&is?Ht[s]=is(t):Ht[s]=Jo(t)}return Ht[s]},th=Ar,rs=we,ss=In,eh=Oo,ih=Lo,rh=Ir,sh=TypeError,nh=rh("toPrimitive"),ah=function(s,t){if(!rs(s)||ss(s))return s;var e=eh(s,nh),i;if(e){if(t===void 0&&(t="default"),i=th(e,s,t),!rs(i)||ss(i))return i;throw sh("Can't convert object to primitive value")}return t===void 0&&(t="number"),ih(s,t)},oh=ah,hh=In,Bn=function(s){var t=oh(s,"string");return hh(t)?t:t+""},lh=at,ns=we,Xi=lh.document,uh=ns(Xi)&&ns(Xi.createElement),fh=function(s){return uh?Xi.createElement(s):{}},dh=Ut,ch=mt,ph=fh,Ln=!dh&&!ch(function(){return Object.defineProperty(ph("div"),"a",{get:function(){return 7}}).a!=7}),gh=Ut,vh=Ar,yh=gn,mh=mn,_h=Er,xh=Bn,wh=Gt,bh=Ln,as=Object.getOwnPropertyDescriptor;Tr.f=gh?as:function(t,e){if(t=_h(t),e=xh(e),bh)try{return as(t,e)}catch{}if(wh(t,e))return mh(!vh(yh.f,t,e),t[e])};var Je={},Th=Ut,Ah=mt,Sh=Th&&Ah(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Eh=we,Ch=String,Mh=TypeError,Dn=function(s){if(Eh(s))return s;throw Mh(Ch(s)+" is not an object")},Ph=Ut,Ih=Ln,Rh=Sh,Me=Dn,os=Bn,Oh=TypeError,Ti=Object.defineProperty,Bh=Object.getOwnPropertyDescriptor,Ai="enumerable",Si="configurable",Ei="writable";Je.f=Ph?Rh?function(t,e,i){if(Me(t),e=os(e),Me(i),typeof t=="function"&&e==="prototype"&&"value"in i&&Ei in i&&!i[Ei]){var r=Bh(t,e);r&&r[Ei]&&(t[e]=i.value,i={configurable:Si in i?i[Si]:r[Si],enumerable:Ai in i?i[Ai]:r[Ai],writable:!1})}return Ti(t,e,i)}:Ti:function(t,e,i){if(Me(t),e=os(e),Me(i),Ih)try{return Ti(t,e,i)}catch{}if("get"in i||"set"in i)throw Oh("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var Lh=Ut,Dh=Je,Fh=mn,Fn=Lh?function(s,t,e){return Dh.f(s,t,Fh(1,e))}:function(s,t,e){return s[t]=e,s},$i={},kh={get exports(){return $i},set exports(s){$i=s}},Yi=Ut,zh=Gt,kn=Function.prototype,Vh=Yi&&Object.getOwnPropertyDescriptor,Rr=zh(kn,"name"),Nh=Rr&&function(){}.name==="something",Uh=Rr&&(!Yi||Yi&&Vh(kn,"name").configurable),zn={EXISTS:Rr,PROPER:Nh,CONFIGURABLE:Uh},Gh=ut,Hh=ot,ji=Pr,Xh=Gh(Function.toString);Hh(ji.inspectSource)||(ji.inspectSource=function(s){return Xh(s)});var $h=ji.inspectSource,Yh=at,jh=ot,hs=Yh.WeakMap,Wh=jh(hs)&&/native code/.test(String(hs)),qh=Ge,Kh=Rn,ls=qh("keys"),Zh=function(s){return ls[s]||(ls[s]=Kh(s))},Vn={},Qh=Wh,Nn=at,Jh=we,tl=Fn,Ci=Gt,Mi=Pr,el=Zh,il=Vn,us="Object already initialized",Wi=Nn.TypeError,rl=Nn.WeakMap,He,ue,Xe,sl=function(s){return Xe(s)?ue(s):He(s,{})},nl=function(s){return function(t){var e;if(!Jh(t)||(e=ue(t)).type!==s)throw Wi("Incompatible receiver, "+s+" required");return e}};if(Qh||Mi.state){var ht=Mi.state||(Mi.state=new rl);ht.get=ht.get,ht.has=ht.has,ht.set=ht.set,He=function(s,t){if(ht.has(s))throw Wi(us);return t.facade=s,ht.set(s,t),t},ue=function(s){return ht.get(s)||{}},Xe=function(s){return ht.has(s)}}else{var Xt=el("state");il[Xt]=!0,He=function(s,t){if(Ci(s,Xt))throw Wi(us);return t.facade=s,tl(s,Xt,t),t},ue=function(s){return Ci(s,Xt)?s[Xt]:{}},Xe=function(s){return Ci(s,Xt)}}var al={set:He,get:ue,has:Xe,enforce:sl,getterFor:nl},ol=mt,hl=ot,Pe=Gt,qi=Ut,ll=zn.CONFIGURABLE,ul=$h,Un=al,fl=Un.enforce,dl=Un.get,ke=Object.defineProperty,cl=qi&&!ol(function(){return ke(function(){},"length",{value:8}).length!==8}),pl=String(String).split("String"),gl=kh.exports=function(s,t,e){String(t).slice(0,7)==="Symbol("&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!Pe(s,"name")||ll&&s.name!==t)&&(qi?ke(s,"name",{value:t,configurable:!0}):s.name=t),cl&&e&&Pe(e,"arity")&&s.length!==e.arity&&ke(s,"length",{value:e.arity});try{e&&Pe(e,"constructor")&&e.constructor?qi&&ke(s,"prototype",{writable:!1}):s.prototype&&(s.prototype=void 0)}catch{}var i=fl(s);return Pe(i,"source")||(i.source=pl.join(typeof t=="string"?t:"")),s};Function.prototype.toString=gl(function(){return hl(this)&&dl(this).source||ul(this)},"toString");var vl=ot,yl=Je,ml=$i,_l=Mr,xl=function(s,t,e,i){i||(i={});var r=i.enumerable,n=i.name!==void 0?i.name:t;if(vl(e)&&ml(e,n,i),i.global)r?s[t]=e:_l(t,e);else{try{i.unsafe?s[t]&&(r=!0):delete s[t]}catch{}r?s[t]=e:yl.f(s,t,{value:e,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return s},Gn={},wl=Math.ceil,bl=Math.floor,Tl=Math.trunc||function(t){var e=+t;return(e>0?bl:wl)(e)},Al=Tl,Hn=function(s){var t=+s;return t!==t||t===0?0:Al(t)},Sl=Hn,El=Math.max,Cl=Math.min,Ml=function(s,t){var e=Sl(s);return e<0?El(e+t,0):Cl(e,t)},Pl=Hn,Il=Math.min,Rl=function(s){return s>0?Il(Pl(s),9007199254740991):0},Ol=Rl,Bl=function(s){return Ol(s.length)},Ll=Er,Dl=Ml,Fl=Bl,fs=function(s){return function(t,e,i){var r=Ll(t),n=Fl(r),o=Dl(i,n),h;if(s&&e!=e){for(;n>o;)if(h=r[o++],h!=h)return!0}else for(;n>o;o++)if((s||o in r)&&r[o]===e)return s||o||0;return!s&&-1}},kl={includes:fs(!0),indexOf:fs(!1)},zl=ut,Pi=Gt,Vl=Er,Nl=kl.indexOf,Ul=Vn,ds=zl([].push),Gl=function(s,t){var e=Vl(s),i=0,r=[],n;for(n in e)!Pi(Ul,n)&&Pi(e,n)&&ds(r,n);for(;t.length>i;)Pi(e,n=t[i++])&&(~Nl(r,n)||ds(r,n));return r},Hl=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xl=Gl,$l=Hl,Yl=$l.concat("length","prototype");Gn.f=Object.getOwnPropertyNames||function(t){return Xl(t,Yl)};var Xn={};Xn.f=Object.getOwnPropertySymbols;var jl=Cr,Wl=ut,ql=Gn,Kl=Xn,Zl=Dn,Ql=Wl([].concat),Jl=jl("Reflect","ownKeys")||function(t){var e=ql.f(Zl(t)),i=Kl.f;return i?Ql(e,i(t)):e},cs=Gt,tu=Jl,eu=Tr,iu=Je,ru=function(s,t,e){for(var i=tu(t),r=iu.f,n=eu.f,o=0;o<i.length;o++){var h=i[o];!cs(s,h)&&!(e&&cs(e,h))&&r(s,h,n(t,h))}},su=mt,nu=ot,au=/#|\.prototype\./,be=function(s,t){var e=hu[ou(s)];return e==uu?!0:e==lu?!1:nu(t)?su(t):!!t},ou=be.normalize=function(s){return String(s).replace(au,".").toLowerCase()},hu=be.data={},lu=be.NATIVE="N",uu=be.POLYFILL="P",fu=be,Ii=at,du=Tr.f,cu=Fn,pu=xl,gu=Mr,vu=ru,yu=fu,Te=function(s,t){var e=s.target,i=s.global,r=s.stat,n,o,h,u,f,c;if(i?o=Ii:r?o=Ii[e]||gu(e,{}):o=(Ii[e]||{}).prototype,o)for(h in t){if(f=t[h],s.dontCallGetSet?(c=du(o,h),u=c&&c.value):u=o[h],n=yu(i?h:e+(r?".":"#")+h,s.forced),!n&&u!==void 0){if(typeof f==typeof u)continue;vu(f,u)}(s.sham||u&&u.sham)&&cu(f,"sham",!0),pu(o,h,f,s)}},mu=Te,Ri=at;mu({global:!0,forced:Ri.globalThis!==Ri},{globalThis:Ri});var _u=Ir,xu=_u("toStringTag"),$n={};$n[xu]="z";var wu=String($n)==="[object z]",bu=wu,Tu=ot,ze=bn,Au=Ir,Su=Au("toStringTag"),Eu=Object,Cu=ze(function(){return arguments}())=="Arguments",Mu=function(s,t){try{return s[t]}catch{}},Pu=bu?ze:function(s){var t,e,i;return s===void 0?"Undefined":s===null?"Null":typeof(e=Mu(t=Eu(s),Su))=="string"?e:Cu?ze(t):(i=ze(t))=="Object"&&Tu(t.callee)?"Arguments":i},Iu=Pu,Ru=String,Ou=function(s){if(Iu(s)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Ru(s)},Yn=`	
\v\f\r                　\u2028\u2029\uFEFF`,Bu=ut,Lu=Sr,Du=Ou,Fu=Yn,ps=Bu("".replace),$e="["+Fu+"]",ku=RegExp("^"+$e+$e+"*"),zu=RegExp($e+$e+"*$"),Oi=function(s){return function(t){var e=Du(Lu(t));return s&1&&(e=ps(e,ku,"")),s&2&&(e=ps(e,zu,"")),e}},jn={start:Oi(1),end:Oi(2),trim:Oi(3)},Vu=zn.PROPER,Nu=mt,gs=Yn,vs="​᠎",Wn=function(s){return Nu(function(){return!!gs[s]()||vs[s]()!==vs||Vu&&gs[s].name!==s})},Uu=jn.start,Gu=Wn,qn=Gu("trimStart")?function(){return Uu(this)}:"".trimStart,Hu=Te,ys=qn;Hu({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==ys},{trimLeft:ys});var Xu=Te,ms=qn;Xu({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==ms},{trimStart:ms});var $u=at,Yu=ut,Kn=function(s,t){return Yu($u[s].prototype[t])},ju=Kn;ju("String","trimLeft");var Wu=jn.end,qu=Wn,Zn=qu("trimEnd")?function(){return Wu(this)}:"".trimEnd,Ku=Te,_s=Zn;Ku({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==_s},{trimRight:_s});var Zu=Te,xs=Zn;Zu({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==xs},{trimEnd:xs});var Qu=Kn;Qu("String","trimRight");typeof globalThis<"u"&&typeof globalThis.console>"u"&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});"performance"in globalThis||(globalThis.performance={});Date.now=Date.now||function(){return new Date().getTime()};if(!("now"in globalThis.performance)){let s=Date.now();performance.timing&&performance.timing.navigationStart&&(s=performance.timing.navigationStart),globalThis.performance.now=function(){return Date.now()-s}}function Or(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Br(s){return typeof s=="string"&&(s=s.trim()),!isNaN(s)&&/[+-]?([0-9]*[.])?[0-9]+/.test(s)}function Qn(s){var t=s.trim();return t==="true"||t==="false"}function Jn(s){for(var t="",e=0;e<s.length;)t+=s.charCodeAt(e++).toString(16);return t}function Lr(s){return/^data:(.+);base64,(.+)$/.test(s)}var Ju=Object.freeze({__proto__:null,capitalize:Or,isBoolean:Qn,isDataUrl:Lr,isNumeric:Br,toHex:Jn});const ta=["ms","MS","moz","webkit","o"];function fe(s,t){if(t=t||globalThis,s in t)return t[s];var e=Or(s),i;return ta.some(r=>{var n=r+e;return i=n in t?t[n]:void 0}),i}function Dr(s,t,e){if(e=e||globalThis,s in e){e[s]=t;return}var i=Or(s);return ta.some(r=>{var n=r+i;if(n in e)return e[n]=t,!0}),!1}var tf=Object.freeze({__proto__:null,prefixed:fe,setPrefixed:Dr});const ef=Math.PI/180,k=Math.PI*2,rf=Math.PI*.5,sf=1e-6;function bt(s){return(s&s-1)===0}function Ye(s){return s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,s++,s}function ea(s){return s*ef}function A(s,t,e){return s<t?t:s>e?e:+s}function Ve(s,t){return~~(Math.random()*(t-s))+s}function $t(s,t){return Math.random()*(t-s)+s}function nf(s,t){return~~(Math.pow(Math.random(),2)*(t-s))+s}function ws(s,t,e=2){return Math.abs(s-t)<Math.pow(10,-e)/2}function de(s,t){var e=Array.prototype.indexOf.call(s,t);return e!==-1&&Array.prototype.splice.call(s,e,1),s}function af(s){return s[Ve(0,s.length)]}function of(s){return s[nf(0,s.length)]}var hf=Object.freeze({__proto__:null,random:af,remove:de,weightedRandom:of});const lf=/^.*(\\|\/|\:)/,uf=/\.[^\.]*$/;function ti(s){return s.replace(lf,"").replace(uf,"")}function Fr(s){return s.substring(s.lastIndexOf(".")+1,s.length)}var ff=Object.freeze({__proto__:null,getBasename:ti,getExtension:Fr});function Ki(s,t,...e){return setTimeout(s.bind(t),.01,...e)}function df(s,t,e){var i=globalThis.performance.now(),r;return typeof e!="boolean"&&(e=!1),function(){var n=globalThis.performance.now(),o=n-i,h=arguments;if(o<t)e===!1&&(clearTimeout(r),r=setTimeout(()=>(i=n,s.apply(null,h)),o));else return i=n,s.apply(null,h)}}var cf=Object.freeze({__proto__:null,defer:Ki,throttle:df}),bs="",Bi=0,q={agent:tf,array:hf,file:ff,string:Ju,function:cf,checkVersion:function(s,t){for(var e=s.split("."),i=t.split("."),r=Math.min(e.length,i.length),n=0,o=0;o<r&&!(n=+e[o]-+i[o]);o++);return n||e.length-i.length},getUriFragment:function(s){var t={};if(typeof s>"u")if(typeof globalThis.document<"u"){var e=globalThis.document.location;if(e&&e.hash)s=e.hash;else return t}else return t;else{var i=s.indexOf("#");if(i!==-1)s=s.slice(i,s.length);else return t}return s.slice(1).split("&").filter(r=>r!=="").forEach(r=>{var n=r.split("="),o=n.shift(),h=n.join("=");t[o]=h||!0}),t},resetGUID:function(s,t=0){bs=Jn(s.toString().toUpperCase()),Bi=t},createGUID:function(s=1){return Bi+=s,bs+"-"+(s||Bi)}},Zi={},pf={get exports(){return Zi},set exports(s){Zi=s}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(u,f,c){this.fn=u,this.context=f,this.once=c||!1}function n(u,f,c,a,l){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new r(c,a||u,l),p=e?e+f:f;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],d]:u._events[p].push(d):(u._events[p]=d,u._eventsCount++),u}function o(u,f){--u._eventsCount===0?u._events=new i:delete u._events[f]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],c,a;if(this._eventsCount===0)return f;for(a in c=this._events)t.call(c,a)&&f.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(c)):f},h.prototype.listeners=function(f){var c=e?e+f:f,a=this._events[c];if(!a)return[];if(a.fn)return[a.fn];for(var l=0,d=a.length,p=new Array(d);l<d;l++)p[l]=a[l].fn;return p},h.prototype.listenerCount=function(f){var c=e?e+f:f,a=this._events[c];return a?a.fn?1:a.length:0},h.prototype.emit=function(f,c,a,l,d,p){var y=e?e+f:f;if(!this._events[y])return!1;var m=this._events[y],v=arguments.length,_,x;if(m.fn){switch(m.once&&this.removeListener(f,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,a),!0;case 4:return m.fn.call(m.context,c,a,l),!0;case 5:return m.fn.call(m.context,c,a,l,d),!0;case 6:return m.fn.call(m.context,c,a,l,d,p),!0}for(x=1,_=new Array(v-1);x<v;x++)_[x-1]=arguments[x];m.fn.apply(m.context,_)}else{var w=m.length,b;for(x=0;x<w;x++)switch(m[x].once&&this.removeListener(f,m[x].fn,void 0,!0),v){case 1:m[x].fn.call(m[x].context);break;case 2:m[x].fn.call(m[x].context,c);break;case 3:m[x].fn.call(m[x].context,c,a);break;case 4:m[x].fn.call(m[x].context,c,a,l);break;default:if(!_)for(b=1,_=new Array(v-1);b<v;b++)_[b-1]=arguments[b];m[x].fn.apply(m[x].context,_)}}return!0},h.prototype.on=function(f,c,a){return n(this,f,c,a,!1)},h.prototype.once=function(f,c,a){return n(this,f,c,a,!0)},h.prototype.removeListener=function(f,c,a,l){var d=e?e+f:f;if(!this._events[d])return this;if(!c)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===c&&(!l||p.once)&&(!a||p.context===a)&&o(this,d);else{for(var y=0,m=[],v=p.length;y<v;y++)(p[y].fn!==c||l&&!p[y].once||a&&p[y].context!==a)&&m.push(p[y]);m.length?this._events[d]=m.length===1?m[0]:m:o(this,d)}return this},h.prototype.removeAllListeners=function(f){var c;return f?(c=e?e+f:f,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,s.exports=h})(pf);var gf=Zi,ei=new gf;const ia="dom_ready",ii="me.boot",vf="me.state.onPause",je="me.state.onResume",yf="me.state.onStop",ra="me.state.onRestart",sa="me.state.onChange",na="me.video.onInit",mf="me.game.onInit",ri="me.game.onReset",aa="me.game.beforeUpdate",_f="me.game.afterUpdate",xf="me.game.onUpdate",wf="me.game.beforeDraw",bf="me.game.afterDraw",kr="me.game.onLevelLoaded",Tf="me.loader.onload",Qi="me.loader.onProgress",Af="me.input.keydown",Sf="me.input.keyup",Ef="gamepad.connected",Cf="gamepad.disconnected",oa="globalThis.onresize",si="canvas.onresize",Ft="viewport.onresize",Ne="globalThis.orientationchange",Mf="globalThis.onscroll",Ji="viewport.onchange",zr="renderer.contextlost",We="renderer.contextrestored";function I(s,...t){return ei.emit(s,...t)}function B(s,t,e){return ei.on(s,t,e)}function ha(s,t,e){return ei.once(s,t,e)}function Lt(s,t){return ei.off(s,t)}var tr={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var t=function(){this.init()};t.prototype={init:function(){var a=this||e;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator=typeof window<"u"&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var l=this||e;if(a=parseFloat(a),l.ctx||c(),typeof a<"u"&&a>=0&&a<=1){if(l._volume=a,l._muted)return l;l.usingWebAudio&&l.masterGain.gain.setValueAtTime(a,e.ctx.currentTime);for(var d=0;d<l._howls.length;d++)if(!l._howls[d]._webAudio)for(var p=l._howls[d]._getSoundIds(),y=0;y<p.length;y++){var m=l._howls[d]._soundById(p[y]);m&&m._node&&(m._node.volume=m._volume*a)}return l}return l._volume},mute:function(a){var l=this||e;l.ctx||c(),l._muted=a,l.usingWebAudio&&l.masterGain.gain.setValueAtTime(a?0:l._volume,e.ctx.currentTime);for(var d=0;d<l._howls.length;d++)if(!l._howls[d]._webAudio)for(var p=l._howls[d]._getSoundIds(),y=0;y<p.length;y++){var m=l._howls[d]._soundById(p[y]);m&&m._node&&(m._node.muted=a?!0:m._muted)}return l},stop:function(){for(var a=this||e,l=0;l<a._howls.length;l++)a._howls[l].stop();return a},unload:function(){for(var a=this||e,l=a._howls.length-1;l>=0;l--)a._howls[l].unload();return a.usingWebAudio&&a.ctx&&typeof a.ctx.close<"u"&&(a.ctx.close(),a.ctx=null,c()),a},codecs:function(a){return(this||e)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||e;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if(typeof Audio<"u")try{var l=new Audio;typeof l.oncanplaythrough>"u"&&(a._canPlayEvent="canplay")}catch{a.noAudio=!0}else a.noAudio=!0;try{var l=new Audio;l.muted&&(a.noAudio=!0)}catch{}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||e,l=null;try{l=typeof Audio<"u"?new Audio:null}catch{return a}if(!l||typeof l.canPlayType!="function")return a;var d=l.canPlayType("audio/mpeg;").replace(/^no$/,""),p=a._navigator?a._navigator.userAgent:"",y=p.match(/OPR\/([0-6].)/g),m=y&&parseInt(y[0].split("/")[1],10)<33,v=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,_=p.match(/Version\/(.*?) /),x=v&&_&&parseInt(_[1],10)<15;return a._codecs={mp3:!!(!m&&(d||l.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(l.canPlayType('audio/wav; codecs="1"')||l.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!l.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(l.canPlayType("audio/x-m4b;")||l.canPlayType("audio/m4b;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!l.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(l.canPlayType("audio/x-flac;")||l.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||e;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,!a._mobileUnloaded&&a.ctx.sampleRate!==44100&&(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var l=function(d){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,a._releaseHtml5Audio(p)}catch{a.noAudio=!0;break}for(var y=0;y<a._howls.length;y++)if(!a._howls[y]._webAudio)for(var m=a._howls[y]._getSoundIds(),v=0;v<m.length;v++){var _=a._howls[y]._soundById(m[v]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}a._autoResume();var x=a.ctx.createBufferSource();x.buffer=a._scratchBuffer,x.connect(a.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof a.ctx.resume=="function"&&a.ctx.resume(),x.onended=function(){x.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",l,!0),document.removeEventListener("touchend",l,!0),document.removeEventListener("click",l,!0),document.removeEventListener("keydown",l,!0);for(var w=0;w<a._howls.length;w++)a._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",l,!0),document.addEventListener("touchend",l,!0),document.addEventListener("click",l,!0),document.addEventListener("keydown",l,!0),a}},_obtainHtml5Audio:function(){var a=this||e;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var l=new Audio().play();return l&&typeof Promise<"u"&&(l instanceof Promise||typeof l.then=="function")&&l.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var l=this||e;return a._unlocked&&l._html5AudioPool.push(a),l},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx||typeof a.ctx.suspend>"u"||!e.usingWebAudio)){for(var l=0;l<a._howls.length;l++)if(a._howls[l]._webAudio){for(var d=0;d<a._howls[l]._sounds.length;d++)if(!a._howls[l]._sounds[d]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var p=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(p,p)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx||typeof a.ctx.resume>"u"||!e.usingWebAudio))return a.state==="running"&&a.ctx.state!=="interrupted"&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):a.state==="suspended"||a.state==="running"&&a.ctx.state==="interrupted"?(a.ctx.resume().then(function(){a.state="running";for(var l=0;l<a._howls.length;l++)a._howls[l]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):a.state==="suspending"&&(a._resumeAfterSuspend=!0),a}};var e=new t,i=function(a){var l=this;if(!a.src||a.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}l.init(a)};i.prototype={init:function(a){var l=this;return e.ctx||c(),l._autoplay=a.autoplay||!1,l._format=typeof a.format!="string"?a.format:[a.format],l._html5=a.html5||!1,l._muted=a.mute||!1,l._loop=a.loop||!1,l._pool=a.pool||5,l._preload=typeof a.preload=="boolean"||a.preload==="metadata"?a.preload:!0,l._rate=a.rate||1,l._sprite=a.sprite||{},l._src=typeof a.src!="string"?a.src:[a.src],l._volume=a.volume!==void 0?a.volume:1,l._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1},l._duration=0,l._state="unloaded",l._sounds=[],l._endTimers={},l._queue=[],l._playLock=!1,l._onend=a.onend?[{fn:a.onend}]:[],l._onfade=a.onfade?[{fn:a.onfade}]:[],l._onload=a.onload?[{fn:a.onload}]:[],l._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],l._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],l._onpause=a.onpause?[{fn:a.onpause}]:[],l._onplay=a.onplay?[{fn:a.onplay}]:[],l._onstop=a.onstop?[{fn:a.onstop}]:[],l._onmute=a.onmute?[{fn:a.onmute}]:[],l._onvolume=a.onvolume?[{fn:a.onvolume}]:[],l._onrate=a.onrate?[{fn:a.onrate}]:[],l._onseek=a.onseek?[{fn:a.onseek}]:[],l._onunlock=a.onunlock?[{fn:a.onunlock}]:[],l._onresume=[],l._webAudio=e.usingWebAudio&&!l._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(l),l._autoplay&&l._queue.push({event:"play",action:function(){l.play()}}),l._preload&&l._preload!=="none"&&l.load(),l},load:function(){var a=this,l=null;if(e.noAudio){a._emit("loaderror",null,"No audio support.");return}typeof a._src=="string"&&(a._src=[a._src]);for(var d=0;d<a._src.length;d++){var p,y;if(a._format&&a._format[d])p=a._format[d];else{if(y=a._src[d],typeof y!="string"){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(y),p||(p=/\.([^.]+)$/.exec(y.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&e.codecs(p)){l=a._src[d];break}}if(!l){a._emit("loaderror",null,"No codec support for selected audio sources.");return}return a._src=l,a._state="loading",window.location.protocol==="https:"&&l.slice(0,5)==="http:"&&(a._html5=!0,a._webAudio=!1),new r(a),a._webAudio&&o(a),a},play:function(a,l){var d=this,p=null;if(typeof a=="number")p=a,a=null;else{if(typeof a=="string"&&d._state==="loaded"&&!d._sprite[a])return null;if(typeof a>"u"&&(a="__default",!d._playLock)){for(var y=0,m=0;m<d._sounds.length;m++)d._sounds[m]._paused&&!d._sounds[m]._ended&&(y++,p=d._sounds[m]._id);y===1?a=null:p=null}}var v=p?d._soundById(p):d._inactiveSound();if(!v)return null;if(p&&!a&&(a=v._sprite||"__default"),d._state!=="loaded"){v._sprite=a,v._ended=!1;var _=v._id;return d._queue.push({event:"play",action:function(){d.play(_)}}),_}if(p&&!v._paused)return l||d._loadQueue("play"),v._id;d._webAudio&&e._autoResume();var x=Math.max(0,v._seek>0?v._seek:d._sprite[a][0]/1e3),w=Math.max(0,(d._sprite[a][0]+d._sprite[a][1])/1e3-x),b=w*1e3/Math.abs(v._rate),S=d._sprite[a][0]/1e3,E=(d._sprite[a][0]+d._sprite[a][1])/1e3;v._sprite=a,v._ended=!1;var F=function(){v._paused=!1,v._seek=x,v._start=S,v._stop=E,v._loop=!!(v._loop||d._sprite[a][2])};if(x>=E){d._ended(v);return}var P=v._node;if(d._webAudio){var U=function(){d._playLock=!1,F(),d._refreshBuffer(v);var R=v._muted||d._muted?0:v._volume;P.gain.setValueAtTime(R,e.ctx.currentTime),v._playStart=e.ctx.currentTime,typeof P.bufferSource.start>"u"?v._loop?P.bufferSource.noteGrainOn(0,x,86400):P.bufferSource.noteGrainOn(0,x,w):v._loop?P.bufferSource.start(0,x,86400):P.bufferSource.start(0,x,w),b!==1/0&&(d._endTimers[v._id]=setTimeout(d._ended.bind(d,v),b)),l||setTimeout(function(){d._emit("play",v._id),d._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?U():(d._playLock=!0,d.once("resume",U),d._clearTimer(v._id))}else{var G=function(){P.currentTime=x,P.muted=v._muted||d._muted||e._muted||P.muted,P.volume=v._volume*e.volume(),P.playbackRate=v._rate;try{var R=P.play();if(R&&typeof Promise<"u"&&(R instanceof Promise||typeof R.then=="function")?(d._playLock=!0,F(),R.then(function(){d._playLock=!1,P._unlocked=!0,l?d._loadQueue():d._emit("play",v._id)}).catch(function(){d._playLock=!1,d._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):l||(d._playLock=!1,F(),d._emit("play",v._id)),P.playbackRate=v._rate,P.paused){d._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}a!=="__default"||v._loop?d._endTimers[v._id]=setTimeout(d._ended.bind(d,v),b):(d._endTimers[v._id]=function(){d._ended(v),P.removeEventListener("ended",d._endTimers[v._id],!1)},P.addEventListener("ended",d._endTimers[v._id],!1))}catch(St){d._emit("playerror",v._id,St)}};P.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(P.src=d._src,P.load());var j=window&&window.ejecta||!P.readyState&&e._navigator.isCocoonJS;if(P.readyState>=3||j)G();else{d._playLock=!0,d._state="loading";var H=function(){d._state="loaded",G(),P.removeEventListener(e._canPlayEvent,H,!1)};P.addEventListener(e._canPlayEvent,H,!1),d._clearTimer(v._id)}}return v._id},pause:function(a){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"pause",action:function(){l.pause(a)}}),l;for(var d=l._getSoundIds(a),p=0;p<d.length;p++){l._clearTimer(d[p]);var y=l._soundById(d[p]);if(y&&!y._paused&&(y._seek=l.seek(d[p]),y._rateSeek=0,y._paused=!0,l._stopFade(d[p]),y._node))if(l._webAudio){if(!y._node.bufferSource)continue;typeof y._node.bufferSource.stop>"u"?y._node.bufferSource.noteOff(0):y._node.bufferSource.stop(0),l._cleanBuffer(y._node)}else(!isNaN(y._node.duration)||y._node.duration===1/0)&&y._node.pause();arguments[1]||l._emit("pause",y?y._id:null)}return l},stop:function(a,l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(a)}}),d;for(var p=d._getSoundIds(a),y=0;y<p.length;y++){d._clearTimer(p[y]);var m=d._soundById(p[y]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,d._stopFade(p[y]),m._node&&(d._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&d._clearSound(m._node))),l||d._emit("stop",m._id))}return d},mute:function(a,l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(a,l)}}),d;if(typeof l>"u")if(typeof a=="boolean")d._muted=a;else return d._muted;for(var p=d._getSoundIds(l),y=0;y<p.length;y++){var m=d._soundById(p[y]);m&&(m._muted=a,m._interval&&d._stopFade(m._id),d._webAudio&&m._node?m._node.gain.setValueAtTime(a?0:m._volume,e.ctx.currentTime):m._node&&(m._node.muted=e._muted?!0:a),d._emit("mute",m._id))}return d},volume:function(){var a=this,l=arguments,d,p;if(l.length===0)return a._volume;if(l.length===1||l.length===2&&typeof l[1]>"u"){var y=a._getSoundIds(),m=y.indexOf(l[0]);m>=0?p=parseInt(l[0],10):d=parseFloat(l[0])}else l.length>=2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));var v;if(typeof d<"u"&&d>=0&&d<=1){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,l)}}),a;typeof p>"u"&&(a._volume=d),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)v=a._soundById(p[_]),v&&(v._volume=d,l[2]||a._stopFade(p[_]),a._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(d,e.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=d*e.volume()),a._emit("volume",v._id))}else return v=p?a._soundById(p):a._sounds[0],v?v._volume:0;return a},fade:function(a,l,d,p){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"fade",action:function(){y.fade(a,l,d,p)}}),y;a=Math.min(Math.max(0,parseFloat(a)),1),l=Math.min(Math.max(0,parseFloat(l)),1),d=parseFloat(d),y.volume(a,p);for(var m=y._getSoundIds(p),v=0;v<m.length;v++){var _=y._soundById(m[v]);if(_){if(p||y._stopFade(m[v]),y._webAudio&&!_._muted){var x=e.ctx.currentTime,w=x+d/1e3;_._volume=a,_._node.gain.setValueAtTime(a,x),_._node.gain.linearRampToValueAtTime(l,w)}y._startFadeInterval(_,a,l,d,m[v],typeof p>"u")}}return y},_startFadeInterval:function(a,l,d,p,y,m){var v=this,_=l,x=d-l,w=Math.abs(x/.01),b=Math.max(4,w>0?p/w:p),S=Date.now();a._fadeTo=d,a._interval=setInterval(function(){var E=(Date.now()-S)/p;S=Date.now(),_+=x*E,_=Math.round(_*100)/100,x<0?_=Math.max(d,_):_=Math.min(d,_),v._webAudio?a._volume=_:v.volume(_,a._id,!0),m&&(v._volume=_),(d<l&&_<=d||d>l&&_>=d)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,v.volume(d,a._id),v._emit("fade",a._id))},b)},_stopFade:function(a){var l=this,d=l._soundById(a);return d&&d._interval&&(l._webAudio&&d._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(d._interval),d._interval=null,l.volume(d._fadeTo,a),d._fadeTo=null,l._emit("fade",a)),l},loop:function(){var a=this,l=arguments,d,p,y;if(l.length===0)return a._loop;if(l.length===1)if(typeof l[0]=="boolean")d=l[0],a._loop=d;else return y=a._soundById(parseInt(l[0],10)),y?y._loop:!1;else l.length===2&&(d=l[0],p=parseInt(l[1],10));for(var m=a._getSoundIds(p),v=0;v<m.length;v++)y=a._soundById(m[v]),y&&(y._loop=d,a._webAudio&&y._node&&y._node.bufferSource&&(y._node.bufferSource.loop=d,d&&(y._node.bufferSource.loopStart=y._start||0,y._node.bufferSource.loopEnd=y._stop,a.playing(m[v])&&(a.pause(m[v],!0),a.play(m[v],!0)))));return a},rate:function(){var a=this,l=arguments,d,p;if(l.length===0)p=a._sounds[0]._id;else if(l.length===1){var y=a._getSoundIds(),m=y.indexOf(l[0]);m>=0?p=parseInt(l[0],10):d=parseFloat(l[0])}else l.length===2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));var v;if(typeof d=="number"){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,l)}}),a;typeof p>"u"&&(a._rate=d),p=a._getSoundIds(p);for(var _=0;_<p.length;_++)if(v=a._soundById(p[_]),v){a.playing(p[_])&&(v._rateSeek=a.seek(p[_]),v._playStart=a._webAudio?e.ctx.currentTime:v._playStart),v._rate=d,a._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(d,e.ctx.currentTime):v._node&&(v._node.playbackRate=d);var x=a.seek(p[_]),w=(a._sprite[v._sprite][0]+a._sprite[v._sprite][1])/1e3-x,b=w*1e3/Math.abs(v._rate);(a._endTimers[p[_]]||!v._paused)&&(a._clearTimer(p[_]),a._endTimers[p[_]]=setTimeout(a._ended.bind(a,v),b)),a._emit("rate",v._id)}}else return v=a._soundById(p),v?v._rate:a._rate;return a},seek:function(){var a=this,l=arguments,d,p;if(l.length===0)a._sounds.length&&(p=a._sounds[0]._id);else if(l.length===1){var y=a._getSoundIds(),m=y.indexOf(l[0]);m>=0?p=parseInt(l[0],10):a._sounds.length&&(p=a._sounds[0]._id,d=parseFloat(l[0]))}else l.length===2&&(d=parseFloat(l[0]),p=parseInt(l[1],10));if(typeof p>"u")return 0;if(typeof d=="number"&&(a._state!=="loaded"||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,l)}}),a;var v=a._soundById(p);if(v)if(typeof d=="number"&&d>=0){var _=a.playing(p);_&&a.pause(p,!0),v._seek=d,v._ended=!1,a._clearTimer(p),!a._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=d);var x=function(){_&&a.play(p,!0),a._emit("seek",p)};if(_&&!a._webAudio){var w=function(){a._playLock?setTimeout(w,0):x()};setTimeout(w,0)}else x()}else if(a._webAudio){var b=a.playing(p)?e.ctx.currentTime-v._playStart:0,S=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(S+b*Math.abs(v._rate))}else return v._node.currentTime;return a},playing:function(a){var l=this;if(typeof a=="number"){var d=l._soundById(a);return d?!d._paused:!1}for(var p=0;p<l._sounds.length;p++)if(!l._sounds[p]._paused)return!0;return!1},duration:function(a){var l=this,d=l._duration,p=l._soundById(a);return p&&(d=l._sprite[p._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var a=this,l=a._sounds,d=0;d<l.length;d++)l[d]._paused||a.stop(l[d]._id),a._webAudio||(a._clearSound(l[d]._node),l[d]._node.removeEventListener("error",l[d]._errorFn,!1),l[d]._node.removeEventListener(e._canPlayEvent,l[d]._loadFn,!1),l[d]._node.removeEventListener("ended",l[d]._endFn,!1),e._releaseHtml5Audio(l[d]._node)),delete l[d]._node,a._clearTimer(l[d]._id);var p=e._howls.indexOf(a);p>=0&&e._howls.splice(p,1);var y=!0;for(d=0;d<e._howls.length;d++)if(e._howls[d]._src===a._src||a._src.indexOf(e._howls[d]._src)>=0){y=!1;break}return n&&y&&delete n[a._src],e.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,l,d,p){var y=this,m=y["_on"+a];return typeof l=="function"&&m.push(p?{id:d,fn:l,once:p}:{id:d,fn:l}),y},off:function(a,l,d){var p=this,y=p["_on"+a],m=0;if(typeof l=="number"&&(d=l,l=null),l||d)for(m=0;m<y.length;m++){var v=d===y[m].id;if(l===y[m].fn&&v||!l&&v){y.splice(m,1);break}}else if(a)p["_on"+a]=[];else{var _=Object.keys(p);for(m=0;m<_.length;m++)_[m].indexOf("_on")===0&&Array.isArray(p[_[m]])&&(p[_[m]]=[])}return p},once:function(a,l,d){var p=this;return p.on(a,l,d,1),p},_emit:function(a,l,d){for(var p=this,y=p["_on"+a],m=y.length-1;m>=0;m--)(!y[m].id||y[m].id===l||a==="load")&&(setTimeout(function(v){v.call(this,l,d)}.bind(p,y[m].fn),0),y[m].once&&p.off(a,y[m].fn,y[m].id));return p._loadQueue(a),p},_loadQueue:function(a){var l=this;if(l._queue.length>0){var d=l._queue[0];d.event===a&&(l._queue.shift(),l._loadQueue()),a||d.action()}return l},_ended:function(a){var l=this,d=a._sprite;if(!l._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(l._ended.bind(l,a),100),l;var p=!!(a._loop||l._sprite[d][2]);if(l._emit("end",a._id),!l._webAudio&&p&&l.stop(a._id,!0).play(a._id),l._webAudio&&p){l._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=e.ctx.currentTime;var y=(a._stop-a._start)*1e3/Math.abs(a._rate);l._endTimers[a._id]=setTimeout(l._ended.bind(l,a),y)}return l._webAudio&&!p&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,l._clearTimer(a._id),l._cleanBuffer(a._node),e._autoSuspend()),!l._webAudio&&!p&&l.stop(a._id,!0),l},_clearTimer:function(a){var l=this;if(l._endTimers[a]){if(typeof l._endTimers[a]!="function")clearTimeout(l._endTimers[a]);else{var d=l._soundById(a);d&&d._node&&d._node.removeEventListener("ended",l._endTimers[a],!1)}delete l._endTimers[a]}return l},_soundById:function(a){for(var l=this,d=0;d<l._sounds.length;d++)if(a===l._sounds[d]._id)return l._sounds[d];return null},_inactiveSound:function(){var a=this;a._drain();for(var l=0;l<a._sounds.length;l++)if(a._sounds[l]._ended)return a._sounds[l].reset();return new r(a)},_drain:function(){var a=this,l=a._pool,d=0,p=0;if(!(a._sounds.length<l)){for(p=0;p<a._sounds.length;p++)a._sounds[p]._ended&&d++;for(p=a._sounds.length-1;p>=0;p--){if(d<=l)return;a._sounds[p]._ended&&(a._webAudio&&a._sounds[p]._node&&a._sounds[p]._node.disconnect(0),a._sounds.splice(p,1),d--)}}},_getSoundIds:function(a){var l=this;if(typeof a>"u"){for(var d=[],p=0;p<l._sounds.length;p++)d.push(l._sounds[p]._id);return d}else return[a]},_refreshBuffer:function(a){var l=this;return a._node.bufferSource=e.ctx.createBufferSource(),a._node.bufferSource.buffer=n[l._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,e.ctx.currentTime),l},_cleanBuffer:function(a){var l=this,d=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),d))try{a.bufferSource.buffer=e._scratchBuffer}catch{}return a.bufferSource=null,l},_clearSound:function(a){var l=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);l||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(a){this._parent=a,this.init()};r.prototype={init:function(){var a=this,l=a._parent;return a._muted=l._muted,a._loop=l._loop,a._volume=l._volume,a._rate=l._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,l._sounds.push(a),a.create(),a},create:function(){var a=this,l=a._parent,d=e._muted||a._muted||a._parent._muted?0:a._volume;return l._webAudio?(a._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),a._node.gain.setValueAtTime(d,e.ctx.currentTime),a._node.paused=!0,a._node.connect(e.masterGain)):e.noAudio||(a._node=e._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(e._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=l._src,a._node.preload=l._preload===!0?"auto":l._preload,a._node.volume=d*e.volume(),a._node.load()),a},reset:function(){var a=this,l=a._parent;return a._muted=l._muted,a._loop=l._loop,a._volume=l._volume,a._rate=l._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,l=a._parent;l._duration=Math.ceil(a._node.duration*10)/10,Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue()),a._node.removeEventListener(e._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,l=a._parent;l._duration===1/0&&(l._duration=Math.ceil(a._node.duration*10)/10,l._sprite.__default[1]===1/0&&(l._sprite.__default[1]=l._duration*1e3),l._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}};var n={},o=function(a){var l=a._src;if(n[l]){a._duration=n[l].duration,f(a);return}if(/^data:[^;]+;base64,/.test(l)){for(var d=atob(l.split(",")[1]),p=new Uint8Array(d.length),y=0;y<d.length;++y)p[y]=d.charCodeAt(y);u(p.buffer,a)}else{var m=new XMLHttpRequest;m.open(a._xhr.method,l,!0),m.withCredentials=a._xhr.withCredentials,m.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(v){m.setRequestHeader(v,a._xhr.headers[v])}),m.onload=function(){var v=(m.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){a._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}u(m.response,a)},m.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete n[l],a.load())},h(m)}},h=function(a){try{a.send()}catch{a.onerror()}},u=function(a,l){var d=function(){l._emit("loaderror",null,"Decoding audio data failed.")},p=function(y){y&&l._sounds.length>0?(n[l._src]=y,f(l,y)):d()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(a).then(p).catch(d):e.ctx.decodeAudioData(a,p,d)},f=function(a,l){l&&!a._duration&&(a._duration=l.duration),Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue())},c=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),l=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=l?parseInt(l[1],10):null;if(a&&d&&d<9){var p=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!p&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};s.Howler=e,s.Howl=i,typeof V<"u"?(V.HowlerGlobal=t,V.Howler=e,V.Howl=i,V.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,r){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,r=typeof r!="number"?n._pos[2]:r,typeof e=="number")n._pos=[e,i,r],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(e,i,r,n,o,h){var u=this;if(!u.ctx||!u.ctx.listener)return u;var f=u._orientation;if(i=typeof i!="number"?f[1]:i,r=typeof r!="number"?f[2]:r,n=typeof n!="number"?f[3]:n,o=typeof o!="number"?f[4]:o,h=typeof h!="number"?f[5]:h,typeof e=="number")u._orientation=[e,i,r,n,o,h],typeof u.ctx.listener.forwardX<"u"?(u.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(e,i,r,n,o,h);else return f;return u},Howl.prototype.init=function(e){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(e,i)}}),r;var n=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")r._stereo=e,r._pos=[e,0,0];else return r._stereo;for(var o=r._getSoundIds(i),h=0;h<o.length;h++){var u=r._soundById(o[h]);if(u)if(typeof e=="number")u._stereo=e,u._pos=[e,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&t(u,n),n==="spatial"?typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(e,0,0):u._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",u._id);else return u._stereo}return r},Howl.prototype.pos=function(e,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(e,i,r,n)}}),o;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof n>"u")if(typeof e=="number")o._pos=[e,i,r];else return o._pos;for(var h=o._getSoundIds(n),u=0;u<h.length;u++){var f=o._soundById(h[u]);if(f)if(typeof e=="number")f._pos=[e,i,r],f._node&&((!f._panner||f._panner.pan)&&t(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setPosition(e,i,r)),o._emit("pos",f._id);else return f._pos}return o},Howl.prototype.orientation=function(e,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(e,i,r,n)}}),o;if(i=typeof i!="number"?o._orientation[1]:i,r=typeof r!="number"?o._orientation[2]:r,typeof n>"u")if(typeof e=="number")o._orientation=[e,i,r];else return o._orientation;for(var h=o._getSoundIds(n),u=0;u<h.length;u++){var f=o._soundById(h[u]);if(f)if(typeof e=="number")f._orientation=[e,i,r],f._node&&(f._panner||(f._pos||(f._pos=o._pos||[0,0,-.5]),t(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setOrientation(e,i,r)),o._emit("orientation",f._id);else return f._orientation}return o},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,r,n,o;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof n>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),e._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:e._panningModel});else return o=e._soundById(parseInt(i[0],10)),o?o._pannerAttr:e._pannerAttr;else i.length===2&&(r=i[0],n=parseInt(i[1],10));for(var h=e._getSoundIds(n),u=0;u<h.length;u++)if(o=e._soundById(h[u]),o){var f=o._pannerAttr;f={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:f.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:f.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:f.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:f.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:f.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:f.panningModel};var c=o._panner;c?(c.coneInnerAngle=f.coneInnerAngle,c.coneOuterAngle=f.coneOuterAngle,c.coneOuterGain=f.coneOuterGain,c.distanceModel=f.distanceModel,c.maxDistance=f.maxDistance,c.refDistance=f.refDistance,c.rolloffFactor=f.rolloffFactor,c.panningModel=f.panningModel):(o._pos||(o._pos=e._pos||[0,0,-.5]),t(o,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,e.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(tr);const tt=typeof globalThis.navigator<"u"?globalThis.navigator.userAgent:"",la=/iPhone|iPad|iPod/i.test(tt),ua=/Android/i.test(tt),Pf=/Android 2/i.test(tt),If=/Linux/i.test(tt),Rf=/CrOS/.test(tt),fa=/Windows Phone/i.test(tt),da=/BlackBerry/i.test(tt),ca=/Kindle|Silk.*Mobile Safari/i.test(tt),Of=typeof globalThis.ejecta<"u",Bf=/MicroMessenger/i.test(tt),pa=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node",ga=/Mobi/i.test(tt)||la||ua||fa||da||ca||!1;var Lf=Object.freeze({__proto__:null,BlackBerry:da,Kindle:ca,android:ua,android2:Pf,chromeOS:Rf,ejecta:Of,iOS:la,isMobile:ga,isWeixin:Bf,linux:If,nodeJS:pa,ua:tt,wp:fa});class Df{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(typeof e<"u")this.objectClass[t]={class:e,pool:i?[]:void 0};else throw new Error("Cannot register object '"+t+"', invalid class")}pull(t){for(var e=new Array(arguments.length),i=0;i<arguments.length;i++)e[i]=arguments[i];var r=this.objectClass[t];if(r){var n=r.class,o=r.pool,h;return o&&(h=o.pop())?(e.shift(),typeof h.onResetEvent=="function"&&h.onResetEvent.apply(h,e),this.instance_counter--):(e[0]=n,h=new(n.bind.apply(n,e)),o&&(h.className=t)),h}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(var t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(e===!0)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){var e=t.className;return typeof e<"u"&&typeof t.onResetEvent=="function"&&e in this.objectClass&&typeof this.objectClass[e].pool<"u"}getInstanceCount(){return this.instance_counter}}var g=new Df,Z={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1<<0,NPC_OBJECT:1<<1,ENEMY_OBJECT:1<<2,COLLECTABLE_OBJECT:1<<3,ACTION_OBJECT:1<<4,PROJECTILE_OBJECT:1<<5,WORLD_SHAPE:1<<6,USER:1<<7,ALL_OBJECT:4294967295},rayCast(s,t){return T.world.detector.rayCast(s,t)}},ce={},Ff={get exports(){return ce},set exports(s){ce=s}};Ff.exports=ni;ce.default=ni;function ni(s,t,e){e=e||2;var i=t&&t.length,r=i?t[0]*e:s.length,n=va(s,0,r,e,!0),o=[];if(!n||n.next===n.prev)return o;var h,u,f,c,a,l,d;if(i&&(n=Uf(s,t,n,e)),s.length>80*e){h=f=s[0],u=c=s[1];for(var p=e;p<r;p+=e)a=s[p],l=s[p+1],a<h&&(h=a),l<u&&(u=l),a>f&&(f=a),l>c&&(c=l);d=Math.max(f-h,c-u),d=d!==0?32767/d:0}return pe(n,o,e,h,u,d,0),o}function va(s,t,e,i,r){var n,o;if(r===rr(s,t,e,i)>0)for(n=t;n<e;n+=i)o=Ts(n,s[n],s[n+1],o);else for(n=e-i;n>=t;n-=i)o=Ts(n,s[n],s[n+1],o);return o&&ai(o,o.next)&&(ve(o),o=o.next),o}function kt(s,t){if(!s)return s;t||(t=s);var e=s,i;do if(i=!1,!e.steiner&&(ai(e,e.next)||L(e.prev,e,e.next)===0)){if(ve(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function pe(s,t,e,i,r,n,o){if(s){!o&&n&&Yf(s,i,r,n);for(var h=s,u,f;s.prev!==s.next;){if(u=s.prev,f=s.next,n?zf(s,i,r,n):kf(s)){t.push(u.i/e|0),t.push(s.i/e|0),t.push(f.i/e|0),ve(s),s=f.next,h=f.next;continue}if(s=f,s===h){o?o===1?(s=Vf(kt(s),t,e),pe(s,t,e,i,r,n,2)):o===2&&Nf(s,t,e,i,r,n):pe(kt(s),t,e,i,r,n,1);break}}}}function kf(s){var t=s.prev,e=s,i=s.next;if(L(t,e,i)>=0)return!1;for(var r=t.x,n=e.x,o=i.x,h=t.y,u=e.y,f=i.y,c=r<n?r<o?r:o:n<o?n:o,a=h<u?h<f?h:f:u<f?u:f,l=r>n?r>o?r:o:n>o?n:o,d=h>u?h>f?h:f:u>f?u:f,p=i.next;p!==t;){if(p.x>=c&&p.x<=l&&p.y>=a&&p.y<=d&&Wt(r,h,n,u,o,f,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function zf(s,t,e,i){var r=s.prev,n=s,o=s.next;if(L(r,n,o)>=0)return!1;for(var h=r.x,u=n.x,f=o.x,c=r.y,a=n.y,l=o.y,d=h<u?h<f?h:f:u<f?u:f,p=c<a?c<l?c:l:a<l?a:l,y=h>u?h>f?h:f:u>f?u:f,m=c>a?c>l?c:l:a>l?a:l,v=er(d,p,t,e,i),_=er(y,m,t,e,i),x=s.prevZ,w=s.nextZ;x&&x.z>=v&&w&&w.z<=_;){if(x.x>=d&&x.x<=y&&x.y>=p&&x.y<=m&&x!==r&&x!==o&&Wt(h,c,u,a,f,l,x.x,x.y)&&L(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==r&&w!==o&&Wt(h,c,u,a,f,l,w.x,w.y)&&L(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=v;){if(x.x>=d&&x.x<=y&&x.y>=p&&x.y<=m&&x!==r&&x!==o&&Wt(h,c,u,a,f,l,x.x,x.y)&&L(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=_;){if(w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==r&&w!==o&&Wt(h,c,u,a,f,l,w.x,w.y)&&L(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Vf(s,t,e){var i=s;do{var r=i.prev,n=i.next.next;!ai(r,n)&&ya(r,i,i.next,n)&&ge(r,n)&&ge(n,r)&&(t.push(r.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),ve(i),ve(i.next),i=s=n),i=i.next}while(i!==s);return kt(i)}function Nf(s,t,e,i,r,n){var o=s;do{for(var h=o.next.next;h!==o.prev;){if(o.i!==h.i&&qf(o,h)){var u=ma(o,h);o=kt(o,o.next),u=kt(u,u.next),pe(o,t,e,i,r,n,0),pe(u,t,e,i,r,n,0);return}h=h.next}o=o.next}while(o!==s)}function Uf(s,t,e,i){var r=[],n,o,h,u,f;for(n=0,o=t.length;n<o;n++)h=t[n]*i,u=n<o-1?t[n+1]*i:s.length,f=va(s,h,u,i,!1),f===f.next&&(f.steiner=!0),r.push(Wf(f));for(r.sort(Gf),n=0;n<r.length;n++)e=Hf(r[n],e);return e}function Gf(s,t){return s.x-t.x}function Hf(s,t){var e=Xf(s,t);if(!e)return t;var i=ma(e,s);return kt(i,i.next),kt(e,e.next)}function Xf(s,t){var e=t,i=s.x,r=s.y,n=-1/0,o;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var h=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=i&&h>n&&(n=h,o=e.x<e.next.x?e:e.next,h===i))return o}e=e.next}while(e!==t);if(!o)return null;var u=o,f=o.x,c=o.y,a=1/0,l;e=o;do i>=e.x&&e.x>=f&&i!==e.x&&Wt(r<c?i:n,r,f,c,r<c?n:i,r,e.x,e.y)&&(l=Math.abs(r-e.y)/(i-e.x),ge(e,s)&&(l<a||l===a&&(e.x>o.x||e.x===o.x&&$f(o,e)))&&(o=e,a=l)),e=e.next;while(e!==u);return o}function $f(s,t){return L(s.prev,s,t.prev)<0&&L(t.next,s,s.next)<0}function Yf(s,t,e,i){var r=s;do r.z===0&&(r.z=er(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,jf(r)}function jf(s){var t,e,i,r,n,o,h,u,f=1;do{for(e=s,s=null,n=null,o=0;e;){for(o++,i=e,h=0,t=0;t<f&&(h++,i=i.nextZ,!!i);t++);for(u=f;h>0||u>0&&i;)h!==0&&(u===0||!i||e.z<=i.z)?(r=e,e=e.nextZ,h--):(r=i,i=i.nextZ,u--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;e=i}n.nextZ=null,f*=2}while(o>1);return s}function er(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function Wf(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Wt(s,t,e,i,r,n,o,h){return(r-o)*(t-h)>=(s-o)*(n-h)&&(s-o)*(i-h)>=(e-o)*(t-h)&&(e-o)*(n-h)>=(r-o)*(i-h)}function qf(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Kf(s,t)&&(ge(s,t)&&ge(t,s)&&Zf(s,t)&&(L(s.prev,s,t.prev)||L(s,t.prev,t))||ai(s,t)&&L(s.prev,s,s.next)>0&&L(t.prev,t,t.next)>0)}function L(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function ai(s,t){return s.x===t.x&&s.y===t.y}function ya(s,t,e,i){var r=Re(L(s,t,e)),n=Re(L(s,t,i)),o=Re(L(e,i,s)),h=Re(L(e,i,t));return!!(r!==n&&o!==h||r===0&&Ie(s,e,t)||n===0&&Ie(s,i,t)||o===0&&Ie(e,s,i)||h===0&&Ie(e,t,i))}function Ie(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function Re(s){return s>0?1:s<0?-1:0}function Kf(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&ya(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function ge(s,t){return L(s.prev,s,s.next)<0?L(s,t,s.next)>=0&&L(s,s.prev,t)>=0:L(s,t,s.prev)<0||L(s,s.next,t)<0}function Zf(s,t){var e=s,i=!1,r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function ma(s,t){var e=new ir(s.i,s.x,s.y),i=new ir(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Ts(s,t,e,i){var r=new ir(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function ve(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ir(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ni.deviation=function(s,t,e,i){var r=t&&t.length,n=r?t[0]*e:s.length,o=Math.abs(rr(s,0,n,e));if(r)for(var h=0,u=t.length;h<u;h++){var f=t[h]*e,c=h<u-1?t[h+1]*e:s.length;o-=Math.abs(rr(s,f,c,e))}var a=0;for(h=0;h<i.length;h+=3){var l=i[h]*e,d=i[h+1]*e,p=i[h+2]*e;a+=Math.abs((s[l]-s[p])*(s[d+1]-s[l+1])-(s[l]-s[d])*(s[p+1]-s[l+1]))}return o===0&&a===0?0:Math.abs((a-o)/o)};function rr(s,t,e,i){for(var r=0,n=t,o=e-i;n<e;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}ni.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var o=0;o<t;o++)e.vertices.push(s[r][n][o]);r>0&&(i+=s[r-1].length,e.holes.push(i))}return e};class C{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){return this.x=t,this.y=e,this}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e){return this._set(this.x*t,this.y*(typeof e<"u"?e:t))}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new C(A(this.x,t,e),A(this.y,t,e))}clampSelf(t,e){return this._set(A(this.x,t,e),A(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new C(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new C(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new C(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){var t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){var i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);var n=this.x-i,o=this.y-r,h=Math.cos(t),u=Math.sin(t);return this._set(n*h-o*u+i,n*u+o*h+r)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),r=this.distance(t);return r===0||e>=0&&r<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(A(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return g.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}class vt{constructor(t,e,i){this.pos=g.pull("Vector2d"),this._bounds,this.points=[],this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if(t[0]instanceof C)this.points=t;else if(this.points.length=0,typeof t[0]=="object")t.forEach(i=>{this.points.push(g.pull("Vector2d",i.x,i.y))});else for(var e=0;e<t.length;e+=2)this.points.push(g.pull("Vector2d",t[e],t[e+1]));return this.recalc(),this.updateBounds(),this}transform(t){for(var e=this.points,i=e.length,r=0;r<i;r++)t.apply(e[r]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(t!==0){for(var i=this.points,r=i.length,n=0;n<r;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e){e=typeof e<"u"?e:t;for(var i=this.points,r=i.length,n=0;n<r;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){var t,e=this.edges,i=this.normals,r=this.indices,n=this.points,o=n.length;if(o<3)throw new Error("Requires at least 3 points");for(t=0;t<o;t++)e[t]===void 0&&(e[t]=g.pull("Vector2d")),e[t].copy(n[(t+1)%o]).sub(n[t]),i[t]===void 0&&(i[t]=g.pull("Vector2d")),i[t].copy(e[t]).perp().normalize();return e.length=o,i.length=o,r.length=0,this}getIndices(){return this.indices.length===0&&(this.indices=ce(this.points.flatMap(t=>[t.x,t.y]))),this.indices}isConvex(){var t=0,e=this.points,i=e.length,r,n,o,h;if(i<3)return null;for(r=0;r<i;r++)if(n=(r+1)%i,o=(r+2)%i,h=(e[n].x-e[r].x)*(e[o].y-e[n].y),h-=(e[n].y-e[r].y)*(e[o].x-e[n].x),h<0?t|=1:h>0&&(t|=2),t===3)return!1;return t!==0?!0:null}translate(){var t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){var t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(){var t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);for(var i=!1,r=this.pos.x,n=this.pos.y,o=this.points,h=o.length,u=0,f=h-1;u<h;f=u++){var c=o[u].y+n,a=o[u].x+r,l=o[f].y+n,d=o[f].x+r;c>e!=l>e&&t<(d-a)*(e-c)/(l-c)+a&&(i=!i)}return i}getBounds(){return typeof this._bounds>"u"&&(this._bounds=g.pull("Bounds")),this._bounds}updateBounds(){var t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){var t=[];return this.points.forEach(e=>{t.push(e.clone())}),new vt(this.pos.x,this.pos.y,t)}}class J extends vt{constructor(t,e,i,r){super(t,e,[g.pull("Vector2d",0,0),g.pull("Vector2d",i,0),g.pull("Vector2d",i,r),g.pull("Vector2d",0,r)]),this.shapeType="Rectangle"}onResetEvent(t,e,i,r){this.setShape(t,e,i,r)}setShape(t,e,i,r){var n=i;return this.pos.set(t,e),arguments.length===4&&(n=this.points,n[0].set(0,0),n[1].set(i,0),n[2].set(i,r),n[3].set(0,r)),this.setVertices(n),this}get left(){return this.pos.x}get right(){var t=this.width;return this.pos.x+t||t}get top(){return this.pos.y}get bottom(){var t=this.height;return this.pos.y+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.pos.x+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2}get centerY(){return isFinite(this.height)?this.pos.y+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new J(this.pos.x,this.pos.y,this.width,this.height)}copy(t){return this.setShape(t.pos.x,t.pos.y,t.width,t.height)}union(t){var e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){var t=arguments[0],e,i,r,n;return arguments.length===2?(e=i=t,r=n=arguments[1]):t instanceof J?(e=t.left,i=t.right,r=t.top,n=t.bottom):(e=i=t.x,r=n=t.y),e>=this.left&&i<=this.right&&r>=this.top&&n<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return g.pull("Polygon",this.pos.x,this.pos.y,this.points)}}class At{constructor(t,e,i,r){this.pos=g.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=g.pull("Vector2d"),this.radiusSq=g.pull("Vector2d"),this.ratio=g.pull("Vector2d"),this.shapeType="Ellipse",this.setShape(t,e,i,r)}onResetEvent(t,e,i,r){this.setShape(t,e,i,r)}setShape(t,e,i,r){var n=i/2,o=r/2;this.pos.set(t,e),this.radius=Math.max(n,o),this.ratio.set(n/this.radius,o/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var h=this.radius*this.radius;return this.radiusSq.set(h,h).scaleV(this.ratio),this.getBounds().setMinMax(t,e,t+i,t+r),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){return this.pos.rotate(t,e),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e){return e=typeof e<"u"?e:t,this.setShape(this.pos.x,this.pos.y,this.radiusV.x*2*t,this.radiusV.y*2*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){var t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(){var t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y,t*t/this.radiusSq.x+e*e/this.radiusSq.y<=1}getBounds(){return typeof this._bounds>"u"&&(this._bounds=g.pull("Bounds")),this._bounds}clone(){return new At(this.pos.x,this.pos.y,this.radiusV.x*2,this.radiusV.y*2)}}class Y{constructor(t){this._center=new C,this.onResetEvent(t)}onResetEvent(t){typeof this.min>"u"?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),typeof t<"u"&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,r){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=r}get x(){return this.min.x}set x(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}update(t){this.add(t,!0)}add(t,e=!1){e===!0&&this.clear();for(var i=0;i<t.length;i++){var r=t[i];r.x>this.max.x&&(this.max.x=r.x),r.x<this.min.x&&(this.min.x=r.x),r.y>this.max.y&&(this.max.y=r.y),r.y<this.min.y&&(this.min.y=r.y)}}addBounds(t,e=!1){e===!0?(this.max.x=t.max.x,this.min.x=t.min.x,this.max.y=t.max.y,this.min.y=t.min.y):(t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y))}addPoint(t,e){typeof e<"u"&&typeof t.rotate=="function"&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,r,n){var o=g.pull("Vector2d");this.addPoint(o.set(t,e),n),this.addPoint(o.set(i,e),n),this.addPoint(o.set(t,r),n),this.addPoint(o.set(i,r),n),g.push(o)}contains(){var t=arguments[0],e,i,r,n;return arguments.length===2?(e=i=t,r=n=arguments[1]):t instanceof Y?(e=t.min.x,i=t.max.x,r=t.min.y,n=t.max.y):(e=i=t.x,r=n=t.y),e>=this.min.x&&i<=this.max.x&&r>=this.min.y&&n<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){var t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){var t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);var i=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+r}clone(){var t=new Y;return t.addBounds(this),t}toPolygon(){return g.pull("Polygon",this.x,this.y,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])}}class Zt{constructor(t=0,e=0){this.x=t,this.y=e}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(){var t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}clone(){return new Zt(this.x,this.y)}}class Tt{constructor(t,e,i){if(this.ancestor=t,typeof this.bounds>"u"&&(this.bounds=g.pull("Bounds")),typeof this.shapes>"u"&&(this.shapes=[]),this.collisionMask=Z.types.ALL_OBJECT,this.collisionType=Z.types.ENEMY_OBJECT,typeof this.vel>"u"&&(this.vel=g.pull("Vector2d")),this.vel.set(0,0),typeof this.force>"u"&&(this.force=g.pull("Vector2d")),this.force.set(0,0),typeof this.friction>"u"&&(this.friction=g.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,typeof this.maxVel>"u"&&(this.maxVel=g.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,typeof i=="function"&&(this.onBodyUpdate=i),this.bounds.clear(),typeof e<"u")if(Array.isArray(e))for(var r=0;r<e.length;r++)this.addShape(e[r]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=t===!0}addShape(t){if(t instanceof J||t instanceof Y){var e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof At?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof vt?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof Zt?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){var r=this.getShape(e);r instanceof vt?r.setShape(0,0,t):this.shapes[e]=g.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){var i=t;if(typeof e<"u"&&(i=t[e]),typeof i>"u")throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(var r=0;r<i.length;r++)this.addVertices(i[r].shape,r);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),de(this.shapes,t);for(var e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=Z.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(typeof t<"u")if(typeof Z.types[t]<"u")this.collisionType=Z.types[t];else throw new Error("Invalid value for the collisionType property")}respondToCollision(t){var e=t.overlapV;if(this.ancestor.pos.sub(e),e.x!==0&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),e.y!==0&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){var i=this.falling===!0?1:this.jumping===!0?-1:0;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){var i=this,r=0,n=this.shapes,o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<o;)t.call(i,n[r],r,n),r++}contains(){var t,e;if(arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e)){for(var i=this.shapes.length,r;i--,r=this.shapes[i];)if(r.contains(t,e))return!0}return!1}rotate(t,e=this.getBounds().center){return this.bounds.clear(),this.forEach(i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds()),i instanceof At?this.bounds.translate(i.getBounds().x,i.getBounds().y):this.bounds.translate(i.pos)}),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){var e=W.tick;if(this.force.x!==0&&(this.vel.x+=this.force.x*e),this.force.y!==0&&(this.vel.y+=this.force.y*e),this.friction.x>0){var i=this.friction.x*e,r=this.vel.x+i,n=this.vel.x-i;this.vel.x=r<0?r:n>0?n:0}if(this.friction.y>0){var o=this.friction.y*e,h=this.vel.y+o,u=this.vel.y-o;this.vel.y=h<0?h:u>0?u:0}return this.vel.y!==0&&(this.vel.y=A(this.vel.y,-this.maxVel.y,this.maxVel.y)),this.vel.x!==0&&(this.vel.x=A(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=this.falling?!1:this.jumping,this.ancestor.pos.add(this.vel),this.vel.x!==0||this.vel.y!==0}destroy(){g.push(this.bounds),g.push(this.vel),g.push(this.force),g.push(this.friction),g.push(this.maxVel),this.shapes.forEach(t=>{g.push(t,!1)}),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}let sr=!1;try{sr=typeof globalThis<"u"&&typeof globalThis.localStorage<"u"}catch{sr=!1}B(ii,()=>{if(sr===!0){var s=globalThis.localStorage.getItem("me.save");if(typeof s=="string"&&s.length>0){var t=JSON.parse(s)||[];t.forEach(e=>{JSON.parse(globalThis.localStorage.getItem("me.save."+e))})}}});let As=!1,nr=!1;function Kt(){if(!nr){if(typeof globalThis.document<"u"&&!globalThis.document.body)return setTimeout(Kt,13);typeof globalThis.document<"u"&&typeof globalThis.document.removeEventListener=="function"&&globalThis.document.removeEventListener("DOMContentLoaded",Kt,!1),typeof globalThis.removeEventListener=="function"&&globalThis.removeEventListener("load",Kt,!1),I(ia),nr=!0}}function Qf(s){nr?s.call(globalThis,[]):(ha(ia,s,globalThis),As||(pa===!0||typeof globalThis.document<"u"&&globalThis.document.readyState==="complete"?globalThis.setTimeout(Kt,0):(typeof globalThis.document<"u"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("DOMContentLoaded",Kt,!1),globalThis.addEventListener("load",Kt,!1)),As=!0))}let Oe=!0,ie={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function Ss(s){return s.preventDefault(),typeof globalThis.scroll=="function"&&globalThis.scroll(0,0),!1}function Jf(){try{return!!globalThis.localStorage}catch{return!1}}function td(){try{return typeof globalThis.OffscreenCanvas<"u"&&new globalThis.OffscreenCanvas(0,0).getContext("2d")!==null}catch{return!1}}let ye=Lf;const ed="ontouchstart"in globalThis,id=!!globalThis.PointerEvent;typeof globalThis.document<"u"&&"onwheel"in globalThis.document.createElement("div");const _a=typeof screen<"u"&&typeof screen.orientation<"u",rd=typeof globalThis.document<"u"&&(fe("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);rd===!0&&(globalThis.document.exitFullscreen=fe("cancelFullScreen",globalThis.document)||fe("exitFullscreen",globalThis.document));const sd=!!(globalThis.AudioContext||globalThis.webkitAudioContext);Jf();const nd=td(),ad=typeof globalThis.navigator<"u"&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",xa=globalThis.devicePixelRatio||1;ye.isMobile;function od(s){Qf(s)}function hd(s){let t=id?"pointermove":ed?"touchmove":"mousemove";s!==!1?Oe===!1&&(globalThis.document.removeEventListener(t,Ss),Oe=!0):Oe===!0&&(globalThis.document.addEventListener(t,Ss,{passive:!1}),Oe=!1)}function ld(){const s="portrait",t="landscape";let e=globalThis.screen;if(_a===!0){let i=fe("orientation",e);if(typeof i<"u"&&typeof i.type=="string")return i.type;if(typeof i=="string")return i}return typeof globalThis.orientation=="number"?Math.abs(globalThis.orientation)===90?t:s:globalThis.outerWidth>globalThis.outerHeight?t:s}function ud(s){let t=wa(s);return t.parentNode!==null&&(t=t.parentNode),t}function wa(s){let t=null;return s!=="undefined"&&(typeof s=="string"?t=globalThis.document.getElementById(s):typeof s=="object"&&s.nodeType===Node.ELEMENT_NODE&&(t=s)),t||(t=globalThis.document.body),t}function ba(s){return typeof s=="object"&&s!==globalThis.document.body&&typeof s.getBoundingClientRect<"u"?s.getBoundingClientRect():(ie.width=ie.right=globalThis.innerWidth,ie.height=ie.bottom=globalThis.innerHeight,ie)}function fd(s){return ba(ud(s))}function dd(s){let t=!1;try{let e=globalThis.document.createElement("canvas"),i={stencil:!0,failIfMajorPerformanceCaveat:s.failIfMajorPerformanceCaveat};t=!!(globalThis.WebGLRenderingContext&&(e.getContext("webgl",i)||e.getContext("experimental-webgl",i)))}catch{t=!1}return t}function cd(){typeof globalThis.focus=="function"&&globalThis.focus()}const Ta=0,ar=1,Aa=2,pd=Ta,gd=ar,vd=Aa;let O=null;function yd(s,t,e){if(!br)throw new Error("me.video.init() called before engine initialization.");try{T.init(s,t,e)}catch(i){return console(i.message),!1}return O=T.renderer,globalThis.addEventListener("resize",q.function.throttle(i=>{I(oa,i)},100),!1),globalThis.addEventListener("orientationchange",i=>{I(Ne,i)},!1),globalThis.addEventListener("onmozorientationchange",i=>{I(Ne,i)},!1),_a===!0&&(globalThis.screen.orientation.onchange=function(i){I(Ne,i)}),globalThis.addEventListener("scroll",q.function.throttle(i=>{I(Mf,i)},100),!1),I(na),!0}function Qt(s,t,e=!1){var i;if(s===0||t===0)throw new Error("width or height was zero, Canvas could not be initialized !");return nd===!0&&e===!0?(i=new globalThis.OffscreenCanvas(0,0),typeof i.style>"u"&&(i.style={})):i=document.createElement("canvas"),i.width=s,i.height=t,i}function md(){return T.getParentElement()}var Es=Object.freeze({__proto__:null,AUTO:vd,CANVAS:pd,WEBGL:gd,createCanvas:Qt,getParent:md,init:yd,get renderer(){return O}});class _d{constructor(t){var e=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,typeof t.source<"u"){var i=t.source,r=Fr(i);if((r==="tsx"||r==="json")&&(t=z.getTMX(ti(i)),!t))throw new Error(i+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new C,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;var n=t.tiles;for(e in n)if(n.hasOwnProperty(e)){if("animation"in n[e]&&(this.isAnimated=!0,this.animations.set(n[+e].animation[0].tileid,{dt:0,idx:0,frames:n[+e].animation,cur:n[+e].animation[0]})),"properties"in n[e])if(Array.isArray(n[e].properties)){var o={};for(var h in n[e].properties)o[n[e].properties[h].name]=n[e].properties[h].value;this.setTileProperty(+n[e].id+this.firstgid,o)}else this.setTileProperty(+e+this.firstgid,n[e].properties);if("image"in n[e]){var u=z.getImage(n[e].image);if(!u)throw new Error("melonJS: '"+n[e].image+"' file for tile '"+(+e+this.firstgid)+"' not found!");this.imageCollection[+e+this.firstgid]=u}}this.isCollection=this.imageCollection.length>0;var f=t.tileoffset;f&&(this.tileoffset.x=+f.x,this.tileoffset.y=+f.y);var c=t.tileproperties;if(c)for(e in c)c.hasOwnProperty(e)&&this.setTileProperty(+e+this.firstgid,c[e]);if(this.isCollection===!1){if(this.image=z.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=O.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var a=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),l=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%a>0&&++l,this.lastgid=this.firstgid+(a*l-1||0),t.tilecount&&this.lastgid-this.firstgid+1!==+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){var e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){var e=0,i=W.getTime(),r=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach(n=>{for(n.dt+=t,e=n.cur.duration;n.dt>=e;)n.dt-=e,n.idx=(n.idx+1)%n.frames.length,n.cur=n.frames[n.idx],e=n.cur.duration,r=!0})),r}drawTile(t,e,i,r){if(r.flipped&&(t.save(),t.translate(e,i),t.transform(r.currentTransform),e=i=0),this.isCollection===!0)t.drawImage(this.imageCollection[r.tileId],0,0,r.width,r.height,e,i,r.width,r.height);else{var n=this.atlas[this.getViewTileId(r.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}r.flipped&&t.restore()}}const Sa=2147483648,Ea=1073741824,Ca=536870912,or=~(Sa|Ea|Ca),xd="collision";class wd{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){var e=-1;t&=or;for(var i=0,r=this.tilesets.length;i<r;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(e!==-1)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}function Ma(s,t,e){var i;if(typeof e!="string")return e;switch(t){case"int":case"float":e=Number(e);break;case"bool":e=e==="true";break;default:if(!e||Qn(e))e=e?e==="true":!0;else if(Br(e))e=Number(e);else if(e.search(/^json:/i)===0){i=e.split(/^json:/i)[1];try{e=JSON.parse(i)}catch{throw new Error("Unable to parse JSON: "+i)}}else if(e.search(/^eval:/i)===0){i=e.split(/^eval:/i)[1];try{e=Function("'use strict';return ("+i+")")()}catch{throw new Error("Unable to evaluate: "+i)}}else((i=e.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(i=e.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(e="#"+i[2]+i[1]);s.search(/^(ratio|anchorPoint)$/)===0&&typeof e=="number"&&(e={x:e,y:e})}return e}function bd(s,t){if(t.attributes&&t.attributes.length>0)for(var e=0;e<t.attributes.length;e++){var i=t.attributes.item(e);typeof i.name<"u"?s[i.name]=i.value:s[i.nodeName]=i.nodeValue}}function Td(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function Ad(s){for(var t=s.replace(`
`,"").trim().split(","),e=[],i=0;i<t.length;i++)e.push(+t[i]);return e}function Sd(s,t){t=t||1;var e,i,r,n=globalThis.atob(s.replace(/[^A-Za-z0-9\+\/\=]/g,"")),o=new Uint32Array(n.length/t);for(e=0,r=n.length/t;e<r;e++)for(o[e]=0,i=t-1;i>=0;--i)o[e]+=n.charCodeAt(e*t+i)<<(i<<3);return o}function qe(s,t,e){switch(e=e||"none",t=t||"none",t){case"csv":return Ad(s);case"base64":var i=Sd(s,4);return e==="none"?i:Td();case"none":return s;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+t)}}function Ed(s,t){var e=t.nodeName;switch(e){case"data":var i=K(t);i.encoding=i.encoding||"xml",typeof i.chunks<"u"&&(s.chunks=s.chunks||[],i.chunks.forEach(d=>{s.chunks.push({x:+d.x,y:+d.y,width:+d.width,height:+d.height,data:qe(d.text,i.encoding,i.compression)})}),s.encoding="none"),typeof i.text<"u"&&typeof s.chunks>"u"&&(s.data=qe(i.text,i.encoding,i.compression),s.encoding="none");break;case"chunk":s.chunks=s.chunks||[],s.chunks.push(K(t));break;case"imagelayer":case"layer":case"objectgroup":case"group":var r=K(t);r.type=e==="layer"?"tilelayer":e,r.image&&(r.image=r.image.source),s.layers=s.layers||[],s.layers.push(r);break;case"animation":s.animation=K(t).frames;break;case"frame":case"object":var n=e+"s";s[n]=s[n]||[],s[n].push(K(t));break;case"tile":var o=K(t);o.image&&(o.imagewidth=o.image.width,o.imageheight=o.image.height,o.image=o.image.source),s.tiles=s.tiles||{},s.tiles[o.id]=o;break;case"tileset":var h=K(t);h.image&&(h.imagewidth=h.image.width,h.imageheight=h.image.height,h.image=h.image.source),s.tilesets=s.tilesets||[],s.tilesets.push(h);break;case"polygon":case"polyline":s[e]=[];for(var u=K(t).points.split(" "),f=0,c;f<u.length;f++)c=u[f].split(","),s[e].push({x:+c[0],y:+c[1]});break;case"properties":s.properties=K(t);break;case"property":var a=K(t),l=typeof a.value<"u"?a.value:a.text;s[a.name]=Ma(a.name,a.type||"string",l);break;default:s[e]=K(t);break}}function K(s){var t={},e="";if(s.nodeType===1&&bd(t,s),s.hasChildNodes()){let i=s.childNodes;for(const r of i)switch(r.nodeType){case 1:Ed(t,r);break;case 3:e+=r.nodeValue.trim();break}}return e&&(t.text=e),t}function Jt(s,t){var e=t.properties,i=t.propertytypes;if(typeof e<"u"){for(var r in e)if(e.hasOwnProperty(r)){var n="string",o=r,h=e[r];typeof e[r].name<"u"&&(o=e[r].name),typeof i<"u"?n=i[r]:typeof e[r].type<"u"&&(n=e[r].type),typeof e[r].value<"u"&&(h=e[r].value),s[o]=Ma(o,n,h)}}}class zt{constructor(...t){this.onResetEvent(...t)}onResetEvent(){typeof this.val>"u"&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof zt?this.copy(arguments[0]):arguments.length===16?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,r,n,o,h,u,f,c,a,l,d,p,y,m){var v=this.val;return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=n,v[5]=o,v[6]=h,v[7]=u,v[8]=f,v[9]=c,v[10]=a,v[11]=l,v[12]=d,v[13]=p,v[14]=y,v[15]=m,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){var e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){var e=this.val,i=t.val,r=e[0],n=e[1],o=e[2],h=e[3],u=e[4],f=e[5],c=e[6],a=e[7],l=e[8],d=e[9],p=e[10],y=e[11],m=e[12],v=e[13],_=e[14],x=e[15],w=i[0],b=i[1],S=i[2],E=i[3];return e[0]=w*r+b*u+S*l+E*m,e[1]=w*n+b*f+S*d+E*v,e[2]=w*o+b*c+S*p+E*_,e[3]=w*h+b*a+S*y+E*x,w=i[4],b=i[5],S=i[6],E=i[7],e[4]=w*r+b*u+S*l+E*m,e[5]=w*n+b*f+S*d+E*v,e[6]=w*o+b*c+S*p+E*_,e[7]=w*h+b*a+S*y+E*x,w=i[8],b=i[9],S=i[10],E=i[11],e[8]=w*r+b*u+S*l+E*m,e[9]=w*n+b*f+S*d+E*v,e[10]=w*o+b*c+S*p+E*_,e[11]=w*h+b*a+S*y+E*x,w=i[12],b=i[13],S=i[14],E=i[15],e[12]=w*r+b*u+S*l+E*m,e[13]=w*n+b*f+S*d+E*v,e[14]=w*o+b*c+S*p+E*_,e[15]=w*h+b*a+S*y+E*x,this}transpose(){var t=this.val,e=t[1],i=t[2],r=t[3],n=t[6],o=t[7],h=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=r,t[13]=o,t[14]=h,this}invert(){var t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],h=t[5],u=t[6],f=t[7],c=t[8],a=t[9],l=t[10],d=t[11],p=t[12],y=t[13],m=t[14],v=t[15],_=e*h-i*o,x=e*u-r*o,w=e*f-n*o,b=i*u-r*h,S=i*f-n*h,E=r*f-n*u,F=c*y-a*p,P=c*m-l*p,U=c*v-d*p,G=a*m-l*y,j=a*v-d*y,H=l*v-d*m,R=_*H-x*j+w*G+b*U-S*P+E*F;return R?(R=1/R,t[0]=(h*H-u*j+f*G)*R,t[1]=(r*j-i*H-n*G)*R,t[2]=(y*E-m*S+v*b)*R,t[3]=(l*S-a*E-d*b)*R,t[4]=(u*U-o*H-f*P)*R,t[5]=(e*H-r*U+n*P)*R,t[6]=(m*w-p*E-v*x)*R,t[7]=(c*E-l*w+d*x)*R,t[8]=(o*j-h*U+f*F)*R,t[9]=(i*U-e*j-n*F)*R,t[10]=(p*S-y*w+v*_)*R,t[11]=(a*w-c*S-d*_)*R,t[12]=(h*P-o*G-u*F)*R,t[13]=(e*G-i*P+r*F)*R,t[14]=(y*x-p*b-m*_)*R,t[15]=(c*b-a*x+l*_)*R,this):null}apply(t){var e=this.val,i=t.x,r=t.y,n=typeof t.z<"u"?t.z:1,o=e[3]*i+e[7]*r+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*r+e[8]*n+e[12])/o,t.y=(e[1]*i+e[5]*r+e[9]*n+e[13])/o,typeof t.z<"u"&&(t.z=(e[2]*i+e[6]*r+e[10]*n+e[14])/o),t}applyInverse(t){var e=g.pull("Matrix3d",this).invert();return e.apply(t),g.push(e),t}ortho(t,e,i,r,n,o){var h=this.val,u=1/(t-e),f=1/(i-r),c=1/(n-o);return h[0]=-2*u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*f,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*c,h[11]=0,h[12]=(t+e)*u,h[13]=(r+i)*f,h[14]=(o+n)*c,h[15]=1,this}scale(t,e,i){var r=this.val,n=t,o=typeof e>"u"?n:e,h=typeof i>"u"?0:i;return r[0]=r[0]*n,r[1]=r[1]*n,r[2]=r[2]*n,r[3]=r[3]*n,r[4]=r[4]*o,r[5]=r[5]*o,r[6]=r[6]*o,r[7]=r[7]*o,r[8]=r[8]*h,r[9]=r[9]*h,r[10]=r[10]*h,r[11]=r[11]*h,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(t!==0){var i=this.val,r=e.x,n=e.y,o=e.z,h=Math.sqrt(r*r+n*n+o*o),u,f,c,a,l,d,p,y,m,v,_,x,w,b,S,E,F,P,U,G,j,H,R,St;if(h<sf)return null;h=1/h,r*=h,n*=h,o*=h,u=Math.sin(t),f=Math.cos(t),c=1-f,a=i[0],l=i[1],d=i[2],p=i[3],y=i[4],m=i[5],v=i[6],_=i[7],x=i[8],w=i[9],b=i[10],S=i[11],E=r*r*c+f,F=n*r*c+o*u,P=o*r*c-n*u,U=r*n*c-o*u,G=n*n*c+f,j=o*n*c+r*u,H=r*o*c+n*u,R=n*o*c-r*u,St=o*o*c+f,i[0]=a*E+y*F+x*P,i[1]=l*E+m*F+w*P,i[2]=d*E+v*F+b*P,i[3]=p*E+_*F+S*P,i[4]=a*U+y*G+x*j,i[5]=l*U+m*G+w*j,i[6]=d*U+v*G+b*j,i[7]=p*U+_*G+S*j,i[8]=a*H+y*R+x*St,i[9]=l*H+m*R+w*St,i[10]=d*H+v*R+b*St,i[11]=p*H+_*R+S*St}return this}translate(){var t=this.val,e,i,r;return arguments.length>1?(e=arguments[0],i=arguments[1],r=typeof arguments[2]>"u"?0:arguments[2]):(e=arguments[0].x,i=arguments[0].y,r=typeof arguments[0].z>"u"?0:arguments[0].z),t[12]=t[0]*e+t[4]*i+t[8]*r+t[12],t[13]=t[1]*e+t[5]*i+t[9]*r+t[13],t[14]=t[2]*e+t[6]*i+t[10]*r+t[14],t[15]=t[3]*e+t[7]*i+t[11]*r+t[15],this}isIdentity(){var t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return g.pull("Matrix3d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}class Vt{constructor(...t){this.onResetEvent(...t)}onResetEvent(){return typeof this.val>"u"&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof Vt?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof zt?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){var t=this.val;return arguments.length===9?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):arguments.length===6&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}copy(t){return this.val.set(t.val),this}fromMat3d(t){var e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){var e=t.val,i=this.val,r=i[0],n=i[1],o=i[3],h=i[4],u=e[0],f=e[1],c=e[3],a=e[4],l=e[6],d=e[7];return i[0]=r*u+o*f,i[1]=n*u+h*f,i[3]=r*c+o*a,i[4]=n*c+h*a,i[6]+=r*l+o*d,i[7]+=n*l+h*d,this}transpose(){var t=this.val,e=t[1],i=t[2],r=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=r,this}invert(){var t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],h=t[5],u=t[6],f=t[7],c=t[8],a=c*o-h*f,l=h*u-c*n,d=f*n-o*u,p=e*a+i*l+r*d;return t[0]=a/p,t[1]=(r*f-c*i)/p,t[2]=(h*i-r*o)/p,t[3]=l/p,t[4]=(c*e-r*u)/p,t[5]=(r*n-h*e)/p,t[6]=d/p,t[7]=(i*u-f*e)/p,t[8]=(o*e-i*n)/p,this}apply(t){var e=this.val,i=t.x,r=t.y,n=typeof t.z<"u"?t.z:1;return t.x=i*e[0]+r*e[3]+n*e[6],t.y=i*e[1]+r*e[4]+n*e[7],typeof t.z<"u"&&(t.z=i*e[2]+r*e[5]+n*e[8]),t}applyInverse(t){var e=this.val,i=t.x,r=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*r+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*r+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e){var i=this.val,r=t,n=typeof e>"u"?r:e;return i[0]*=r,i[1]*=r,i[3]*=n,i[4]*=n,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(t!==0){var e=this.val,i=e[0],r=e[1],n=e[2],o=e[3],h=e[4],u=e[5],f=Math.sin(t),c=Math.cos(t);e[0]=c*i+f*o,e[1]=c*r+f*h,e[2]=c*n+f*u,e[3]=c*o-f*i,e[4]=c*h-f*r,e[5]=c*u-f*n}return this}translate(){var t=this.val,e,i;return arguments.length===2?(e=arguments[0],i=arguments[1]):(e=arguments[0].x,i=arguments[0].y),t[6]+=t[0]*e+t[3]*i,t[7]+=t[1]*e+t[4]*i,this}isIdentity(){var t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===1&&t[5]===0&&t[6]===0&&t[7]===0&&t[8]===1}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return g.pull("Matrix2d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}function Et(s){return"0123456789ABCDEF".charAt(s-s%16>>4)+"0123456789ABCDEF".charAt(s%16)}function Li(s,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+(t-s)*6*e:e<1/2?t:e<2/3?s+(t-s)*(2/3-e)*6:s}const Cd=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,Md=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Pd=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Id=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Rd=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;var hr=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach(s=>{hr.set(s[0],s[1])});class N{constructor(t=0,e=0,i=0,r=1){this.onResetEvent(t,e,i,r)}onResetEvent(t=0,e=0,i=0,r=1){return typeof this.glArray>"u"&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,r)}get r(){return~~(this.glArray[0]*255)}set r(t){this.glArray[0]=A(~~t||0,0,255)/255}get g(){return~~(this.glArray[1]*255)}set g(t){this.glArray[1]=A(~~t||0,0,255)/255}get b(){return~~(this.glArray[2]*255)}set b(t){this.glArray[2]=A(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t){this.glArray[3]=typeof t>"u"?1:A(+t,0,1)}setColor(t,e,i,r=1){return this.r=t,this.g=e,this.b=i,this.alpha=r,this}setHSV(t,e,i){var r,n,o,h=Math.floor(t*6),u=t*6-h,f=i*(1-e),c=i*(1-u*e),a=i*(1-(1-u)*e);switch(h%6){case 0:r=i,n=a,o=f;break;case 1:r=c,n=i,o=f;break;case 2:r=f,n=i,o=a;break;case 3:r=f,n=c,o=i;break;case 4:r=a,n=f,o=i;break;case 5:r=i,n=f,o=c;break}return this.setColor(r*255,n*255,o*255)}setHSL(t,e,i){var r,n,o;if(e===0)r=n=o=i;else{var h=i<.5?i*(1+e):i+e-i*e,u=2*i-h;r=Li(u,h,t+1/3),n=Li(u,h,t),o=Li(u,h,t-1/3)}return this.setColor(r*255,n*255,o*255)}clone(){return g.pull("Color").copy(this)}copy(t){return t instanceof N?(this.glArray.set(t.glArray),this):this.parseCSS(t)}add(t){return this.glArray[0]=A(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=A(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=A(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=A(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=A(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=A(t,0,1),this.glArray[0]=A(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=A(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=A(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(Ve(t,e),Ve(t,e),Ve(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return hr.has(t)?this.setColor.apply(this,hr.get(t)):this.parseRGB(t)}parseRGB(t){var e=Cd.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){var i;if(i=Rd.exec(t))return this.setColor(parseInt(i[e===!1?1:2],16),parseInt(i[e===!1?2:3],16),parseInt(i[e===!1?3:4],16),(A(parseInt(i[e===!1?4:1],16),0,255)/255).toFixed(1));if(i=Id.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=Pd.exec(t)){var r=i[e===!1?1:2],n=i[e===!1?2:3],o=i[e===!1?3:4],h=i[e===!1?4:1];return this.setColor(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),(A(parseInt(h+h,16),0,255)/255).toFixed(1))}if(i=Md.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){var e=this.r&255,i=this.g&255,r=this.b&255,n=t*255&255;return(n<<24)+(e<<16)+(i<<8)+r}toArray(){return this.glArray}toHex(){return"#"+Et(this.r)+Et(this.g)+Et(this.b)}toHex8(t=this.alpha){return"#"+Et(this.r)+Et(this.g)+Et(this.b)+Et(t*255)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}const Od={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function Bd(s,t){var e={},i=/uniform\s+(\w+)\s+(\w+)/g,r={},n={},o={},h;return[t.vertex,t.fragment].forEach(u=>{for(;h=i.exec(u);)r[h[2]]=h[1]}),Object.keys(r).forEach(u=>{var f=r[u];o[u]=s.getUniformLocation(t.program,u),n[u]={get:function(c){return function(){return o[c]}}(u),set:function(c,a,l){return a.indexOf("mat")===0?function(d){s[l](o[c],!1,d)}:function(d){var p=l;d.length&&l.slice(-1)!=="v"&&(p+="v"),s[p](o[c],d)}}(u,f,"uniform"+Od[f])}}),Object.defineProperties(e,n),e}function Ld(s,t){for(var e={},i=/attribute\s+\w+\s+(\w+)/g,r,n=0;r=i.exec(t.vertex);)e[r[1]]=n++;return e}function Cs(s,t,e){var i=s.createShader(t);if(s.shaderSource(i,e),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(i));return i}function Dd(s,t,e,i){var r=Cs(s,s.VERTEX_SHADER,t),n=Cs(s,s.FRAGMENT_SHADER,e),o=s.createProgram();s.attachShader(o,r),s.attachShader(o,n);for(var h in i)s.bindAttribLocation(o,i[h],h);if(s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS)){var u="Error initializing Shader "+this+`
gl.VALIDATE_STATUS: `+s.getProgramParameter(o,s.VALIDATE_STATUS)+`
gl.getError()`+s.getError()+`
gl.getProgramInfoLog()`+s.getProgramInfoLog(o);throw s.deleteProgram(o),o=null,new Error(u)}return s.useProgram(o),s.deleteShader(r),s.deleteShader(n),o}function Ms(s,t){return s.substring(0,9)!=="precision"?"precision "+t+" float;"+s:s}function Ps(s){return s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0?"highp":s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function Is(s){return s=s.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"),s=s.replace(/(\\n\s+)|(\s+\\n)/g,""),s=s.replace(/(\\r|\\n)+/g,""),s=s.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1"),s}class Rs{constructor(t,e,i,r){this.gl=t,this.vertex=Ms(Is(e),r||Ps(this.gl)),this.fragment=Ms(Is(i),r||Ps(this.gl)),this.attributes=Ld(this.gl,this),this.program=Dd(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=Bd(this.gl,this),B(zr,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){var e=this.attributes[t];return typeof e<"u"?e:-1}setUniform(t,e){var i=this.uniforms;if(typeof i[t]<"u")typeof e=="object"&&typeof e.toArray=="function"?i[t]=e.toArray():i[t]=e;else throw new Error("undefined ("+t+") uniform for shader "+this)}setVertexAttributes(t,e,i){for(var r=0;r<e.length;++r){var n=e[r],o=this.getAttribLocation(n.name);o!==-1?(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,i,n.offset)):t.disableVertexAttribArray(r)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class Fd{constructor(t,e){this.vertexSize=t,this.quadSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.quadSize){return this.vertexCount+t>=this.maxVertex}resize(){this.maxVertex<<=1;var t=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(t),this}push(t,e,i,r,n){var o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(),this.bufferF32[o+0]=t,this.bufferF32[o+1]=e,typeof i<"u"&&(this.bufferF32[o+2]=i,this.bufferF32[o+3]=r),typeof n<"u"&&(this.bufferU32[o+4]=n),this.vertexCount++,this}toFloat32(t,e){return typeof e<"u"?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return typeof e<"u"?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return this.vertexCount===0}}var kd=`// Current vertex point
attribute vec2 aVertex;

// Projection matrix
uniform mat4 uProjectionMatrix;

// Vertex color
uniform vec4 uColor;

// Fragment color
varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(uColor.rgb * uColor.a, uColor.a);
}
`,zd=`varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
`,Vd=`attribute vec2 aVertex;
attribute vec2 aRegion;
attribute vec4 aColor;

uniform mat4 uProjectionMatrix;

varying vec2 vRegion;
varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
    vRegion = aRegion;
}
`,Nd=`uniform sampler2D uSampler;
varying vec4 vColor;
varying vec2 vRegion;

void main(void) {
    gl_FragColor = texture2D(uSampler, vRegion) * vColor;
}
`,Be=[new C,new C,new C,new C];class Ud{constructor(t){this.init(t)}init(t){var e=t.gl;this.currentTextureUnit=-1,this.boundTextures=[],this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.activeShader=null,this.mode=e.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.primitiveShader=new Rs(this.gl,kd,zd),this.quadShader=new Rs(this.gl,Vd,Nd),this.addAttribute("aVertex",2,e.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,e.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,e.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT),this.vertexBuffer=new Fd(this.vertexSize,6),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,this.vertexBuffer.buffer,e.STREAM_DRAW),B(si,(i,r)=>{this.flush(),this.setViewport(0,0,i,r)})}reset(){this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getCanvas().width,this.renderer.getCanvas().height),this.clearColor(0,0,0,0);for(var t=0;t<this.renderer.maxTextures;t++){var e=this.getTexture2D(t);typeof e<"u"&&this.deleteTexture2D(e)}this.currentTextureUnit=-1,this.useShader(this.quadShader)}addAttribute(t,e,i,r,n){switch(this.attributes.push({name:t,size:e,type:i,normalized:r,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setViewport(t,e,i,r){this.gl.viewport(t,e,i,r)}createTexture2D(t,e,i,r="no-repeat",n,o,h,u=!0,f=!0){var c=this.gl,a=bt(n||e.width)&&bt(o||e.height),l=c.createTexture(),d=r.search(/^repeat(-x)?$/)===0&&(a||this.renderer.WebGLVersion>1)?c.REPEAT:c.CLAMP_TO_EDGE,p=r.search(/^repeat(-y)?$/)===0&&(a||this.renderer.WebGLVersion>1)?c.REPEAT:c.CLAMP_TO_EDGE;return this.bindTexture2D(l,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,p),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,i),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),n||o||h?c.texImage2D(c.TEXTURE_2D,0,c.RGBA,n,o,h,c.RGBA,c.UNSIGNED_BYTE,e):c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e),a&&f!==!1&&c.generateMipmap(c.TEXTURE_2D),l}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){var i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return typeof e>"u"&&(e=this.boundTextures.indexOf(t)),e!==-1&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,r,n=!1){var o=this.renderer.cache.getUnit(t),h=this.boundTextures[o];return typeof h>"u"||n?this.createTexture2D(o,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,r,t.premultipliedAlpha):this.bindTexture2D(h,o),this.currentTextureUnit}setProjection(t){this.activeShader.setUniform("uProjectionMatrix",t)}useShader(t){this.activeShader!==t&&(this.flush(),this.activeShader=t,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),this.activeShader.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize))}addQuad(t,e,i,r,n,o,h,u,f,c){if(!(this.color.alpha<1/255)){this.useShader(this.quadShader),this.vertexBuffer.isFull(6)&&this.flush();var a=this.uploadTexture(t);this.quadShader.setUniform("uSampler",a);var l=this.viewMatrix,d=Be[0].set(e,i),p=Be[1].set(e+r,i),y=Be[2].set(e,i+n),m=Be[3].set(e+r,i+n);l.isIdentity()||(l.apply(d),l.apply(p),l.apply(y),l.apply(m)),this.vertexBuffer.push(d.x,d.y,o,h,c),this.vertexBuffer.push(p.x,p.y,u,h,c),this.vertexBuffer.push(y.x,y.y,o,f,c),this.vertexBuffer.push(y.x,y.y,o,f,c),this.vertexBuffer.push(p.x,p.y,u,h,c),this.vertexBuffer.push(m.x,m.y,u,f,c)}}flush(t=this.mode){var e=this.vertexBuffer,i=e.vertexCount;if(i>0){var r=this.gl,n=e.vertexSize;this.renderer.WebGLVersion>1?r.bufferData(r.ARRAY_BUFFER,e.toFloat32(),r.STREAM_DRAW,0,i*n):r.bufferData(r.ARRAY_BUFFER,e.toFloat32(0,i*n),r.STREAM_DRAW),r.drawArrays(t,0,i),e.clear()}}drawVertices(t,e,i=e.length){this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var r=this.viewMatrix,n=this.vertexBuffer,o=r.isIdentity(),h=0;h<i;h++)o||r.apply(e[h]),n.push(e[h].x,e[h].y);this.flush(t)}clear(t=0){var e=this.gl;e.clearColor(0,0,0,t),e.clear(e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}clearColor(t=0,e=0,i=0,r=0){var n=this.gl;n.clearColor(t,e,i,r),n.clear(n.COLOR_BUFFER_BIT)}}class te extends J{constructor(t,e,i,r,n=20){super(t,e,i,r),this.radius=n}onResetEvent(t,e,i,r,n){super.setShape(t,e,i,r),this.radius=n}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){var t=arguments[0],e,i;if(arguments.length===2)e=t,i=arguments[1];else{if(t instanceof J)return super.contains(t);e=t.x,i=t.y}if(e<this.left||e>=this.right||i<this.top||i>=this.bottom)return!1;if(e>=this.left+this.radius&&e<=this.right-this.radius||i>=this.top+this.radius&&i<=this.bottom-this.radius)return!0;var r,n,o=Math.max(0,Math.min(this.radius,this.width/2)),h=Math.max(0,Math.min(this.radius,this.height/2));if(e<this.left+o&&i<this.top+h)r=e-this.left-o,n=i-this.top-h;else if(e>this.right-o&&i<this.top+h)r=e-this.right+o,n=i-this.top-h;else if(e>this.right-o&&i>this.bottom-h)r=e-this.right+o,n=i-this.bottom+h;else if(e<this.left+o&&i>this.bottom-h)r=e-this.left-o,n=i-this.bottom+h;else return!1;return r*r+n*n<=o*h}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new te(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}class me extends vt{contains(){var t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;var i=this.points[0],r=this.points[1];return(e-i.y)*(r.x-i.x)===(r.y-i.y)*(t-i.x)}recalc(){var t=this.edges,e=this.normals,i=this.indices,r=this.points;if(r.length!==2)throw new Error("Requires exactly 2 points");return t[0]===void 0&&(t[0]=g.pull("Vector2d")),t[0].copy(r[1]).sub(r[0]),e[0]===void 0&&(e[0]=g.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){var t=[];return this.points.forEach(e=>{t.push(e.clone())}),new me(this.pos.x,this.pos.y,t)}}class Gd{constructor(){this.points=[],this.arcResolution=5,this.vertices=[]}beginPath(){this.points.forEach(t=>{g.push(t)}),this.points.length=0}closePath(){var t=this.points;t.length>1&&!t[t.length-1].equals(t[0])&&t.push(g.pull("Vector2d",t[0].x,t[0].y))}triangulatePath(){var t=0,e=this.points,i=this.vertices,r=ce(e.flatMap(n=>[n.x,n.y]));for(t=0;t<r.length;t++)typeof i[t]>"u"&&(i[t]=g.pull("Vector2d")),i[t].set(e[r[t]].x,e[r[t]].y);for(;i.length>r.length;)g.push(i[i.length-1]),i.length-=1;return i}moveTo(t,e){this.points.push(g.pull("Vector2d",t,e))}lineTo(t,e){this.points.push(g.pull("Vector2d",t,e))}arc(t,e,i,r,n,o=!1){var h=this.points;if(r!==n){var u=o?Math.abs(r-n)>=k:Math.abs(n-r)>=k;r=r%k,n=n%k,r<0&&(r+=k),n<0&&(n+=k),r>=n&&(n+=k);var f=n-r,c=1;o&&(c=-1,f=k-f),u&&(f=k);for(var a=f*i,l=a/this.arcResolution,d=f/l,p=r,y=0;y<l;y++)h.push(g.pull("Vector2d",t+i*Math.cos(p),e+i*Math.sin(p))),p+=c*d;h.push(g.pull("Vector2d",t+i*Math.cos(n),e+i*Math.sin(n)))}}arcTo(t,e,i,r,n){var o=this.points,h=o[o.length-1].x,u=o[o.length-1].y,f=[h-t,u-e],c=[i-t,r-e],a=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)),l=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2));f[0]/=a,f[1]/=a,c[0]/=l,c[1]/=l;var d=Math.atan2(f[1],f[0])-Math.atan2(c[1],c[0]),p=Math.tan(d/2),y=n/p,m=[t+f[0]*y,e+f[1]*y],v=[t+c[0]*y,e+c[1]*y];o.push(g.pull("Vector2d",m[0],m[1]));var _=[(f[0]+c[0])/2,(f[1]+c[1])/2],x=Math.sqrt(Math.pow(_[0],2)+Math.pow(_[1],2));_[0]/=x,_[1]/=x;var w=Math.sqrt(Math.pow(n,2)+Math.pow(y,2)),b=[t+w*_[0],e+w*_[1]],S=Math.atan2(m[1]-b[1],m[0]-b[0]),E=Math.atan2(v[1]-b[1],v[0]-b[0]);this.arc(b[0],b[1],n,S,E)}ellipse(t,e,i,r,n,o,h,u=!1){var f=this.points;if(o!==h){var c=u?Math.abs(o-h)>=k:Math.abs(h-o)>=k;o=o%k,h=h%k,o<0&&(o+=k),h<0&&(h+=k),o>=h&&(h+=k);var a=h-o,l=1;u&&(l=-1,a=k-a),c&&(a=k);for(var d=(a*i+a*r)/2,p=d/this.arcResolution,y=a/p,m=o,v=Math.cos(n),_=Math.sin(n),x=0;x<p;x++){var w=i*Math.cos(m),b=r*Math.sin(m),S=t+w*v-b*_,E=e+w*_+b*v;f.push(g.pull("Vector2d",S,E)),m+=l*y}}}rect(t,e,i,r){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+r),this.lineTo(t,e+r),this.lineTo(t,e)}roundRect(t,e,i,r,n){this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.arcTo(t+i,e,t+i,e+n,n),this.lineTo(t+i,e+r-n),this.arcTo(t+i,e+r,t+i-n,e+r,n),this.lineTo(t+n,e+r),this.arcTo(t,e+r,t,e+r-n,n),this.lineTo(t,e+n),this.arcTo(t,e,t+n,e,n)}}class Ae{constructor(t){this.settings=t,this.designRatio=this.settings.width/this.settings.height,this.scaleRatio=new C(this.settings.scale,this.settings.scale),this.isContextValid=!0,this.path2D=new Gd,this.type="Generic",this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",ye.ejecta===!0?this.canvas=document.getElementById("canvas"):typeof globalThis.canvas<"u"?this.canvas=globalThis.canvas:typeof this.settings.canvas<"u"?this.canvas=this.settings.canvas:this.canvas=Qt(this.settings.width,this.settings.height),this.currentColor=new N(0,0,0,1),this.currentTint=new N(255,255,255,1),this.projectionMatrix=new zt,this.uvOffset=0,B(ri,()=>{this.reset()})}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height,this.clearMask()}getCanvas(){return this.canvas}getContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(typeof t>"u"||t===null)throw new Error("You must pass a canvas element in order to create a 2d context");if(typeof t.getContext>"u")throw new Error("Your browser does not support HTML5 canvas.");typeof e!="boolean"&&(e=!0);var i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getWidth(){return this.getCanvas().width}getHeight(){return this.getCanvas().height}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.getWidth()&&t.right>=0&&t.top<=this.getHeight()&&t.bottom>=0}resize(t,e){var i=this.getCanvas();(t!==i.width||e!==i.height)&&(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,I(si,t,e))}setAntiAlias(t,e){var i=t.canvas;Dr("imageSmoothingEnabled",e===!0,t),e!==!0?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){if(t instanceof te){this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);return}if(t instanceof J||t instanceof Y){this.strokeRect(t.left,t.top,t.width,t.height,e);return}if(t instanceof me||t instanceof vt){this.strokePolygon(t,e);return}if(t instanceof At){this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);return}if(t instanceof Zt){this.strokePoint(t.x,t.y);return}throw new Error("Invalid geometry for fill/stroke")}fill(t){this.stroke(t,!0)}tint(t,e,i){var r=Qt(t.width,t.height,!0),n=this.getContext2d(r);return n.save(),n.fillStyle=e instanceof N?e.toRGB():e,n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation=i||"multiply",n.drawImage(t,0,0),n.globalCompositeOperation="destination-atop",n.drawImage(t,0,0),n.restore(),r}setMask(t){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setColor(255,255,255,1)}drawFont(){}}var Pa={},oi={},Se={},Os=V&&V.__generator||function(s,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,r,n,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(f){return function(c){return u([f,c])}}function u(f){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,r&&(n=f[0]&2?r.return:f[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,f[1])).done)return n;switch(r=0,n&&(f=[f[0]&2,n.value]),f[0]){case 0:case 1:n=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,r=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!n||f[1]>n[0]&&f[1]<n[3])){e.label=f[1];break}if(f[0]===6&&e.label<n[1]){e.label=n[1],n=f;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(f);break}n[2]&&e.ops.pop(),e.trys.pop();continue}f=t.call(s,e)}catch(c){f=[6,c],r=0}finally{i=n=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},_t=V&&V.__values||function(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],i=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},re=V&&V.__read||function(s,t){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var i=e.call(s),r,n=[],o;try{for(;(t===void 0||t-- >0)&&!(r=i.next()).done;)n.push(r.value)}catch(h){o={error:h}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return n};Object.defineProperty(Se,"__esModule",{value:!0});Se.Multimap=void 0;var Hd=function(){function s(t,e){var i,r;if(this.size_=0,this.map=new Map,this.operator=t,e)try{for(var n=_t(e),o=n.next();!o.done;o=n.next()){var h=re(o.value,2),u=h[0],f=h[1];this.put(u,f)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return this}return Object.defineProperty(s.prototype,"size",{get:function(){return this.size_},enumerable:!1,configurable:!0}),s.prototype.get=function(t){var e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()},s.prototype.put=function(t,e){var i=this.map.get(t);return i||(i=this.operator.create()),this.operator.add(e,i)?(this.map.set(t,i),this.size_++,!0):!1},s.prototype.putAll=function(t,e){var i,r,n,o,h=0;if(e){var u=t,f=e;try{for(var c=_t(f),a=c.next();!a.done;a=c.next()){var l=a.value;this.put(u,l),h++}}catch(m){i={error:m}}finally{try{a&&!a.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}else if(t instanceof s)try{for(var d=_t(t.entries()),p=d.next();!p.done;p=d.next()){var y=re(p.value,2),u=y[0],l=y[1];this.put(u,l),h++}}catch(m){n={error:m}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}else throw new TypeError("unexpected arguments");return h>0},s.prototype.has=function(t){return this.map.has(t)},s.prototype.hasEntry=function(t,e){return this.operator.has(e,this.get(t))},s.prototype.delete=function(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)},s.prototype.deleteEntry=function(t,e){var i=this.get(t);return this.operator.delete(e,i)?(this.map.set(t,i),this.size_--,!0):!1},s.prototype.clear=function(){this.map.clear(),this.size_=0},s.prototype.keys=function(){return this.map.keys()},s.prototype.entries=function(){var t=this;function e(){var i,r,n,o,h,u,f,c,a,l,d,p,y,m;return Os(this,function(v){switch(v.label){case 0:v.trys.push([0,11,12,13]),i=_t(t.map.entries()),r=i.next(),v.label=1;case 1:if(r.done)return[3,10];n=re(r.value,2),o=n[0],h=n[1],v.label=2;case 2:v.trys.push([2,7,8,9]),u=(y=void 0,_t(h)),f=u.next(),v.label=3;case 3:return f.done?[3,6]:(c=f.value,[4,[o,c]]);case 4:v.sent(),v.label=5;case 5:return f=u.next(),[3,3];case 6:return[3,9];case 7:return a=v.sent(),y={error:a},[3,9];case 8:try{f&&!f.done&&(m=u.return)&&m.call(u)}finally{if(y)throw y.error}return[7];case 9:return r=i.next(),[3,1];case 10:return[3,13];case 11:return l=v.sent(),d={error:l},[3,13];case 12:try{r&&!r.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}return[7];case 13:return[2]}})}return e()},s.prototype.values=function(){var t=this;function e(){var i,r,n,o,h,u,f;return Os(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),i=_t(t.entries()),r=i.next(),c.label=1;case 1:return r.done?[3,4]:(n=re(r.value,2),o=n[1],[4,o]);case 2:c.sent(),c.label=3;case 3:return r=i.next(),[3,1];case 4:return[3,7];case 5:return h=c.sent(),u={error:h},[3,7];case 6:try{r&&!r.done&&(f=i.return)&&f.call(i)}finally{if(u)throw u.error}return[7];case 7:return[2]}})}return e()},s.prototype.forEach=function(t,e){var i,r;try{for(var n=_t(this.entries()),o=n.next();!o.done;o=n.next()){var h=re(o.value,2),u=h[0],f=h[1];t.call(e===void 0?this:e,f,u,this)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},s.prototype[Symbol.iterator]=function(){return this.entries()},s.prototype.asMap=function(){var t,e,i=new Map;try{for(var r=_t(this.keys()),n=r.next();!n.done;n=r.next()){var o=n.value;i.set(o,this.operator.clone(this.get(o)))}}catch(h){t={error:h}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return i},s}();Se.Multimap=Hd;var Xd=V&&V.__extends||function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},s(t,e)};return function(t,e){s(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(oi,"__esModule",{value:!0});oi.ArrayMultimap=void 0;var $d=Se,Yd=function(s){Xd(t,s);function t(e){return s.call(this,new jd,e)||this}return Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"ArrayMultimap"},enumerable:!1,configurable:!0}),t}($d.Multimap);oi.ArrayMultimap=Yd;var jd=function(){function s(){}return s.prototype.create=function(){return[]},s.prototype.clone=function(t){return t.slice()},s.prototype.add=function(t,e){return e.push(t),!0},s.prototype.size=function(t){return t.length},s.prototype.delete=function(t,e){var i=e.indexOf(t);return i>-1?(e.splice(i,1),!0):!1},s.prototype.has=function(t,e){return e.includes(t)},s}(),hi={},Wd=V&&V.__extends||function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},s(t,e)};return function(t,e){s(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(hi,"__esModule",{value:!0});hi.SetMultimap=void 0;var qd=Se,Kd=function(s){Wd(t,s);function t(e){return s.call(this,new Zd,e)||this}return Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"SetMultimap"},enumerable:!1,configurable:!0}),t}(qd.Multimap);hi.SetMultimap=Kd;var Zd=function(){function s(){}return s.prototype.create=function(){return new Set},s.prototype.clone=function(t){return new Set(t)},s.prototype.add=function(t,e){var i=e.size;return e.add(t),i!==e.size},s.prototype.size=function(t){return t.size},s.prototype.delete=function(t,e){return e.delete(t)},s.prototype.has=function(t,e){return e.has(t)},s}();(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.SetMultimap=s.ArrayMultimap=void 0;var t=oi;Object.defineProperty(s,"ArrayMultimap",{enumerable:!0,get:function(){return t.ArrayMultimap}});var e=hi;Object.defineProperty(s,"SetMultimap",{enumerable:!0,get:function(){return e.SetMultimap}})})(Pa);class Vr{constructor(t){this.cache=new Pa.ArrayMultimap,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}validate(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}get(t,e){var i;return typeof e>"u"?i=this.cache.get(t)[0]:this.cache.forEach((r,n)=>{var o=r.getAtlas();n===t&&o[0].width===e.framewidth&&o[0].height===e.frameheight&&(i=r)}),typeof i>"u"&&(e||(e=lr(t.width,t.height,t.src?ti(t.src):void 0)),i=new _e(e,t,!1),this.set(t,i)),i}delete(t){this.cache.has(t)||this.cache.delete(t)}tint(t,e){var i=this.tinted.get(t);return i===void 0&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,O.tint(t,e,"multiply")),i.get(e)}set(t,e){var i=t.width,r=t.height;if(O.WebGLVersion===1&&(!bt(i)||!bt(r))){var n=typeof t.src<"u"?t.src:t;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+r+")")}return this.cache.put(t,e)}getUnit(t){return this.units.has(t)||(this.validate(),this.units.set(t,this.length++)),this.units.get(t)}}class Ke extends Ae{constructor(t){super(t),this.WebGLVersion=1,this.GPUVendor=null,this.GPURenderer=null,this.context=this.gl=this.getContextGL(this.getCanvas(),t.transparent),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Vt,this.currentCompositor=null,this.compositors=new Map;var e=new(this.settings.compositor||Ud)(this);this.compositors.set("default",e),this.setCompositor(e),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);var i=this.gl.getExtension("WEBGL_debug_renderer_info");i!==null&&(this.GPUVendor=this.gl.getParameter(i.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(i.UNMASKED_RENDERER_WEBGL)),this.cache=new Vr(this.maxTextures),this.type="WebGL"+this.WebGLVersion,this.getCanvas().addEventListener("webglcontextlost",r=>{r.preventDefault(),this.isContextValid=!1,I(zr,this)},!1),this.getCanvas().addEventListener("webglcontextrestored",()=>{this.reset(),this.isContextValid=!0,I(We,this)},!1)}reset(){super.reset(),this.compositors.forEach(t=>{this.isContextValid===!1?t.init(this):t.reset()}),this.gl.disable(this.gl.SCISSOR_TEST),typeof this.fontContext2D<"u"&&this.createFontTexture(this.cache)}setCompositor(t="default"){if(typeof t=="string"&&(t=this.compositors.get(t)),typeof t>"u")throw new Error("Invalid WebGL Compositor");this.currentCompositor!==t&&(this.currentCompositor!==null&&this.currentCompositor.flush(),this.currentCompositor=t)}resetTransform(){this.currentTransform.identity()}createFontTexture(t){if(typeof this.fontTexture>"u"){var e=this.getCanvas(),i=e.width,r=e.height;this.WebGLVersion===1&&(bt(i)||(i=Ye(e.width)),bt(r)||(r=Ye(e.height)));var n=Qt(i,r,!0);this.fontContext2D=this.getContext2d(n),this.fontTexture=new _e(lr(e.width,e.height,"fontTexture"),n,t),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else t.set(this.fontContext2D.canvas,this.fontTexture)}createPattern(t,e){if(O.WebGLVersion===1&&(!bt(t.width)||!bt(t.height))){var i=typeof t.src<"u"?t.src:t;throw new Error("[WebGL Renderer] "+i+" is not a POT texture ("+t.width+"x"+t.height+")")}var r=new _e(lr(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(r),r}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}clear(){this.currentCompositor.clear(this.settings.transparent?0:1)}clearColor(t="#000000",e=!1){var i;if(t instanceof N)i=t.toArray();else{var r=g.pull("me.Color");i=r.parseCSS(t).toArray(),g.push(r)}this.currentCompositor.clearColor(i[0],i[1],i[2],e===!0?1:i[3])}clearRect(t,e,i,r){this.save(),this.clipRect(t,e,i,r),this.clearColor(),this.restore()}drawFont(t){var e=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var i=this.fontTexture.getUVs(t.left+","+t.top+","+t.width+","+t.height);this.currentCompositor.addQuad(this.fontTexture,t.left,t.top,t.width,t.height,i[0],i[1],i[2],i[3],this.currentTint.toUint32(this.getGlobalAlpha())),e.clearRect(t.left,t.top,t.width,t.height)}drawImage(t,e,i,r,n,o,h,u,f){typeof r>"u"?(r=u=t.width,n=f=t.height,o=e,h=i,e=0,i=0):typeof o>"u"&&(o=e,h=i,u=r,f=n,r=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o|=0,h|=0);var c=this.cache.get(t),a=c.getUVs(e+","+i+","+r+","+n);this.currentCompositor.addQuad(c,o,h,u,f,a[0],a[1],a[2],a[3],this.currentTint.toUint32(this.getGlobalAlpha()))}drawPattern(t,e,i,r,n){var o=t.getUVs("0,0,"+r+","+n);this.currentCompositor.addQuad(t,e,i,r,n,o[0],o[1],o[2],o[3],this.currentTint.toUint32(this.getGlobalAlpha()))}getContextGL(t,e=!1){if(typeof t>"u"||t===null)throw new Error("You must pass a canvas element in order to create a GL context");var i={alpha:e,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:e?this.settings.premultipliedAlpha:!1,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat},r;if(this.settings.preferWebGL1===!1&&(r=t.getContext("webgl2",i),r&&(this.WebGLVersion=2)),r||(this.WebGLVersion=1,r=t.getContext("webgl",i)||t.getContext("experimental-webgl",i)),!r)throw new Error("A WebGL context could not be created.");return r}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal";break}}getFontContext(){return typeof this.fontContext2D>"u"&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}restore(){if(this._matrixStack.length!==0){var t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),g.push(t),g.push(e)}this._scissorStack.length!==0?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){var e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}setLineWidth(t){this.getContext().lineWidth(t)}strokeArc(t,e,i,r,n,o=!1,h=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.arc(t,e,i,r,n,o),h===!1?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillArc(t,e,i,r,n,o=!1){this.strokeArc(t,e,i,r,n,o,!0)}strokeEllipse(t,e,i,r,n=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.ellipse(t,e,i,r,0,0,360),this.path2D.closePath(),n===!1?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillEllipse(t,e,i,r){this.strokeEllipse(t,e,i,r,!1)}strokeLine(t,e,i,r){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,r),this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points))}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){this.translate(t.pos.x,t.pos.y),this.path2D.beginPath(),this.path2D.moveTo(t.points[0].x,t.points[0].y);for(var i,r=1;r<t.points.length;r++)i=t.points[r],this.path2D.lineTo(i.x,i.y);this.path2D.lineTo(t.points[0].x,t.points[0].y),this.path2D.closePath(),e===!1?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,r,n=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.rect(t,e,i,r),n===!1?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillRect(t,e,i,r){this.strokeRect(t,e,i,r,!0)}strokeRoundRect(t,e,i,r,n,o=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.roundRect(t,e,i,r,n),o===!1?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillRoundRect(t,e,i,r,n){this.strokeRoundRect(t,e,i,r,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=this.currentTransform;if(e.multiply(t),this.settings.subPixel===!1){var i=e.toArray();i[6]|=0,i[7]|=0}}translate(t,e){var i=this.currentTransform;if(i.translate(t,e),this.settings.subPixel===!1){var r=i.toArray();r[6]|=0,r[7]|=0}}clipRect(t,e,i,r){var n=this.getCanvas(),o=this.gl;if(t!==0||e!==0||i!==n.width||r!==n.height){var h=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&h[0]===t&&h[1]===e&&h[2]===i&&h[3]===r)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(t+this.currentTransform.tx,n.height-r-e-this.currentTransform.ty,i,r),h[0]=t,h[1]=e,h[2]=i,h[3]=r}else o.disable(o.SCISSOR_TEST)}setMask(t,e=!1){var i=this.gl;this.flush(),this.maskLevel===0&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),e===!0?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}function lr(s,t,e="default",i="no-repeat"){return{meta:{app:"melonJS",size:{w:s,h:t},repeat:i,image:"default"},frames:[{filename:e,frame:{x:0,y:0,w:s,h:t}}]}}class _e{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,typeof t<"u"){t=Array.isArray(t)?t:[t];for(var r in t){var n=t[r];if(typeof n.meta<"u"){if(n.meta.app.includes("texturepacker")||n.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",typeof e>"u"){var o=z.getImage(n.meta.image);if(!o)throw new Error("Atlas texture '"+o+"' not found");this.sources.set(n.meta.image,o)}else this.sources.set(n.meta.image||"default",typeof e=="string"?z.getImage(e):e);this.repeat="no-repeat"}else if(n.meta.app.includes("ShoeBox")){if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default",typeof e=="string"?z.getImage(e):e)}else n.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=n.meta.repeat||"no-repeat",this.sources.set("default",typeof e=="string"?z.getImage(e):e));this.atlases.set(n.meta.image||"default",this.parse(n))}else typeof n.framewidth<"u"&&typeof n.frameheight<"u"&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",typeof e<"u"&&(n.image=typeof e=="string"?z.getImage(e):e),this.atlases.set("default",this.parseFromSpriteSheet(n)),this.sources.set("default",n.image))}}if(this.atlases.length===0)throw new Error("texture atlas format not supported");i!==!1&&this.sources.forEach(h=>{i instanceof Vr?i.set(h,this):O.cache.set(h,this)})}parse(t){var e={};return t.frames.forEach(i=>{if(i.hasOwnProperty("filename")){var r=i.frame,n,o,h=i.spriteSourceSize&&i.sourceSize&&i.pivot;h&&(n=i.sourceSize.w*i.pivot.x-(i.trimmed?i.spriteSourceSize.x:0),o=i.sourceSize.h*i.pivot.y-(i.trimmed?i.spriteSourceSize.y:0)),e[i.filename]={name:i.filename,texture:t.meta.image||"default",offset:new C(r.x,r.y),anchorPoint:h?new C(n/r.w,o/r.h):null,trimmed:!!i.trimmed,width:r.w,height:r.h,angle:i.rotated===!0?-rf:0},this.addUVs(e,i.filename,t.meta.size.w,t.meta.size.h)}}),e}parseFromSpriteSheet(t){var e={},i=t.image,r=t.spacing||0,n=t.margin||0,o=i.width,h=i.height,u=g.pull("Vector2d",~~((o-n+r)/(t.framewidth+r)),~~((h-n+r)/(t.frameheight+r)));if(o%(t.framewidth+r)!==0||h%(t.frameheight+r)!==0){var f=u.x*(t.framewidth+r),c=u.y*(t.frameheight+r);f-o!==r&&c-h!==r&&(o=f,h=c,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+r)+"x"+(t.frameheight+r)+", truncating effective size to "+o+"x"+h))}for(var a=0,l=u.x*u.y;a<l;a++){var d=""+a;e[d]={name:d,texture:"default",offset:new C(n+(r+t.framewidth)*(a%u.x),n+(r+t.frameheight)*~~(a/u.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUVs(e,d,o,h)}return g.push(u),e}getAtlas(t){return typeof t=="string"?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return typeof t=="object"&&typeof t.texture=="string"?this.sources.get(t.texture):this.sources.values().next().value}addRegion(t,e,i,r,n){O.settings.verbose===!0&&console.warn("Adding texture region",t,"for texture",this);var o=this.getTexture(),h=this.getAtlas(),u=o.width,f=o.height;return h[t]={name:t,offset:new C(e,i),width:r,height:n,angle:0},this.addUVs(h,t,u,f),h[t]}getRegion(t,e){var i;return typeof e=="string"?i=this.getAtlas(e)[t]:this.atlases.forEach(r=>{typeof r[t]<"u"&&(i=r[t])}),i}getUVs(t){var e=this.getRegion(t);if(typeof e>"u"){var i=t.split(","),r=+i[0],n=+i[1],o=+i[2],h=+i[3];e=this.addRegion(t,r,n,o,h)}return e.uvs}addUVs(t,e,i,r){if(O instanceof Ke){var n=t[e].offset,o=t[e].width,h=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/r,(n.x+o)/i,(n.y+h)/r]);var u=n.x+","+n.y+","+i+","+r;t[u]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return g.pull(i===!0?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){for(var i=[],r={},n=0,o=0,h,u=0;u<t.length;++u){if(h=this.getRegion(t[u]),h==null)throw new Error("Texture - region for "+t[u]+" not found");i[u]=h,r[t[u]]=u,n=Math.max(h.width,n),o=Math.max(h.height,o)}return new yt(0,0,Object.assign({image:this,framewidth:n,frameheight:o,margin:0,spacing:0,atlas:i,atlasIndices:r},e||{}))}}class ct extends C{constructor(t=0,e=0,i){if(super(t,e),typeof i>"u")throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){return this.setMuted(t,e),typeof i<"u"&&this.setCallback(i.onUpdate,i.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);e&&"y"in e?this._y=e.y:this._y=t}_set(t,e){var i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e){return this._set(this._x*t,this._y*(typeof e<"u"?e:t))}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new ct(A(this.x,t,e),A(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(A(this._x,t,e),A(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new ct(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new ct(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new ct(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){var i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);var n=this._x-i,o=this._y-r,h=Math.cos(t),u=Math.sin(t);return this._set(n*h-o*u+i,n*u+o*h+r)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),r=this.distance(t);return r===0||e>=0&&r<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return g.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return g.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class pt{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){return this.x=t,this.y=e,this.z=i,this}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||typeof i<"u"&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e,i){return e=typeof e<"u"?e:t,this._set(this.x*t,this.y*e,this.z*(i||1))}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new pt(A(this.x,t,e),A(this.y,t,e),A(this.z,t,e))}clampSelf(t,e){return this._set(A(this.x,t,e),A(this.y,t,e),A(this.z,t,e))}minV(t){var e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){var e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new pt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new pt(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new pt(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){var t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),typeof i>"u"&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){var i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);var n=this.x-i,o=this.y-r,h=Math.cos(t),u=Math.sin(t);return this._set(n*h-o*u+i,n*u+o*h+r,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(typeof t.z<"u"?t.z:this.z)}cross(t){var e=this.x,i=this.y,r=this.z,n=t.x,o=t.y,h=t.z;return this.x=i*h-r*o,this.y=r*n-e*h,this.z=e*o-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),r=this.x-t.x,n=this.y-t.y,o=Math.sqrt(r*r+n*n);return o===0||e>=0&&o<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}angle(t){return Math.acos(A(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return g.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class gt extends pt{constructor(t=0,e=0,i=0,r){if(super(t,e,i),typeof r>"u")throw new Error("undefined `onUpdate` callback");this.setCallback(r.onUpdate,r.scope)}onResetEvent(t=0,e=0,i=0,r){return this.setMuted(t,e,i),typeof r<"u"&&this.setCallback(r.onUpdate,r.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);e&&"y"in e?this._y=e.y:this._y=t}get z(){return this._z}set z(t){var e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);e&&"z"in e?this._z=e.z:this._z=t}_set(t,e,i){var r=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return r&&"x"in r&&"y"in r&&"z"in r?(this._x=r.x,this._y=r.y,this._z=r.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e,i){return e=typeof e<"u"?e:t,this._set(this._x*t,this._y*e,this._z*(i||1))}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new gt(A(this._x,t,e),A(this._y,t,e),A(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(A(this._x,t,e),A(this._y,t,e),A(this._z,t,e))}minV(t){var e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){var e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new gt(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new gt(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new gt(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){var i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);var n=this.x-i,o=this.y-r,h=Math.cos(t),u=Math.sin(t);return this._set(n*h-o*u+i,n*u+o*h+r,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){var e=this._x,i=this._y,r=this._z,n=t.x,o=t.y,h=t.z;return this._set(i*h-r*o,r*n-e*h,e*o-i*n)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),r=this._x-t.x,n=this._y-t.y,o=Math.sqrt(r*r+n*n);return o===0||e>=0&&o<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){var e=this._x-t.x,i=this._y-t.y,r=this._z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}clone(){return g.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return g.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}var ur={},fr={},Ia={},Ra={},Qd=function(s,t,e){t=t||s.keyCode||s.button;var i=Ra[t];if(I(Af,i,t,i?!ur[i]:!0),i){if(!ur[i]){var r=typeof e<"u"?e:t;fr[i][r]||(fr[i][r]=!0)}return Ia[t]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},Jd=function(s,t,e){t=t||s.keyCode||s.button;var i=Ra[t];if(I(Sf,i,t),i){var r=typeof e<"u"?e:t;return fr[i][r]=void 0,ur[i]=!1,Ia[t]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},se=null;function tc(){se===null&&ga===!1&&(se=globalThis,typeof se.addEventListener=="function"&&(se.addEventListener("keydown",Qd,!1),se.addEventListener("keyup",Jd,!1)))}var Yt=new C;class ec extends Y{constructor(t=0,e=0,i=1,r=1){super(),this.setMinMax(t,e,t+i,e+r),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,r=0,n=0,o=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=r,this.clientY=n,ac(this.pageX,this.pageY,Yt),this.gameScreenX=this.x=Yt.x,this.gameScreenY=this.y=Yt.y,this.isNormalized=typeof globalThis.PointerEvent<"u"&&!(t instanceof globalThis.PointerEvent),this.locked=nc,this.movementX=t.movementX||0,this.movementY=t.movementY||0,t.type==="wheel"?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=typeof t.isPrimary<"u"?t.isPrimary:!0,this.button=t.button||0,this.type=t.type,typeof T.viewport<"u"&&T.viewport.localToWorld(this.gameScreenX,this.gameScreenY,Yt),this.gameWorldX=Yt.x,this.gameWorldY=Yt.y,this.isNormalized===!1?(this.width=t.width||1,this.height=t.height||1):typeof t.radiusX=="number"?(this.width=t.radiusX*2||1,this.height=t.radiusY*2||1):this.width=this.height=1}}var dr=new Map,ic=[];const Nr=["wheel"],li=["pointermove","mousemove","touchmove"],ui=["pointerdown","mousedown","touchstart"],fi=["pointerup","mouseup","touchend"],di=["pointercancel","mousecancel","touchcancel"],ci=["pointerenter","mouseenter","touchenter"],pi=["pointerover","mouseover","touchover"],gi=["pointerleave","mouseleave","touchleave"],cr=[Nr[0],li[0],ui[0],fi[0],di[0],ci[0],pi[0],gi[0]];Nr[0],li[1],ui[1],fi[1],di[1],ci[1],pi[1],gi[1];li[2],ui[2],fi[2],di[2],ci[2],pi[2],gi[2];const rc={wheel:Nr,pointermove:li,pointerdown:ui,pointerup:fi,pointercancel:di,pointerenter:ci,pointerover:pi,pointerleave:gi};function sc(s,t){for(var e=[],i=0;i<t.length;i++){var r=s.indexOf(t[i]);r!==-1&&e.push(t[i])}return e}new ec(0,0,1,1);var nc=!1;function ac(s,t,e){e=e||g.pull("Vector2d");var i=ba(O.getCanvas()),r=globalThis.devicePixelRatio||1;s-=i.left+(globalThis.pageXOffset||0),t-=i.top+(globalThis.pageYOffset||0);var n=O.scaleRatio;return(n.x!==1||n.y!==1)&&(s/=n.x,t/=n.y),e.set(s*r,t*r)}function oc(s,t,e){if(cr.indexOf(s)===-1)throw new Error("invalid event type : "+s);var i=sc(ic,rc[s]),r=dr.get(t);if(typeof r<"u"){for(var n=0;n<i.length;n++)if(s=i[n],r.callbacks[s]){if(typeof e<"u")de(r.callbacks[s],e);else for(;r.callbacks[s].length>0;)r.callbacks[s].pop();r.callbacks[s].length===0&&delete r.callbacks[s]}Object.keys(r.callbacks).length===0&&dr.delete(t)}}function hc(s){if(dr.has(s))for(var t=0;t<cr.length;t++)oc(cr[t],s)}function lc(s,t,e){return e===this.GAMEPAD.BUTTONS.L2||e===this.GAMEPAD.BUTTONS.R2?(s+1)/2:s}function Bs(s,t,e){return s>0?e===this.GAMEPAD.BUTTONS.L2?s=Math.max(0,s-2e4)/111070:s=(s-1)/131070:s=(65536+s)/131070+.5,s}var Ls=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,Ds=/^0+/;function uc(s,t){var e=s.replace(Ls,(r,n,o)=>"000".slice(n.length-1)+n+"-"+"000".slice(o.length-1)+o+"-"),i=s.replace(Ls,(r,n,o)=>n.replace(Ds,"")+"-"+o.replace(Ds,"")+"-");t.analog=t.analog||t.buttons.map(()=>-1),t.normalize_fn=t.normalize_fn||function(r){return r},Fs.set(e,t),Fs.set(i,t)}var Fs=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:lc}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Bs}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Bs}]].forEach(s=>{uc(s[0],s[1])});globalThis.navigator&&typeof globalThis.navigator.getGamepads=="function"&&(globalThis.addEventListener("gamepadconnected",s=>{I(Ef,s.gamepad)},!1),globalThis.addEventListener("gamepaddisconnected",s=>{I(Cf,s.gamepad)},!1));class D extends J{constructor(t,e,i,r){super(t,e,i,r),this.isRenderable=!0,this.isKinematic=!0,this.body=void 0,typeof this.currentTransform>"u"&&(this.currentTransform=g.pull("Matrix2d")),this.currentTransform.identity(),this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.anchorPoint instanceof ct?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=g.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.blendMode="normal",this.name="",this.pos instanceof gt?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=g.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.isDirty=!1,this._flip={x:!1,y:!1},this._inViewport=!1,this.setOpacity(1)}get isFloating(){return this.floating===!0||typeof this.ancestor<"u"&&this.ancestor.floating===!0}get tint(){return typeof this._tint>"u"&&(this._tint=g.pull("Color",255,255,255,1)),this._tint}set tint(t){typeof this._tint>"u"&&(this._tint=g.pull("Color",255,255,255,1)),t instanceof N?this._tint.copy(t):this._tint.parseCSS(t)}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,typeof this.onVisibilityChange=="function"&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return this._flip.x===!0}get isFlippedY(){return this._flip.y===!0}getBounds(){return typeof this._bounds>"u"&&(super.getBounds(),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){typeof t=="number"&&(this.alpha=A(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this}angleTo(t){var e=this.getBounds(),i,r;if(t instanceof D){var n=t.getBounds();i=n.centerX-e.centerX,r=n.centerY-e.centerY}else i=t.x-e.centerX,r=t.y-e.centerY;return Math.atan2(r,i)}distanceTo(t){var e=this.getBounds(),i,r;if(t instanceof D){var n=t.getBounds();i=e.centerX-n.centerX,r=e.centerY-n.centerY}else i=e.centerX-t.x,r=e.centerY-t.y;return Math.sqrt(i*i+r*r)}lookAt(t){var e;t instanceof D?e=t.pos:e=t;var i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return isNaN(t)||(this.currentTransform.rotate(t,e),this.isDirty=!0),this}scale(t,e){return this.currentTransform.scale(t,e),super.scale(t,e),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(){return super.updateBounds(),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()}updateBoundsPos(t,e){var i=this.getBounds();i.shift(t,e),typeof this.anchorPoint<"u"&&i.isFinite()&&i.translate(-(this.anchorPoint.x*i.width),-(this.anchorPoint.y*i.height)),typeof this.ancestor<"u"&&typeof this.ancestor.addChild=="function"&&this.floating!==!0&&i.translate(this.ancestor.getAbsolutePosition()),this.isDirty=!0}getAbsolutePosition(){return typeof this._absPos>"u"&&(this._absPos=g.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),typeof this.ancestor<"u"&&typeof this.ancestor.addChild=="function"&&this.floating!==!0&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){var e=this.getBounds(),i=e.width*this.anchorPoint.x,r=e.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var n=this._flip.x?this.centerX-i:0,o=this._flip.y?this.centerY-r:0;t.translate(n,o),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-n,-o)}typeof this.mask<"u"&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),this.autoTransform===!0&&!this.currentTransform.isIdentity()&&(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-i,-r),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),typeof this.mask<"u"&&t.clearMask(),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){g.push(this.currentTransform),this.currentTransform=void 0,g.push(this.anchorPoint),this.anchorPoint=void 0,g.push(this.pos),this.pos=void 0,typeof this._absPos<"u"&&(g.push(this._absPos),this._absPos=void 0),g.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,typeof this.mask<"u"&&(g.push(this.mask),this.mask=void 0),typeof this._tint<"u"&&(g.push(this._tint),this._tint=void 0),this.ancestor=void 0,typeof this.body<"u"&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),hc(this),this.onDestroyEvent.apply(this,arguments)}onDestroyEvent(){}}class yt extends D{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=g.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:"default",length:0,offset:g.pull("Vector2d"),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof _e){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,typeof i.region<"u"){var r=this.source.getRegion(i.region);if(r)this.setRegion(r),this.current.width=i.framewidth||r.width,this.current.height=i.frameheight||r.height;else throw new Error("Texture - region for "+i.region+" not found")}}else{if(this.image=typeof i.image=="object"?i.image:z.getImage(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.current.width=i.framewidth=i.framewidth||this.image.width,this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=O.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}typeof i.atlas<"u"&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),this.width=this.current.width,this.height=this.current.height,typeof i.flipX<"u"&&this.flipX(!!i.flipX),typeof i.flipY<"u"&&this.flipY(!!i.flipY),typeof i.rotation<"u"&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),typeof i.tint<"u"&&(i.tint instanceof N?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),typeof i.name=="string"&&(this.name=i.name),typeof i.z<"u"&&(this.pos.z=i.z),this.addAnimation("default",null)!==0&&this.setCurrentAnimation("default"),this.autoTransform=!0}isFlickering(){return this._flicker.isFlickering}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};var r=0;if(typeof this.textureAtlas!="object")return 0;e==null&&(e=[],Object.keys(this.textureAtlas).forEach((c,a)=>{e[a]=a}));for(var n=0,o=e.length;n<o;n++){var h=e[n],u;typeof h=="number"||typeof h=="string"?u={name:h,delay:i||this.animationspeed}:u=h;var f=u.name;if(typeof f=="number")typeof this.textureAtlas[f]<"u"&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[f],u),r++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[f]],u),r++}}return this.anim[t].length=r,r}setCurrentAnimation(t,e,i){if(this.anim[t])this.current.name=t,this.current.length=this.anim[this.current.name].length,typeof e=="string"?this.resetAnim=this.setCurrentAnimation.bind(this,e,null,!0):typeof e=="function"?this.resetAnim=e:this.resetAnim=void 0,this.setAnimationFrame(this.current.idx),i||(this.dt=0),this.isDirty=!0;else throw new Error("animation id '"+t+"' not defined");return this}reverseAnimation(t){return typeof t<"u"&&typeof this.anim[t]<"u"?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=t.angle,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.set(this._flip.x&&t.trimmed===!0?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&t.trimmed===!0?1-t.anchorPoint.y:t.anchorPoint.y),this.isDirty=!0,this}setAnimationFrame(t){return this.current.idx=(t||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(!this.animationpause&&this.current&&this.current.length>0){var e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;var i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),this.current.idx===0&&typeof this.resetAnim=="function"&&this.resetAnim()===!1){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&(typeof this._flicker.callback=="function"&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}destroy(){g.push(this.offset),this.offset=void 0,super.destroy()}draw(t,e){if(!(this._flicker.isFlickering&&(this._flicker.state=!this._flicker.state,!this._flicker.state))){var i=this.current,r=this.pos.x,n=this.pos.y,o=i.width,h=i.height,u=i.offset,f=this.offset;i.angle!==0&&(t.translate(-r,-n),t.rotate(i.angle),r-=h,o=i.height,h=i.width),t.drawImage(this.image,f.x+u.x,f.y+u.y,o,h,r,n,o,h)}}}class Ur extends Y{constructor(t,e,i,r){var n,o;if(super(),r.isCollection){var h=r.getTileImage(i&or);n=h.width,o=h.height}else n=r.tilewidth,o=r.tileheight;this.setMinMax(0,0,n,o),this.tileset=r,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=(this.tileId&Sa)!==0,this.flippedY=(this.tileId&Ea)!==0,this.flippedAD=(this.tileId&Ca)!==0,this.flipped=this.flippedX||this.flippedY||this.flippedAD,this.flipped===!0&&(this.currentTransform===null&&(this.currentTransform=new Vt),this.setTileTransform(this.currentTransform.identity())),this.tileId&=or}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){var e,i=this.tileset;if(i.animations.has(this.tileId)){var r=[],n=[];i.animations.get(this.tileId).frames.forEach(h=>{n.push(h.tileid),r.push({name:""+h.tileid,delay:h.duration})}),e=i.texture.createAnimationFromName(n,t),e.addAnimation(this.tileId-i.firstgid,r),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(i.isCollection===!0){var o=i.getTileImage(this.tileId);e=new yt(0,0,Object.assign({image:o})),e.anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),typeof t.rotation<"u"&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t),e.anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class fc{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=typeof e.class<"u"?e.class:e.type,this.text=void 0,this.rotation=ea(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,typeof this.gid=="number"?this.setTile(t.tilesets):typeof e.ellipse<"u"?this.isEllipse=!0:typeof e.point<"u"?this.isPoint=!0:typeof e.polygon<"u"?(this.points=e.polygon,this.isPolygon=!0):typeof e.polyline<"u"&&(this.points=e.polyline,this.isPolyLine=!0),typeof e.text<"u"?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,Jt(this.text,e)):(Jt(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){var e=t.getTilesetByGid(this.gid);e.isCollection===!1&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new Ur(this.x,this.y,this.gid,e)}parseTMXShapes(){var t=0,e=[];if(this.isEllipse===!0)e.push(g.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(this.isPoint===!0)e.push(g.pull("Point",this.x,this.y));else if(this.isPolygon===!0){var i=g.pull("Polygon",0,0,this.points);if(i.isConvex()===!1)throw new Error("collision polygones in Tiled should be defined as Convex");e.push(i.rotate(this.rotation))}else if(this.isPolyLine===!0){var r=this.points,n,o,h=r.length-1;for(t=0;t<h;t++)n=g.pull("Vector2d",r[t].x,r[t].y),o=g.pull("Vector2d",r[t+1].x,r[t+1].y),this.rotation!==0&&(n=n.rotate(this.rotation),o=o.rotate(this.rotation)),e.push(g.pull("Line",0,0,[n,o]))}else e.push(g.pull("Polygon",0,0,[g.pull("Vector2d"),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)]).rotate(this.rotation));if(this.orientation==="isometric")for(t=0;t<e.length;t++)typeof e[t].toIso=="function"&&e[t].toIso();return e}getObjectPropertyByName(t){return this[t]}}class Gr extends Ae{constructor(t){super(t),this.context=this.getContext2d(this.getCanvas(),this.settings.transparent),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new Vr,this.settings.textureSeamFix!==!1&&!this.settings.antiAlias&&(this.uvOffset=1),this.type="CANVAS",this.getCanvas().addEventListener("contextlost",e=>{e.preventDefault(),this.isContextValid=!1,I(zr,this)},!1),this.getCanvas().addEventListener("contextrestored",()=>{this.isContextValid=!0,I(We,this)},!1)}reset(){super.reset(),this.clearColor(this.currentColor,this.settings.transparent!==!0)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal";break}}clear(){if(this.settings.transparent===!1){var t=this.getCanvas(),e=this.getContext();e.clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){var i=this.getCanvas(),r=this.getContext();this.save(),this.resetTransform(),r.globalAlpha=1,r.globalCompositeOperation=e===!0?"copy":"source-over",r.fillStyle=t instanceof N?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,r){this.getContext().clearRect(t,e,i,r)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,r,n,o,h,u,f){if(!(this.getGlobalAlpha()<1/255)){var c=this.getContext();typeof r>"u"?(r=u=t.width,n=f=t.height,o=e,h=i,e=0,i=0):typeof o>"u"&&(o=e,h=i,u=r,f=n,r=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o=~~o,h=~~h);var a=t,l=this.currentTint.toArray();(l[0]!==1||l[1]!==1||l[2]!==1)&&(a=this.cache.tint(t,this.currentTint.toRGB())),c.drawImage(a,e,i,r,n,o,h,u,f)}}drawPattern(t,e,i,r,n){if(!(this.getGlobalAlpha()<1/255)){var o=this.getContext(),h=o.fillStyle;o.fillStyle=t,o.fillRect(e,i,r,n),o.fillStyle=h}}strokeArc(t,e,i,r,n,o,h=!1){if(!(this.getGlobalAlpha()<1/255)){var u=this.getContext();u.translate(t,e),u.beginPath(),u.arc(0,0,i,r,n,o||!1),u[h===!0?"fill":"stroke"](),u.translate(-t,-e)}}fillArc(t,e,i,r,n,o){this.strokeArc(t,e,i,r,n,o||!1,!0)}strokeEllipse(t,e,i,r,n=!1){if(!(this.getGlobalAlpha()<1/255)){var o=this.getContext(),h=i,u=r,f=t-h,c=t+h,a=e-u,l=e+u,d=h*.551784,p=u*.551784,y=t-d,m=t+d,v=e-p,_=e+p;o.beginPath(),o.moveTo(t,a),o.bezierCurveTo(m,a,c,v,c,e),o.bezierCurveTo(c,_,m,l,t,l),o.bezierCurveTo(y,l,f,_,f,e),o.bezierCurveTo(f,v,y,a,t,a),o[n===!0?"fill":"stroke"](),o.closePath()}}fillEllipse(t,e,i,r){this.strokeEllipse(t,e,i,r,!0)}strokeLine(t,e,i,r){if(!(this.getGlobalAlpha()<1/255)){var n=this.getContext();n.beginPath(),n.moveTo(t,e),n.lineTo(i,r),n.stroke()}}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){var i=this.getContext();this.translate(t.pos.x,t.pos.y),i.beginPath(),i.moveTo(t.points[0].x,t.points[0].y);for(var r,n=1;n<t.points.length;n++)r=t.points[n],i.lineTo(r.x,r.y);i.lineTo(t.points[0].x,t.points[0].y),i[e===!0?"fill":"stroke"](),i.closePath(),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,r,n=!1){if(!(this.getGlobalAlpha()<1/255)){var o=this.getContext();o[n===!0?"fillRect":"strokeRect"](t,e,i,r)}}fillRect(t,e,i,r){this.strokeRect(t,e,i,r,!0)}strokeRoundRect(t,e,i,r,n,o=!1){if(!(this.getGlobalAlpha()<1/255)){var h=this.getContext();h.beginPath(),h.roundRect(t,e,i,r,n),h[o===!0?"fill":"stroke"]()}}fillRoundRect(t,e,i,r,n){this.strokeRoundRect(t,e,i,r,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}getFontContext(){return this.getContext()}save(){this.getContext().save()}restore(){this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){var e=this.getContext();e.strokeStyle=e.fillStyle=t instanceof N?t.toRGBA():t}setGlobalAlpha(t){this.getContext().globalAlpha=this.currentColor.glArray[3]=t}getGlobalAlpha(){return this.getContext().globalAlpha}setLineWidth(t){this.getContext().lineWidth=t}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=t.toArray(),i=e[0],r=e[1],n=e[3],o=e[4],h=e[6],u=e[7];this.settings.subPixel===!1&&(h|=0,u|=0),this.getContext().transform(i,r,n,o,h,u)}translate(t,e){this.settings.subPixel===!1?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,r){var n=this.getCanvas();if(t!==0||e!==0||i!==n.width||r!==n.height){var o=this.currentScissor;if(o[0]!==t||o[1]!==e||o[2]!==i||o[3]!==r){var h=this.getContext();h.beginPath(),h.rect(t,e,i,r),h.clip(),o[0]=t,o[1]=e,o[2]=i,o[3]=r}}}setMask(t,e=!1){var i=this.getContext();if(this.maskLevel===0&&(i.save(),i.beginPath()),t instanceof te)i.roundRect(t.top,t.left,t.width,t.height,t.radius);else if(t instanceof J||t instanceof Y)i.rect(t.top,t.left,t.width,t.height);else if(t instanceof At){const l=t.pos.x,d=t.pos.y,p=t.radiusV.x,y=t.radiusV.y,m=l-p,v=l+p,_=d-y,x=d+y;var r=p*.551784,n=y*.551784,o=l-r,h=l+r,u=d-n,f=d+n;i.moveTo(l,_),i.bezierCurveTo(h,_,v,u,v,d),i.bezierCurveTo(v,f,h,x,l,x),i.bezierCurveTo(o,x,m,f,m,d),i.bezierCurveTo(m,u,o,_,l,_)}else{const l=t.pos.x,d=t.pos.y;var c;i.moveTo(l+t.points[0].x,d+t.points[0].y);for(var a=1;a<t.points.length;a++)c=t.points[a],i.lineTo(l+c.x,d+c.y)}this.maskLevel++,e===!0?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}function dc(s,t){for(var e=new Array(t),i=0;i<t;i++){e[i]=new Array(s);for(var r=0;r<s;r++)e[i][r]=null}return e}function ks(s,t,e){var i=0,r,n;typeof t.rows>"u"?(r=t.width,n=t.height):(r=t.cols,n=t.rows);for(var o=0;o<n;o++)for(var h=0;h<r;h++){var u=e[i++];u!==0&&(s.layerData[h+t.x][o+t.y]=s.getTileById(u,h+t.x,o+t.y))}}function cc(s,t){for(var e=0;e<s.rows;e++)for(var i=0;i<s.cols;i++){var r=s.layerData[i][e];r instanceof Ur&&s.getRenderer().drawTile(t,i,e,r)}}class ee extends D{constructor(t,e,i,r,n,o,h){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||r,this.orientation=n,this.x=0,this.y=0,this.tilesets=o,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var u=0;u<this.tilesets.length;u++){var f=this.tilesets.getTilesetByIndex(u);this.maxTileSize.width=Math.max(this.maxTileSize.width,f.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,f.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=h,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;var c=typeof e.visible<"u"?+e.visible:1;this.setOpacity(c?+e.opacity:0),typeof e.tintcolor=="string"&&this.tint.parseHex(e.tintcolor,!0),this.orientation==="isometric"?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),Jt(this,e),typeof this.preRender>"u"&&(this.preRender=T.world.preRender),this.setRenderer(t.getRenderer()),this.layerData=dc(this.rows,this.cols),t.infinite===0?ks(this,this,qe(e.data,e.encoding,e.compression)):t.infinite===1&&e.chunks.forEach(a=>{ks(this,a,qe(a.data,e.encoding,e.compression))})}onActivateEvent(){if(this.animatedTilesets===void 0&&(this.animatedTilesets=[]),this.tilesets)for(var t=this.tilesets.tilesets,e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),this.preRender===!0&&!this.canvasRenderer&&(this.canvasRenderer=new Gr({canvas:Qt(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),cc(this,this.canvasRenderer))}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t}getRenderer(){return this.renderer}getTileId(t,e){var i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){var i=null;if(this.contains(t,e)){var r=this.getRenderer().pixelToTileCoords(t,e,g.pull("Vector2d"));i=this.cellAt(r.x,r.y),g.push(r)}return i}setTile(t,e,i){return this.layerData[e][i]=t,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new Ur(e,i,t,this.tileset)}cellAt(t,e,i){var r=~~t,n=~~e,o=this.getRenderer();return i===!1||r>=0&&r<o.cols&&n>=0&&n<o.rows?this.layerData[r][n]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight)}update(t){if(this.isAnimated){for(var e=!1,i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}return!1}draw(t,e){if(this.preRender){var i=Math.min(e.width,this.width),r=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,r,e.pos.x,e.pos.y,i,r)}else this.getRenderer().drawTileLayer(t,this,e)}}class pc{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];var r=typeof e.visible<"u"?e.visible:!0;this.opacity=r===!0?A(+e.opacity||1,0,1):0,Jt(this,e),e.objects&&e.objects.forEach(n=>{n.tintcolor=this.tintcolor,this.objects.push(new fc(t,n,i))}),e.layers&&e.layers.forEach(n=>{var o=new ee(t,n,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);o.setRenderer(t.getRenderer()),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),this.objects.push(o)})}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}function gc(s,t){this.removeChildNow(s,t)}let Le=0;class ft extends D{constructor(t=0,e=0,i,r,n=!1){super(t,e,typeof i>"u"?typeof T.viewport<"u"?T.viewport.width:1/0:i,typeof r>"u"?typeof T.viewport<"u"?T.viewport.height:1/0:r),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn=T.sortOn,this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(o){},this.enableChildBoundsUpdate=!1,this.backgroundColor=g.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),this.root===!0&&B(si,this.updateBounds.bind(this,!0))}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var t=this.getChildren(),e=t.length,i;e>=0;i=t[--e])i&&i.isPersistent!==!0&&this.removeChildNow(i);typeof this.currentTransform<"u"&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){return t.ancestor instanceof ft?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=q.createGUID(t.id)),t.ancestor=this,this.getChildren().push(t),typeof t.pos<"u"&&(typeof e=="number"?t.pos.z=e:this.autoDepth===!0&&(t.pos.z=this.getChildren().length)),this.autoSort===!0&&this.sort(),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.isAttachedToRoot()===!0&&T.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Tt&&T.world.addBody(t.body),this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length)return t.ancestor instanceof ft?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=q.createGUID()),t.ancestor=this,this.getChildren().splice(e,0,t),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.isAttachedToRoot()===!0&&T.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Tt&&T.world.addBody(t.body),this.onChildChange.call(this,e),t;throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){var i=this,r=0,n=this.getChildren(),o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<o;)t.call(i,n[r],r,n),r++}swapChildren(t,e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i!==-1&&r!==-1){var n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[r]=t,this.isDirty=!0}else throw new Error(t+" Both the supplied childs must be a child of the caller "+this)}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){var e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){var i=[];function r(n,o){var h=n[o];e instanceof RegExp&&typeof h=="string"?e.test(h)&&i.push(n):h===e&&i.push(n)}return this.forEach(n=>{r(n,t),n instanceof ft&&(i=i.concat(n.getChildByProp(t,e)))}),i}getChildByType(t){var e=[];return this.forEach(i=>{i instanceof t&&e.push(i),i instanceof ft&&(e=e.concat(i.getChildByType(t)))}),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){var e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return typeof this.children>"u"&&(this.children=[]),this.children}updateBounds(t=!1){super.updateBounds();var e=this.getBounds();return(t===!0||this.enableChildBoundsUpdate===!0)&&this.forEach(i=>{if(i.isRenderable){var r=i.getBounds();r.isFinite()&&e.addBounds(i.getBounds())}}),e}isAttachedToRoot(){if(this.root===!0)return!0;for(var t=this.ancestor;t;){if(t.root===!0)return!0;t=t.ancestor}return!1}updateBoundsPos(t,e){return super.updateBoundsPos(t,e),this.forEach(i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)}),this.getBounds()}onActivateEvent(){this.forEach(t=>{typeof t.onActivateEvent=="function"&&t.onActivateEvent()})}removeChild(t,e){if(this.hasChild(t))q.function.defer(gc,this,t,e);else throw new Error("Child is not mine.")}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent(),t.body instanceof Tt&&T.world.removeBody(t.body),e||g.push(t,!1)===!1&&typeof t.destroy=="function"&&t.destroy();var i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),this.isAttachedToRoot()===!0&&T.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach(r=>{i===!0&&r instanceof ft&&r.setChildsProperty(t,e,i),r[t]=e})}moveUp(t){var e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){var e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){var e=this.getChildIndex(t);if(e>0){var i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){var e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(t===!0&&this.forEach(e=>{e instanceof ft&&e.sort(t)}),this.pendingSort=q.function.defer(function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,T.repaint()},this))}onDeactivateEvent(){this.forEach(t=>{typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent()})}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;var i=e.pos.z-t.pos.z;return i||e.pos.x-t.pos.x}_sortY(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;var i=e.pos.z-t.pos.z;return i||e.pos.y-t.pos.y}destroy(){this.reset(),super.destroy(arguments)}update(t){for(var e=!1,i=nt.isPaused(),r=this.getChildren(),n=r.length,o;n--,o=r[n];)i&&!o.updateWhenPaused||(o.isRenderable?(e=Le>0||o.floating,e&&Le++,o.inViewport=!1,nt.current().cameras.forEach(h=>{h.isVisible(o,e)&&(o.inViewport=!0)}),this.isDirty|=(o.inViewport||o.alwaysUpdate)&&o.update(t),Le>0&&Le--):this.isDirty|=o.update(t));return super.update(t)}draw(t,e){var i=!1,r=this.getBounds();this.drawCount=0,this.root===!1&&this.clipping===!0&&r.isFinite()===!0&&t.clipRect(r.left,r.top,r.width,r.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);for(var n=this.getChildren(),o=n.length,h;o--,h=n[o];)h.isRenderable&&(i=h.floating===!0,(h.inViewport||i)&&(i&&(t.save(),t.resetTransform()),h.preDraw(t),h.draw(t,e),h.postDraw(t),i&&t.restore(),this.drawCount++))}}class Hr{constructor(t,e,i,r){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=r,this.bounds=new Y}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){var e=t instanceof ee?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,r){}drawTileLayer(t,e,i){}}class vc extends Hr{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return t.orientation==="orthogonal"&&super.canRender(t)}pixelToTileCoords(t,e,i){var r=i||new C;return r.set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){var r=i||new C;return r.set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,r){var n=r.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,r)}drawTileLayer(t,e,i){var r=1,n=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),g.pull("Vector2d")).floorSelf(),h=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,g.pull("Vector2d")).ceilSelf();switch(h.x=h.x>this.cols?this.cols:h.x,h.y=h.y>this.rows?this.rows:h.y,e.renderorder){case"right-up":h.y=o.y+(o.y=h.y)-h.y,n=-1;break;case"left-down":h.x=o.x+(o.x=h.x)-h.x,r=-1;break;case"left-up":h.x=o.x+(o.x=h.x)-h.x,h.y=o.y+(o.y=h.y)-h.y,r=-1,n=-1;break}for(var u=o.y;u!==h.y;u+=n)for(var f=o.x;f!==h.x;f+=r){var c=e.cellAt(f,u,!1);c&&this.drawTile(t,f,u,c)}g.push(o),g.push(h)}}class yc extends Hr{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return t.orientation==="isometric"&&super.canRender(t)}getBounds(t){var e=t instanceof ee?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){var r=i||new C;return r.set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){var r=i||new C;return r.set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){var e=t.x/this.hTilewidth,i=t.y/this.tileheight,r=g.pull("Vector2d");this.tileToPixelCoords(e,i,r),t.x=r.x,t.y=r.y,g.push(r)}drawTile(t,e,i,r){var n=r.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,r)}drawTileLayer(t,e,i){var r=e.tileset,n=this.pixelToTileCoords(i.pos.x-r.tilewidth,i.pos.y-r.tileheight,g.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+r.tilewidth,i.pos.y+i.height+r.tileheight,g.pull("Vector2d")).ceilSelf(),h=this.tileToPixelCoords(o.x,o.y,g.pull("Vector2d")),u=this.tileToPixelCoords(n.x,n.y,g.pull("Vector2d"));u.x-=this.hTilewidth,u.y+=this.tileheight;var f=u.y-i.pos.y>this.hTileheight,c=i.pos.x-u.x<this.hTilewidth;f&&(c?(n.x--,u.x-=this.hTilewidth):(n.y--,u.x+=this.hTilewidth),u.y-=this.hTileheight);for(var a=f^c,l=n.clone(),d=u.y*2;d-this.tileheight*2<h.y*2;d+=this.tileheight){l.setV(n);for(var p=u.x;p<h.x;p+=this.tilewidth){var y=e.cellAt(l.x,l.y);if(y){r=y.tileset;var m=r.tileoffset;r.drawTile(t,m.x+p,m.y+d/2-r.tileheight,y)}l.x++,l.y--}a?(n.y++,u.x-=this.hTilewidth,a=!1):(n.x++,u.x+=this.hTilewidth,a=!0)}g.push(l),g.push(n),g.push(o),g.push(h),g.push(u)}}const mc=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],_c=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class Oa extends Hr{constructor(t){super(t.cols,t.rows,t.tilewidth&-2,t.tileheight&-2),this.hexsidelength=t.hexsidelength||0,this.staggerX=t.staggeraxis==="x",this.staggerEven=t.staggerindex==="even",this.sidelengthx=0,this.sidelengthy=0,t.orientation==="hexagonal"&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new C,new C,new C,new C]}canRender(t){return t.orientation==="hexagonal"&&super.canRender(t)}getBounds(t){var e=t instanceof ee?g.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&t&1^this.staggerEven}doStaggerY(t){return!this.staggerX&&t&1^this.staggerEven}topLeft(t,e,i){var r=i||new C;return this.staggerX?t&1^this.staggerEven?r.set(t-1,e):r.set(t-1,e-1):e&1^this.staggerEven?r.set(t,e-1):r.set(t-1,e-1),r}topRight(t,e,i){var r=i||new C;return this.staggerX?t&1^this.staggerEven?r.set(t+1,e):r.set(t+1,e-1):e&1^this.staggerEven?r.set(t+1,e-1):r.set(t,e-1),r}bottomLeft(t,e,i){var r=i||new C;return this.staggerX?t&1^this.staggerEven?r.set(t-1,e+1):r.set(t-1,e):e&1^this.staggerEven?r.set(t,e+1):r.set(t-1,e+1),r}bottomRight(t,e,i){var r=i||new C;return this.staggerX?t&1^this.staggerEven?r.set(t+1,e+1):r.set(t+1,e):e&1^this.staggerEven?r.set(t+1,e+1):r.set(t,e+1),r}pixelToTileCoords(t,e,i){var r=i||new C;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;var n=g.pull("Vector2d",Math.floor(t/(this.columnwidth*2)),Math.floor(e/(this.rowheight*2))),o=g.pull("Vector2d",t-n.x*(this.columnwidth*2),e-n.y*(this.rowheight*2));this.staggerX?(n.x=n.x*2,this.staggerEven&&++n.x):(n.y=n.y*2,this.staggerEven&&++n.y);var h,u,f,c;this.staggerX?(h=this.sidelengthx/2,f=h+this.columnwidth,c=this.tileheight/2,this.centers[0].set(h,c),this.centers[1].set(f,c-this.rowheight),this.centers[2].set(f,c+this.rowheight),this.centers[3].set(f+this.columnwidth,c)):(u=this.sidelengthy/2,f=this.tilewidth/2,c=u+this.rowheight,this.centers[0].set(f,u),this.centers[1].set(f-this.columnwidth,c),this.centers[2].set(f+this.columnwidth,c),this.centers[3].set(f,c+this.rowheight));for(var a=0,l=Number.MAX_VALUE,d=0;d<4;++d){var p=this.centers[d].sub(o).length2();p<l&&(l=p,a=d)}var y=this.staggerX?mc:_c;return r.set(n.x+y[a].x,n.y+y[a].y),g.push(n),g.push(o),r}tileToPixelCoords(t,e,i){var r=Math.floor(t),n=Math.floor(e),o=i||new C;return this.staggerX?(o.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(r)&&(o.y+=this.rowheight),o.x=r*this.columnwidth):(o.x=r*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(o.x+=this.columnwidth),o.y=n*this.rowheight),o}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,r){var n=r.tileset,o=this.tileToPixelCoords(e,i,g.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+o.x,n.tileoffset.y+o.y+(this.tileheight-n.tileheight),r),g.push(o)}drawTileLayer(t,e,i){var r,n=this.pixelToTileCoords(i.pos.x,i.pos.y,g.pull("Vector2d"));n.sub(e.pos);var o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,g.pull("Vector2d")),h=n.clone(),u=o.clone(),f=i.pos.y-o.y<this.sideoffsety,c=i.pos.x-o.x<this.sideoffsetx;f&&n.y--,c&&n.x--;var a=e.cols,l=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o);for(var d=this.doStaggerX(n.x+e.pos.x);o.y<i.bottom&&n.y<l;){for(h.setV(n),u.setV(o);u.x<i.right&&h.x<a;h.x+=2)r=e.cellAt(h.x,h.y,!1),r&&r.tileset.drawTile(t,u.x,u.y,r),u.x+=this.tilewidth+this.sidelengthx;d?(n.x-=1,n.y+=1,o.x-=this.columnwidth,d=!1):(n.x+=1,o.x+=this.columnwidth,d=!0),o.y+=this.rowheight}g.push(h),g.push(u)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o),this.doStaggerY(n.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&n.y<l;n.y++){for(h.setV(n),u.setV(o),this.doStaggerY(n.y)&&(u.x+=this.columnwidth);u.x<i.right&&h.x<a;h.x++)r=e.cellAt(h.x,h.y,!1),r&&r.tileset.drawTile(t,u.x,u.y,r),u.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}g.push(h),g.push(u)}g.push(n),g.push(o)}}class xc extends Oa{canRender(t){return t.orientation==="staggered"&&super.canRender(t)}pixelToTileCoords(t,e,i){var r=i||new C,n=t,o=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;var h=g.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(h.x=h.x*2,this.staggerEven&&++h.x):(h.y=h.y*2,this.staggerEven&&++h.y);var u=g.pull("Vector2d",n-h.x*this.tilewidth,o-h.y*this.tileheight),f=u.x*(this.tileheight/this.tilewidth);return this.sideoffsety-f>u.y&&(h=this.topLeft(h.x,h.y,h)),-this.sideoffsety+f>u.y&&(h=this.topRight(h.x,h.y,h)),this.sideoffsety+f<u.y&&(h=this.bottomLeft(h.x,h.y,h)),this.sideoffsety*3-f<u.y&&(h=this.bottomRight(h.x,h.y,h)),r=this.tileToPixelCoords(h.x,h.y,r),r.set(t-r.x,e-r.y),r.set(r.x-this.tilewidth/2,r.y*(this.tilewidth/this.tileheight)),r.div(this.tilewidth/Math.sqrt(2)).rotate(ea(-45)).add(h),g.push(h),g.push(u),r}}function wc(s){switch(s.orientation){case"orthogonal":return new vc(s);case"isometric":return new yc(s);case"hexagonal":return new Oa(s);case"staggered":return new xc(s);default:throw new Error(s.orientation+" type TMX Tile Map not supported!")}}function vi(s,t,e){var i="melonJS: %s is deprecated since version %s, please use %s",r=new Error().stack;console.groupCollapsed?console.groupCollapsed("%c"+i,"font-weight:normal;color:yellow;",s,e,t):console.warn(i,s,e,t),typeof r<"u"&&console.warn(r),console.groupCollapsed&&console.groupEnd()}function bc(s,t,e){return new ee(s,t,s.tilewidth,s.tileheight,s.orientation,s.tilesets,e)}function Tc(s,t,e){Jt(t.properties,t);var i=g.pull("ImageLayer",+t.offsetx||+t.x||0,+t.offsety||+t.y||0,Object.assign({name:t.name,image:t.image,ratio:g.pull("Vector2d",+t.parallaxx||1,+t.parallaxy||1),tint:typeof t.tintcolor<"u"?g.pull("Color").parseHex(t.tintcolor,!0):void 0,z:e},t.properties)),r=typeof t.visible<"u"?t.visible:!0;return i.setOpacity(r?+t.opacity:0),i}function Ac(s){return new _d(s)}function zs(s,t,e){return new pc(s,t,e)}class Vs{constructor(t,e){this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite||0,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=""+e.version,this.tiledversion=""+e.tiledversion,this.class=e.class,this.tilesets=null,typeof this.layers>"u"&&(this.layers=[]),typeof this.objectGroups>"u"&&(this.objectGroups=[]),this.isEditor=e.editor==="melon-editor",this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,q.checkVersion(this.version,"1.5")<0&&vi("("+this.name+") Tiled Map format version 1.4 and below","Tiled 1.5 or higher","10.4.4"),Jt(this,e),this.initialized=!1}getRenderer(){return(typeof this.renderer>"u"||!this.renderer.canRender(this))&&(this.renderer=wc(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(this.initialized!==!0){var e=0;if(this.tilesets||(this.tilesets=new wd),typeof t.tilesets<"u"){var i=t.tilesets;i.forEach(r=>{this.tilesets.add(Ac(r))})}this.background_image&&this.layers.push(g.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach(r=>{switch(r.type){case"imagelayer":this.layers.push(Tc(this,r,e++));break;case"tilelayer":this.layers.push(bc(this,r,e++));break;case"objectgroup":this.objectGroups.push(zs(this,r,e++));break;case"group":this.objectGroups.push(zs(this,r,e++));break}}),this.initialized=!0}}addTo(t,e,i){var r=t.autoSort,n=t.autoDepth,o=this.getBounds();t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach(u=>{t.addChild(u)}),this.getObjects(e).forEach(u=>{t.addChild(u)}),t.resize(this.bounds.width,this.bounds.height),t.sort(!0);function h(u,f){T.viewport.setBounds(0,0,Math.max(o.width,u),Math.max(o.height,f)),t.pos.set(Math.max(0,~~((u-o.width)/2)),Math.max(0,~~((f-o.height)/2)),t.pos.z)}i===!0&&(Lt(Ft,h),h(T.viewport.width,T.viewport.height),B(Ft,h,this)),t.autoSort=r,t.autoDepth=n}getObjects(t){var e=[],i=!1,r;this.readMapObjects(this.data);for(var n=0;n<this.objectGroups.length;n++){var o=this.objectGroups[n];i=o.name.toLowerCase().includes(xd),t===!1&&(r=new ft(0,0,this.width,this.height),r.anchorPoint.set(0,0),r.name=o.name,r.pos.z=o.z,r.setOpacity(o.opacity),r.autoSort=!1,r.autoDepth=!1);for(var h=0;h<o.objects.length;h++){var u=o.objects[h],f,c;typeof u.anchorPoint>"u"&&(u.anchorPoint={x:0,y:0}),typeof u.tintcolor<"u"&&(u.tint=g.pull("Color"),u.tint.parseHex(u.tintcolor,!0)),u instanceof ee?f=u:typeof u.text=="object"?(typeof u.text.anchorPoint>"u"&&(u.text.anchorPoint=u.anchorPoint),u.text.bitmap===!0?f=g.pull("BitmapText",u.x,u.y,u.text):f=g.pull("Text",u.x,u.y,u.text),f.pos.z=u.z):typeof u.tile=="object"?(c=u.shapes,typeof c>"u"&&(c=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),f=u.tile.getRenderable(u),f.body=new Tt(f,c),f.body.setStatic(!0),f.pos.setMuted(u.x,u.y,u.z)):(typeof u.name<"u"&&u.name!==""?f=g.pull(u.name,u.x,u.y,u):(f=g.pull("Renderable",u.x,u.y,u.width,u.height),c=u.shapes,typeof c>"u"&&(c=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),f.anchorPoint.set(0,0),f.name=u.name,f.type=u.type,f.class=u.class||u.type,f.id=u.id,f.body=new Tt(f,c),f.body.setStatic(!0),f.resize(f.body.getBounds().width,f.body.getBounds().height)),f.pos.z=u.z),i&&!u.name&&f.body&&(f.body.collisionType=Z.types.WORLD_SHAPE,f.body.isStatic=!0),t!==!1?(f.isRenderable===!0&&(f.setOpacity(f.getOpacity()*o.opacity),typeof f.renderable<"u"&&f.renderable.isRenderable===!0&&f.renderable.setOpacity(f.renderable.getOpacity()*o.opacity)),e.push(f)):r.addChild(f)}t===!1&&r.children.length>0&&(r.autoSort=!0,r.autoDepth=!0,e.push(r))}return e}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}var wt={},Mt=[],jt=0;function Ns(s,t,e){t.container.reset(),T.reset(),wt[xe.getCurrentLevelId()]&&wt[xe.getCurrentLevelId()].destroy(),jt=Mt.indexOf(s),Sc(s,t.container,t.flatten,t.setViewportBounds),I(kr,s),t.onLoaded(s),e&&nt.restart()}function Sc(s,t,e,i){var r=wt[s];q.resetGUID(s,r.nextobjectid),t.anchorPoint.set(0,0),r.addTo(t,e,i)}var xe={add(s,t,e){switch(s){case"tmx":if(wt[t]==null)wt[t]=new Vs(t,z.getTMX(t)),Mt.push(t);else return!1;return e&&e(),!0;default:throw new Error("no level loader defined for format "+s)}},load(s,t){if(t=Object.assign({container:T.world,onLoaded:T.onLevelLoaded,flatten:T.mergeGroup,setViewportBounds:!0},t||{}),typeof wt[s]>"u")throw new Error("level "+s+" not found");if(wt[s]instanceof Vs){var e=nt.isRunning();e?(nt.stop(),q.function.defer(Ns,this,s,t,!0)):Ns(s,t)}else throw new Error("no level loader defined");return!0},getCurrentLevelId(){return Mt[jt]},getCurrentLevel(){return wt[this.getCurrentLevelId()]},reload(s){return this.load(this.getCurrentLevelId(),s)},next(s){return jt+1<Mt.length?this.load(Mt[jt+1],s):!1},previous(s){return jt-1>=0?this.load(Mt[jt-1],s):!1},levelCount(){return Mt.length}},st={},Pt={},It={},Rt={},lt={},pr=0,gr=0,Us=0;function Ba(s){if(gr===pr)if(typeof s=="function"||$.onload){clearTimeout(Us);var t=s||$.onload;setTimeout(()=>{t(),I(Tf)},300)}else throw new Error("no load callback defined");else Us=setTimeout(()=>{Ba(s)},100)}function Ec(s,t,e){st[s.name]=new Image,typeof t=="function"&&(st[s.name].onload=t),typeof e=="function"&&(st[s.name].onerror=e),typeof $.crossOrigin=="string"&&(st[s.name].crossOrigin=$.crossOrigin),st[s.name].src=s.src+$.nocache}function Cc(s,t,e){Lr(s.src)===!0&&(s.src.startsWith("url(")||(s.src="url("+s.src+")"));var i=new FontFace(s.name,s.src);i.load().then(()=>{document.fonts.add(i),document.body.style.fontFamily=s.name,typeof t=="function"&&t()},()=>{typeof e=="function"&&e(s.name)})}function Mc(s,t,e){function i(o){Pt[s.name]=o,s.type==="tmx"&&xe.add(s.type,s.name)}if(s.data){i(s.data),typeof t=="function"&&t();return}var r=new XMLHttpRequest,n=Fr(s.src);r.overrideMimeType&&(n==="json"?r.overrideMimeType("application/json"):r.overrideMimeType("text/xml")),r.open("GET",s.src+$.nocache,!0),r.withCredentials=$.withCredentials,r.ontimeout=e,r.onreadystatechange=function(){if(r.readyState===4)if(r.status===200||r.status===0&&r.responseText){var o=null;switch(n){case"xml":case"tmx":case"tsx":if(tt.match(/msie/i)||!r.responseXML)if(globalThis.DOMParser)o=new DOMParser().parseFromString(r.responseText,"text/xml");else throw new Error("XML file format loading not supported, use the JSON file format instead");else o=r.responseXML;var h=K(o);switch(n){case"tmx":o=h.map;break;case"tsx":o=h.tilesets[0];break}break;case"json":case"tmj":case"tsj":o=JSON.parse(r.responseText);break;default:throw new Error("TMX file format "+n+" not supported !")}i(o),typeof t=="function"&&t()}else typeof e=="function"&&e(s.name)},r.send()}function Pc(s,t,e){var i=new XMLHttpRequest;i.overrideMimeType&&i.overrideMimeType("application/json"),i.open("GET",s.src+$.nocache,!0),i.withCredentials=$.withCredentials,i.ontimeout=e,i.onreadystatechange=function(){i.readyState===4&&(i.status===200||i.status===0&&i.responseText?(Rt[s.name]=JSON.parse(i.responseText),typeof t=="function"&&t()):typeof e=="function"&&e(s.name))},i.send()}function Ic(s,t,e){var i=new XMLHttpRequest;i.open("GET",s.src+$.nocache,!0),i.withCredentials=$.withCredentials,i.responseType="arraybuffer",i.onerror=e,i.onload=function(){var r=i.response;if(r){for(var n=new Uint8Array(r),o=[],h=0;h<n.byteLength;h++)o[h]=String.fromCharCode(n[h]);It[s.name]=o.join(""),typeof t=="function"&&t()}},i.send()}function Rc(s,t,e){var i=document.createElement("script");i.src=s.src,i.type="text/javascript",typeof $.crossOrigin=="string"&&(i.crossOrigin=$.crossOrigin),i.defer=!0,typeof t=="function"&&(i.onload=()=>{t()}),typeof e=="function"&&(i.onerror=()=>{e(s.name)}),document.getElementsByTagName("body")[0].appendChild(i)}var $={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded(s){gr++;var t=gr/pr;this.onProgress&&this.onProgress(t,s),I(Qi,t,s)},onLoadingError(s){throw new Error("Failed loading resource "+s.src)},setNocache(s){this.nocache=s?"?"+~~(Math.random()*1e7):""},setBaseURL(s,t){s!=="*"?lt[s]=t:(lt.audio=t,lt.binary=t,lt.image=t,lt.json=t,lt.js=t,lt.tmx=t,lt.tsx=t)},preload(s,t,e=!0){for(var i=0;i<s.length;i++)pr+=this.load(s[i],this.onResourceLoaded.bind(this,s[i]),this.onLoadingError.bind(this,s[i]));typeof t<"u"&&(this.onload=t),e===!0&&nt.change(nt.LOADING),Ba(t)},load(s,t,e){switch(typeof lt[s.type]<"u"&&(s.src=lt[s.type]+s.src),s.type){case"binary":return Ic.call(this,s,t,e),1;case"image":return Ec.call(this,s,t,e),1;case"json":return Pc.call(this,s,t,e),1;case"js":return Rc.call(this,s,t,e),1;case"tmx":case"tsx":return Mc.call(this,s,t,e),1;case"audio":return Bc(s,!!s.stream,t,e),1;case"fontface":return Cc.call(this,s,t,e),1;default:throw new Error("load : unknown or invalid resource type : "+s.type)}},unload(s){switch(s.type){case"binary":return s.name in It?(delete It[s.name],!0):!1;case"image":return s.name in st?(delete st[s.name],!0):!1;case"json":return s.name in Rt?(delete Rt[s.name],!0):!1;case"js":return!0;case"fontface":return!0;case"tmx":case"tsx":return s.name in Pt?(delete Pt[s.name],!0):!1;case"audio":return Da(s.name);default:throw new Error("unload : unknown or invalid resource type : "+s.type)}},unloadAll(){var s;for(s in It)It.hasOwnProperty(s)&&this.unload({name:s,type:"binary"});for(s in st)st.hasOwnProperty(s)&&this.unload({name:s,type:"image"});for(s in Pt)Pt.hasOwnProperty(s)&&this.unload({name:s,type:"tmx"});for(s in Rt)Rt.hasOwnProperty(s)&&this.unload({name:s,type:"json"});Lc()},getTMX(s){return s=""+s,s in Pt?Pt[s]:null},getBinary(s){return s=""+s,s in It?It[s]:null},getImage(s){return s=ti(""+s),s in st?st[s]:null},getJSON(s){return s=""+s,s in Rt?Rt[s]:null}},z=$;let Dt={},La=0,Di=[],Oc=function(s,t){if(La++>3){var e="melonJS: failed loading "+s;throw new Error(e)}else Dt[s].load()};function Bc(s,t,e,i){var r=[];if(Di.length===0)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(Lr(s.src)===!0)r.push(s.src);else for(var n=0;n<Di.length;n++)r.push(s.src+s.name+"."+Di[n]+z.nocache);return Dt[s.name]=new tr.Howl({src:r,volume:tr.Howler.volume(),html5:t===!0,xhrWithCredentials:z.withCredentials,onloaderror(){Oc.call(this,s.name,i)},onload(){La=0,e&&e()}}),1}function Da(s){return s in Dt?(Dt[s].unload(),delete Dt[s],!0):!1}function Lc(){for(var s in Dt)Dt.hasOwnProperty(s)&&Da(s)}const Gs=Math.min,Hs=Math.max;var et=new C;class Dc extends D{constructor(t,e,i,r){super(t,e,i-t,r-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=g.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new zt,this.invCurrentTransform=new Vt,this.offset=new C,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,r),this._updateProjectionMatrix(),B(ri,this.reset,this),B(si,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){var e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=Gs(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=Hs(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){var e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=Gs(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=Hs(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){typeof this.deadzone>"u"&&(this.deadzone=new J(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-e*.25)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),I(Ft,this.width,this.height,this),this}setBounds(t,e,i,r){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,r+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof D)this.target=t.pos;else if(t instanceof C||t instanceof pt||t instanceof ct||t instanceof gt)this.target=t;else throw new Error("invalid target for me.Camera2d.follow");this.follow_axis=typeof e>"u"?this.AXIS.BOTH:e,this.smoothFollow=!1,typeof i!="number"?this.damping=1:this.damping=A(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){var i=this.pos.x,r=this.pos.y;this.pos.x=A(t,this.bounds.left,this.bounds.width),this.pos.y=A(e,this.bounds.top,this.bounds.height),(i!==this.pos.x||r!==this.pos.y)&&(this.isDirty=!0)}updateTarget(){if(this.target){switch(et.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:et.x=this._followH(this.target);break;case this.AXIS.VERTICAL:et.y=this._followV(this.target);break;case this.AXIS.BOTH:et.x=this._followH(this.target),et.y=this._followV(this.target);break}if(!this.pos.equals(et)){if(this.smoothFollow===!0&&this.damping<1)if(ws(et.x,this.pos.x,2)&&ws(et.y,this.pos.y,2)){this.pos.setV(et);return}else this.pos.lerp(et,this.damping);else this.pos.setV(et);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),typeof this._shake.onComplete=="function"&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),this.isDirty===!0&&I(Ji,this.pos),(this._fadeIn.tween!=null||this._fadeOut.tween!=null)&&(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,r,n){(this._shake.duration===0||n===!0)&&(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete=typeof r=="function"?r:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=g.pull("Color").copy(t),this._fadeOut.tween=g.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=g.pull("Color").copy(t);var r=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=g.pull("Tween",this._fadeIn.color).to({alpha:r},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){var e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return e===!0||t.floating===!0?O.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e).add(this.pos).sub(T.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(T.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeIn.color.alpha===1&&(this._fadeIn.tween=null,g.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeOut.color.alpha===0&&(this._fadeOut.tween=null,g.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){var i=this.pos.x+this.offset.x,r=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-r),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,r)}}var Fi,Fc={cameras:[]};class Xr{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new N(0,0,0,0),this.settings=Object.assign(Fc,t||{})}reset(){if(this.settings.cameras.forEach(i=>{this.cameras.set(i.name,i)}),this.cameras.has("default")===!1){if(typeof Fi>"u"){var t=O.getWidth(),e=O.getHeight();Fi=new Dc(0,0,t,e)}this.cameras.set("default",Fi)}T.reset(),this.onResetEvent.apply(this,arguments)}update(t){var e=T.world.update(t);return this.cameras.forEach(i=>{i.update(t)===!0&&(e=!0)}),this.lights.forEach(i=>{i.update(t)===!0&&(e=!0)}),e}draw(t){this.cameras.forEach(e=>{e.draw(t,T.world),this.ambientLight.alpha!==0&&(t.save(),this.lights.forEach(i=>{t.setMask(i.getVisibleArea(),!0)}),t.setColor(this.ambientLight),t.fillRect(0,0,e.width,e.height),t.clearMask(),t.restore()),this.lights.forEach(i=>{i.preDraw(t,T.world),i.draw(t,T.world),i.postDraw(t,T.world)})})}destroy(){this.cameras.clear(),this.lights.forEach(t=>{t.destroy()}),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){typeof this.settings.onResetEvent=="function"&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){typeof this.settings.onDestroyEvent=="function"&&this.settings.onDestroyEvent.apply(this,arguments)}}var kc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII=";class zc extends D{constructor(t,e,i,r){super(t,e,i,r),this.barHeight=r,this.anchorPoint.set(0,0),B(Qi,this.onProgressUpdate,this),B(Ft,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.getWidth(),this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Lt(Qi,this.onProgressUpdate),Lt(Ft,this.resize)}}class Vc extends Xr{onResetEvent(){var t=8;T.world.backgroundColor.parseCSS("#202020"),T.world.addChild(new zc(0,O.getHeight()/2,O.getWidth(),t),1),z.load({name:"melonjs_logo",type:"image",src:kc},()=>{T.world.addChild(new yt(O.getWidth()/2,O.getHeight()/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)})}onDestroyEvent(){z.unload({name:"melonjs_logo",type:"image"})}}var Q=-1,Nt=-1,Ze=!1,X={},Ct={color:"",duration:0},vr=null,yr=null,xt=0;function Fa(){Nt===-1&&Q!==-1&&(Nt=globalThis.requestAnimationFrame(ka))}function Nc(){Ze&&Q!==-1&&(Ze=!1)}function Uc(){Ze=!0}function ka(s){var t=X[Q].stage;T.update(s,t),T.draw(t),Nt!==-1&&(Nt=globalThis.requestAnimationFrame(ka))}function za(){globalThis.cancelAnimationFrame(Nt),Nt=-1}function ki(s){za(),X[Q]&&X[Q].stage.destroy(),X[s]&&(Q=s,X[Q].stage.reset.apply(X[Q].stage,yr),Fa(),I(sa),vr&&vr(),T.repaint())}B(ii,()=>{it.set(it.LOADING,new Vc),it.set(it.DEFAULT,new Xr),B(na,()=>{it.change(it.DEFAULT,!0)}),typeof globalThis.addEventListener=="function"&&(globalThis.addEventListener("blur",()=>{it.pause(!0)},!1),globalThis.addEventListener("focus",()=>{it.resume(!0),cd()},!1)),typeof globalThis.document<"u"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("visibilitychange",()=>{globalThis.document.visibilityState==="visible"?it.resume(!0):it.pause(!0)},!1)});var it={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(s=!1){Q!==this.LOADING&&this.isRunning()&&(za(),s===!0&&s(),xt=globalThis.performance.now(),I(yf))},pause(s=!1){Q!==this.LOADING&&!this.isPaused()&&(Uc(),xt=globalThis.performance.now(),I(vf))},restart(s=!1){this.isRunning()||(Fa(),xt=globalThis.performance.now()-xt,T.repaint(),I(ra,xt))},resume(s=!1){this.isPaused()&&(Nc(),xt=globalThis.performance.now()-xt,I(je,xt))},isRunning(){return Nt!==-1},isPaused(){return Ze},set(s,t,e=!1){if(!(t instanceof Xr))throw new Error(t+" is not an instance of me.Stage");X[s]={},X[s].stage=t,X[s].transition=!0,e===!0&&this.change(s)},get(s=Q){if(typeof X[s]<"u")return X[s].stage},current(){return this.get()},transition(s,t,e){s==="fade"&&(Ct.color=t,Ct.duration=e)},setTransition(s,t){X[s].transition=t},change(s,t){if(typeof X[s]>"u")throw new Error("Undefined Stage for state '"+s+"'");this.isCurrent(s)||(yr=null,arguments.length>1&&(yr=Array.prototype.slice.call(arguments,1)),Ct.duration&&X[s].transition?(vr=()=>{T.viewport.fadeOut(Ct.color,Ct.duration)},T.viewport.fadeIn(Ct.color,Ct.duration,function(){Ki(ki,this,s)})):t===!0?ki(s):Ki(ki,this,s))},isCurrent(s){return Q===s}},nt=it;class Gc{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,B(ii,()=>{this.reset(),this.now=this.last=0,B(aa,this.update.bind(this))}),B(je,()=>{this.reset()}),B(ra,()=>{this.reset()}),B(sa,()=>{this.reset()})}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...r){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}setInterval(t,e,i,...r){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}clearTimeout(t){q.function.defer(this.clearTimer.bind(this),this,t)}clearInterval(t){q.function.defer(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10===0&&(this.fps=A(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(var e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(var t=0,e=this.timers.length;t<e;t++){var i=this.timers[t];i.pauseable&&nt.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),i.repeat===!0?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}}const Hc=new Gc;var W=Hc,Xs=0,ae=["ms","moz","webkit","o"],dt,oe=globalThis.requestAnimationFrame,he=globalThis.cancelAnimationFrame;for(dt=0;dt<ae.length&&!oe;++dt)oe=globalThis[ae[dt]+"RequestAnimationFrame"];for(dt=0;dt<ae.length&&!he;++dt)he=globalThis[ae[dt]+"CancelAnimationFrame"]||globalThis[ae[dt]+"CancelRequestAnimationFrame"];(!oe||!he)&&(oe=function(s){var t=globalThis.performance.now(),e=Math.max(0,1e3/W.maxfps-(t-Xs)),i=globalThis.setTimeout(()=>{s(t+e)},e);return Xs=t+e,i},he=function(s){globalThis.clearTimeout(s)},globalThis.requestAnimationFrame=oe,globalThis.cancelAnimationFrame=he);(()=>{function s(t,e,i,r,n){if(![t,e,i,r].every(v=>Number.isFinite(v)))return;n=d(n);let o,h,u,f;if(n.length===4)o=y(n[0]),h=y(n[1]),u=y(n[2]),f=y(n[3]);else if(n.length===3)o=y(n[0]),h=y(n[1]),f=y(n[1]),u=y(n[2]);else if(n.length===2)o=y(n[0]),u=y(n[0]),h=y(n[1]),f=y(n[1]);else if(n.length===1)o=y(n[0]),h=y(n[0]),u=y(n[0]),f=y(n[0]);else throw new Error(n.length+" is not a valid size for radii sequence.");const c=[o,h,u,f],a=c.find(({x:v,y:_})=>v<0||_<0);if(c.some(({x:v,y:_})=>!Number.isFinite(v)||!Number.isFinite(_)))return;if(a)throw new Error("Radius value "+a+" is negative.");m(c),i<0&&r<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e-h.y,h.x,h.y,0,-Math.PI*1.5,-Math.PI),this.ellipse(t+i+u.x,e+r+u.y,u.x,u.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-f.x,e+r+f.y,f.x,f.y,0,-Math.PI/2,0),this.ellipse(t-o.x,e-o.y,o.x,o.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+u.x,e+r-u.y,u.x,u.y,0,-Math.PI,-Math.PI*1.5,1),this.ellipse(t-f.x,e+r-f.y,f.x,f.y,0,Math.PI/2,0,1),this.ellipse(t-o.x,e+o.y,o.x,o.y,0,0,-Math.PI/2,1)):r<0?(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t+i-u.x,e+r+u.y,u.x,u.y,0,0,-Math.PI/2,1),this.ellipse(t+f.x,e+r+f.y,f.x,f.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+o.x,e-o.y,o.x,o.y,0,-Math.PI,-Math.PI*1.5,1)):(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t+i-u.x,e+r-u.y,u.x,u.y,0,0,Math.PI/2),this.ellipse(t+f.x,e+r-f.y,f.x,f.y,0,Math.PI/2,Math.PI),this.ellipse(t+o.x,e+o.y,o.x,o.y,0,Math.PI,Math.PI*1.5)),this.closePath(),this.moveTo(t,e);function l(v){const{x:_,y:x,z:w,w:b}=v;return{x:_,y:x,z:w,w:b}}function d(v){const _=typeof v;return _==="undefined"||v===null?[0]:_==="function"?[NaN]:_==="object"?typeof v[Symbol.iterator]=="function"?[...v].map(x=>{const w=typeof x;return w==="undefined"||x===null?0:w==="function"?NaN:w==="object"?l(x):p(x)}):[l(v)]:[p(v)]}function p(v){return+v}function y(v){const _=p(v);return Number.isFinite(_)?{x:_,y:_}:Object(v)===v?{x:p(v.x||0),y:p(v.y||0)}:{x:NaN,y:NaN}}function m(v){const[_,x,w,b]=v,S=[Math.abs(i)/(_.x+x.x),Math.abs(r)/(x.y+w.y),Math.abs(i)/(w.x+b.x),Math.abs(r)/(_.y+b.y)],E=Math.min(...S);E<=1&&v.forEach(F=>{F.x*=E,F.y*=E})}}globalThis.CanvasRenderingContext2D&&typeof globalThis.Path2D.prototype.roundRect>"u"&&(globalThis.Path2D.prototype.roundRect=s),globalThis.CanvasRenderingContext2D&&typeof globalThis.CanvasRenderingContext2D.prototype.roundRect>"u"&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=s),globalThis.OffscreenCanvasRenderingContext2D&&typeof globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect>"u"&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=s)})();var mr=[];function De(s,t,e=4,i=4,r=0){if(mr.length>0){var n=mr.pop();return n.world=s,n.bounds=t,n.max_objects=e,n.max_levels=i,n.level=r,n}else return new Va(s,t,e,i,r)}function Xc(s){mr.push(s)}var $s=new C;class Va{constructor(t,e,i=4,r=4,n=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=r,this.level=n,this.objects=[],this.nodes=[]}split(){var t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,r=this.bounds.left,n=this.bounds.top;this.nodes[0]=De(this.world,{left:r+e,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=De(this.world,{left:r,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=De(this.world,{left:r,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=De(this.world,{left:r+e,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t)}getIndex(t){var e,i=t.getBounds();t.isFloating===!0?e=this.world.app.viewport.localToWorld(i.left,i.top,$s):e=$s.set(t.left,t.top);var r=-1,n=e.x,o=e.y,h=i.width,u=i.height,f=this.bounds.left+this.bounds.width/2,c=this.bounds.top+this.bounds.height/2,a=o<c&&o+u<c,l=o>c;return n<f&&n+h<f?a?r=1:l&&(r=2):n>f&&(a?r=0:l&&(r=3)),r}insertContainer(t){for(var e=t.children.length,i;e--,i=t.children[e];)i.isKinematic!==!0&&(typeof i.addChild=="function"?(i.name!=="rootContainer"&&this.insert(i),this.insertContainer(i)):typeof i.getBounds=="function"&&this.insert(i))}insert(t){var e=-1;if(this.nodes.length>0&&(e=this.getIndex(t),e!==-1)){this.nodes[e].insert(t);return}if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){this.nodes.length===0&&this.split();for(var i=0;i<this.objects.length;)e=this.getIndex(this.objects[i]),e!==-1?this.nodes[e].insert(this.objects.splice(i,1)[0]):i=i+1}}retrieve(t,e){var i=this.objects;if(this.nodes.length>0){var r=this.getIndex(t);if(r!==-1)i=i.concat(this.nodes[r].retrieve(t));else for(var n=0;n<this.nodes.length;n=n+1)i=i.concat(this.nodes[n].retrieve(t))}return typeof e=="function"&&i.sort(e),i}remove(t){var e=!1;if(typeof t.getBounds>"u")return!1;if(this.nodes.length>0){var i=this.getIndex(t);i!==-1&&(e=de(this.nodes[i],t),e&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1))}return e===!1&&this.objects.indexOf(t)!==-1&&(de(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(var t=0;t<this.nodes.length;t=t+1){var e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear(),Xc(this.nodes[e]);this.nodes.length=0,typeof t<"u"&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}let le={Linear:{None:function(s){return s}},Quadratic:{In:function(s){return s*s},Out:function(s){return s*(2-s)},InOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}},Cubic:{In:function(s){return s*s*s},Out:function(s){return--s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}},Quartic:{In:function(s){return s*s*s*s},Out:function(s){return 1- --s*s*s*s},InOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}},Quintic:{In:function(s){return s*s*s*s*s},Out:function(s){return--s*s*s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}},Sinusoidal:{In:function(s){return 1-Math.cos(s*Math.PI/2)},Out:function(s){return Math.sin(s*Math.PI/2)},InOut:function(s){return .5*(1-Math.cos(Math.PI*s))}},Exponential:{In:function(s){return s===0?0:Math.pow(1024,s-1)},Out:function(s){return s===1?1:1-Math.pow(2,-10*s)},InOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}},Circular:{In:function(s){return 1-Math.sqrt(1-s*s)},Out:function(s){return Math.sqrt(1- --s*s)},InOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}},Elastic:{In:function(s){return s===0?0:s===1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out:function(s){return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut:function(s){return s===0?0:s===1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}},Back:{In:function(s){var t=1.70158;return s*s*((t+1)*s-t)},Out:function(s){var t=1.70158;return--s*s*((t+1)*s+t)+1},InOut:function(s){var t=2.5949095;return(s*=2)<1?.5*(s*s*((t+1)*s-t)):.5*((s-=2)*s*((t+1)*s+t)+2)}},Bounce:{In:function(s){return 1-le.Bounce.Out(1-s)},Out:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut:function(s){return s<.5?le.Bounce.In(s*2)*.5:le.Bounce.Out(s*2-1)*.5+.5}}},qt={Linear:function(s,t){var e=s.length-1,i=e*t,r=Math.floor(i),n=qt.Utils.Linear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)},Bezier:function(s,t){var e=0,i=s.length-1,r=Math.pow,n=qt.Utils.Bernstein,o;for(o=0;o<=i;o++)e+=r(1-t,i-o)*r(t,o)*s[o]*n(i,o);return e},CatmullRom:function(s,t){var e=s.length-1,i=e*t,r=Math.floor(i),n=qt.Utils.CatmullRom;return s[0]===s[e]?(t<0&&(r=Math.floor(i=e*(1+t))),n(s[(r-1+e)%e],s[r],s[(r+1)%e],s[(r+2)%e],i-r)):t<0?s[0]-(n(s[0],s[0],s[1],s[1],-i)-s[0]):t>1?s[e]-(n(s[e],s[e],s[e-1],s[e-1],i-e)-s[e]):n(s[r?r-1:0],s[r],s[e<r+1?e:r+1],s[e<r+2?e:r+2],i-r)},Utils:{Linear:function(s,t,e){return(t-s)*e+s},Bernstein:function(s,t){var e=qt.Utils.Factorial;return e(s)/e(t)/e(s-t)},Factorial:function(){var s=[1];return function(t){var e=1,i;if(s[t])return s[t];for(i=t;i>1;i--)e*=i;return s[t]=e,e}}(),CatmullRom:function(s,t,e,i,r){var n=(e-s)*.5,o=(i-t)*.5,h=r*r,u=r*h;return(2*t-2*e+n+o)*u+(-3*t+3*e-2*n-o)*h+n*r+t}}};class Ys{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=le.Linear.None,this._interpolationFunction=qt.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=T.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1;for(var e in t)typeof t!="object"&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){B(je,this._resumeCallback,this)}onDeactivateEvent(){Lt(je,this._resumeCallback)}to(t,e){return this._valuesEnd=t,typeof e<"u"&&(typeof e=="number"?this._duration=e:typeof e=="object"&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=W.getTime()){this._onStartCallbackFired=!1,T.world.addChild(this),this._startTime=t+this._delayTime;for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(this._valuesEnd[e].length===0)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array||(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}stop(){return T.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if(typeof t!="function")throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=T.lastUpdate>this._tweenTimeTracker?T.lastUpdate:this._tweenTimeTracker+t;var e=this._tweenTimeTracker,i;if(e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var r=(e-this._startTime)/this._duration;r=r>1?1:r;var n=this._easingFunction(r);for(i in this._valuesEnd){var o=this._valuesStart[i]||0,h=this._valuesEnd[i];h instanceof Array?this._object[i]=this._interpolationFunction(h,n):(typeof h=="string"&&(h=o+parseFloat(h)),typeof h=="number"&&(this._object[i]=o+(h-o)*n))}if(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._object,n),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat){if(typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo){var u=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=u}this._valuesStart[i]=this._valuesStartRepeat[i]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=e+this._delayTime,!0}else{T.world.removeChildNow(this),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object);for(var f=0,c=this._chainedTweens.length;f<c;f++)this._chainedTweens[f].start(e);return!1}return!0}static get Easing(){return le}static get Interpolation(){return qt}}var js={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d"};class $c{constructor(t,e,i=js){i=Object.assign(js,i||{}),this.canvas=Qt(t,e,i.offscreenCanvas),this.context=this.canvas.getContext("2d",{willReadFrequently:i.willReadFrequently}),this.setAntiAlias(i.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){var e=this.canvas;Dr("imageSmoothingEnabled",t,this.context),typeof e.style<"u"&&(t!==!0?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}getImageData(t,e,i,r){return t=A(Math.floor(t),0,this.canvas.width-1),e=A(Math.floor(e),0,this.canvas.height-1),i=A(i,1,this.canvas.width-t),r=A(r,1,this.canvas.height-e),this.context.getImageData(t,e,i,r)}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}class Ws extends D{constructor(t,e,i){super(0,0,1/0,1/0),this.color=g.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){g.push(this.color),this.color=void 0,super.destroy()}}class qs extends yt{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=g.pull("Vector2d",1,1),typeof i.ratio<"u"&&(Br(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),typeof i.anchorPoint>"u"?this.anchorPoint.set(0,0):typeof i.anchorPoint=="number"?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",B(We,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0;break}this.resize(T.viewport.width,T.viewport.height),this.createPattern()}onActivateEvent(){B(Ji,this.updateLayer,this),B(Ft,this.resize,this),ha(kr,()=>{this.updateLayer(T.viewport.pos)}),this.ancestor.root!==!0&&this.updateLayer(T.viewport.pos)}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=O.createPattern(this.image,this._repeat)}updateLayer(t){var e=this.ratio.x,i=this.ratio.y;if(!(e===0&&i===0)){var r=this.width,n=this.height,o=T.viewport.bounds.width,h=T.viewport.bounds.height,u=this.anchorPoint.x,f=this.anchorPoint.y,c=u*(e-1)*(o-T.viewport.width)+this.offset.x-e*t.x,a=f*(i-1)*(h-T.viewport.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=c%r:this.pos.x=c,this.repeatY?this.pos.y=a%n:this.pos.y=a,this.isDirty=!0}}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint)}draw(t,e){var i=this.width,r=this.height,n=e.bounds.width,o=e.bounds.height,h=this.anchorPoint.x,u=this.anchorPoint.y,f=this.pos.x,c=this.pos.y;this.ratio.x===0&&this.ratio.y===0&&(f=f+h*(n-i),c=c+u*(o-r)),t.translate(f,c),t.drawPattern(this._pattern,0,0,e.width*2,e.height*2)}onDeactivateEvent(){Lt(Ji,this.updateLayer),Lt(Ft,this.resize)}destroy(){g.push(this.ratio),this.ratio=void 0,Lt(We,this.createPattern),super.destroy()}}class Ks extends yt{constructor(t,e,i){if(super(t,e,i),typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){var e=this.current,i=this.pos.x,r=this.pos.y,n=e.width,o=e.height,h=e.offset,u=this.offset;e.angle!==0&&(t.translate(-i,-r),t.rotate(e.angle),i-=o,n=e.height,o=e.width);var f=u.x+h.x,c=u.y+h.y,a=this.insetx||n/4,l=this.insety||o/4;t.drawImage(this.image,f,c,a,l,i,r,a,l),t.drawImage(this.image,f+n-a,c,a,l,i+this.nss_width-a,r,a,l),t.drawImage(this.image,f,c+o-l,a,l,i,r+this.nss_height-l,a,l),t.drawImage(this.image,f+n-a,c+o-l,a,l,i+this.nss_width-a,r+this.nss_height-l,a,l);var d=n-(a<<1),p=o-(l<<1),y=this.nss_width-(a<<1),m=this.nss_height-(l<<1);t.drawImage(this.image,f+a,c,d,l,i+a,r,y,l),t.drawImage(this.image,f+a,c+o-l,d,l,i+a,r+this.nss_height-l,y,l),t.drawImage(this.image,f,c+l,a,p,i,r+l,a,m),t.drawImage(this.image,f+n-a,c+l,a,p,i+this.nss_width-a,r+l,a,m),t.drawImage(this.image,f+a,c+l,d,p,i+a,r+l,y,m)}}function _r(s,t,e=!1){s.font=t.font,s.fillStyle=t.fillStyle.toRGBA(),e===!0&&(s.strokeStyle=t.strokeStyle.toRGBA(),s.lineWidth=t.lineWidth),s.textAlign=t.textAlign,s.textBaseline=t.textBaseline}const Yc=["ex","em","pt","px"],jc=[12,24,.75,1];var zi=function(s,t){return t.offScreenCanvas===!0?t.canvasTexture.context:(typeof s>"u"&&(s=O),s.getFontContext())};class Qe extends D{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.onResetEvent(t,e,i)}onResetEvent(t,e,i){typeof i.fillStyle<"u"?i.fillStyle instanceof N?this.fillStyle=i.fillStyle:this.fillStyle=g.pull("Color").parseCSS(i.fillStyle):this.fillStyle=g.pull("Color",0,0,0),typeof i.strokeStyle<"u"?i.strokeStyle instanceof N?this.strokeStyle=i.strokeStyle:this.strokeStyle=g.pull("Color").parseCSS(i.strokeStyle):this.strokeStyle=g.pull("Color",0,0,0),this.lineWidth=i.lineWidth||1,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.offScreenCanvas=!1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontSize=10,typeof i.anchorPoint<"u"?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),typeof i.floating<"u"&&(this.floating=!!i.floating),this.setFont(i.font,i.size),i.bold===!0&&this.bold(),i.italic===!0&&this.italic(),i.offScreenCanvas===!0&&(this.offScreenCanvas=!0,this.canvasTexture=g.pull("CanvasTexture",2,2,{offscreenCanvas:!0})),this.metrics=new Na(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){var i=t.split(",").map(n=>(n=n.trim(),/(^".*"$)|(^'.*'$)/.test(n)?n:'"'+n+'"'));if(typeof e=="number")this.fontSize=e,e+="px";else{var r=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(r[1]),r[2]?this.fontSize*=jc[Yc.indexOf(r[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){var e=this.getBounds();if(this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`)),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,zi(O,this))),e.addBounds(this.metrics.measureText(this._text,zi(O,this)),!0),this.offScreenCanvas===!0){var i=Math.ceil(this.metrics.width),r=Math.ceil(this.metrics.height);O instanceof Ke&&(this.glTextureUnit=O.cache.getUnit(O.cache.get(this.canvasTexture.canvas)),O.currentCompositor.unbindTexture2D(null,this.glTextureUnit),O.WebGLVersion===1&&(i=Ye(this.metrics.width),r=Ye(this.metrics.height))),(this.canvasTexture.width<i||this.canvasTexture.height<r)&&this.canvasTexture.resize(i,r),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y,!1)}return this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,zi(t,this))}draw(t,e,i=this.pos.x,r=this.pos.y,n=!1){typeof this.ancestor>"u"?((this.pos.x!==i||this.pos.y!==r)&&(this.pos.x=i,this.pos.y=r,this.isDirty=!0),this.setText(e),i=this.metrics.x,r=this.metrics.y,t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())):(i=this.pos.x,r=this.pos.y),t.settings.subPixel===!1&&(i=~~i,r=~~r),this.offScreenCanvas===!0?t.drawImage(this.canvasTexture.canvas,i,r):t.drawFont(this._drawFont(t.getFontContext(),this._text,i,r,n)),typeof this.ancestor>"u"&&t.restore()}drawStroke(t,e,i,r){this.draw(t,e,i,r,!0)}_drawFont(t,e,i,r,n=!1){_r(t,this,n);for(var o=0;o<e.length;o++){var h=e[o].trimEnd();t[n?"strokeText":"fillText"](h,i,r),r+=this.metrics.lineHeight()}return this.metrics}destroy(){this.offScreenCanvas===!0&&(O instanceof Ke&&(O.currentCompositor.deleteTexture2D(O.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),O.cache.delete(this.canvasTexture.canvas),g.push(this.canvasTexture),this.canvasTexture=void 0),g.push(this.fillStyle),g.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Na extends Y{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof Qe?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof Qe)return e.measureText(t).width;for(var i=t.split(""),r=0,n=null,o=0;o<i.length;o++){var h=i[o].charCodeAt(0),u=this.ancestor.fontData.glyphs[h];if(typeof u<"u"){var f=n&&n.kerning?n.getKerning(h):0;r+=(u.xadvance+f)*this.ancestor.fontScale.x,n=u}}return r}measureText(t,e){var i;Array.isArray(t)?i=t:i=(""+t).split(`
`),typeof e<"u"&&(e.save(),_r(e,this.ancestor)),this.width=this.height=0;for(var r=0;r<i.length;r++)this.width=Math.max(this.lineWidth(i[r].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor(this.ancestor.textAlign==="right"?this.ancestor.pos.x-this.width:this.ancestor.textAlign==="center"?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(this.ancestor.textBaseline.search(/^(top|hanging)$/)===0?this.ancestor.pos.y:this.ancestor.textBaseline==="middle"?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),typeof e<"u"&&e.restore(),this}wordWrap(t,e,i){var r,n="",o=[];Array.isArray(t)&&(t=t.join(" ")),r=t.replace(/[\r\n]+/g," ").split(" "),typeof i<"u"&&(i.save(),_r(i,this.ancestor));for(let f=0;f<r.length;f++){var h=r[f],u=this.lineWidth(n+h+" ",i);u<e?n+=h+" ":(o.push(n+`
`),n=h+" ")}return o.push(n),typeof i<"u"&&i.restore(),o}}class Zs extends D{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=g.pull("Vector2d",1,1),this.fontImage=typeof i.font=="object"?i.font:z.getImage(i.font),typeof i.fontData!="string"?this.fontData=g.pull("BitmapTextData",z.getBinary(i.font)):this.fontData=g.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:z.getBinary(i.fontData)),typeof i.floating<"u"&&(this.floating=!!i.floating),typeof i.fillStyle<"u"&&(this.fillStyle=i.fillStyle),typeof i.anchorPoint<"u"?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Na(this),typeof i.size=="number"&&i.size!==1&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this}get fillStyle(){return this.tint}set fillStyle(t){t instanceof N?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,r){var n=t.globalAlpha();typeof this.ancestor>"u"?(this.setText(e),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,r=this.pos.y);for(var o=i,h=this.metrics.lineHeight(),u=0,f=0;f<this._text.length;f++){i=o;var c=this._text[f].trimEnd(),a=this.metrics.lineWidth(c);switch(this.textAlign){case"right":i-=a;break;case"center":i-=a*.5;break}switch(this.textBaseline){case"middle":r-=h*.5;break;case"ideographic":case"alphabetic":case"bottom":r-=h;break}this.isDirty===!0&&typeof this.ancestor>"u"&&(f===0&&(this.pos.y=r),u<a&&(u=a,this.pos.x=i));for(var l=null,d=0,p=c.length;d<p;d++){var y=c.charCodeAt(d),m=this.fontData.glyphs[y];if(typeof m<"u"){var v=m.width,_=m.height,x=l&&l.kerning?l.getKerning(y):0,w=this.fontScale.x,b=this.fontScale.y;v!==0&&_!==0&&t.drawImage(this.fontImage,m.x,m.y,v,_,i+m.xoffset*w,r+m.yoffset*b,v*w,_*b),i+=(m.xadvance+x)*w,l=m}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(y))}r+=h}typeof this.ancestor>"u"&&t.setGlobalAlpha(n),this.isDirty=!1}destroy(){g.push(this.fontScale),this.fontScale=void 0,g.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Qs extends yt{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;var r=i.shapes;typeof r>"u"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new Tt(this,r),this.body.collisionType=Z.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Z.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class Js extends D{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(n=>{typeof i[n]<"u"&&(this.triggerSettings[n]=i[n])});var r=i.shapes;typeof r>"u"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new Tt(this,r),this.body.collisionType=Z.types.ACTION_OBJECT,this.body.setCollisionMask(Z.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){return typeof this.triggerSettings.container=="string"&&(this.triggerSettings.container=T.world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){xe.load(this.gotolevel,this.getTriggerSettings()),T.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){var t=this.getTriggerSettings();if(t.event==="level")this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,T.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):xe.load(this.gotolevel,t);else throw new Error("Trigger invalid type")}onCollision(t,e){return this.name==="Trigger"&&this.triggerEvent.apply(this),!1}}function Wc(s){var t=s.texture.context,e=s.texture.width/2,i=s.texture.height/2,r=s.radiusX,n=s.radiusY,o,h,u,f,c;s.texture.clear(),r>=n?(o=1,u=1,h=n/r,f=r/n,c=t.createRadialGradient(e,i*f,0,e,n*f,r)):(h=1,f=1,o=r/n,u=n/r,c=t.createRadialGradient(e*u,i,0,e*u,i,n)),c.addColorStop(0,s.color.toRGBA(s.intensity)),c.addColorStop(1,s.color.toRGBA(0)),t.fillStyle=c,t.setTransform(o,0,0,h,0,0),t.fillRect(0,0,s.texture.width*u,s.texture.height*f)}class tn extends D{constructor(t,e,i,r=i,n="#FFF",o=.7){super(t,e,i*2,r*2),this.color=g.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=r,this.intensity=o,this.blendMode="lighter",this.visibleArea=g.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=g.pull("CanvasTexture",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),Wc(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){g.push(this.color),this.color=void 0,g.push(this.texture),this.texture=void 0,g.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}const ne=9,en=1<<ne;class Ua{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){var e=this.kerning[t>>>ne];if(e)return e[t&en-1]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});var i=this.kerning[t>>>ne];typeof i>"u"&&(this.kerning[t>>>ne]={},i=this.kerning[t>>>ne]),i[t&en-1]=e}}const rn=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function sn(s,t){var e=s.match(t);if(!e)throw new Error("Could not find pattern "+t+" in string: "+s);return e[0].split("=")[1]}function qc(s){for(var t=Object.keys(s),e=0;e<t.length;e++)if(t[e]>32)return s[t[e]];return null}function Kc(s){var t=" ".charCodeAt(0),e=s[t];e||(e=new Ua,e.id=t,e.xadvance=qc(s).xadvance,s[t]=e)}class nn{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");var e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");var r=i[0].split("=")[1].split(",");this.padTop=parseFloat(r[0]),this.padLeft=parseFloat(r[1]),this.padBottom=parseFloat(r[2]),this.padRight=parseFloat(r[3]),this.lineHeight=parseFloat(sn(e[1],/lineHeight\=\d+/g));var n=parseFloat(sn(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,h=null,u;for(u=4;u<e.length;u++){var f=e[u],c=f.split(/=|\s+/);if(!(!f||/^kernings/.test(f)))if(/^kerning\s/.test(f)){var a=parseFloat(c[2]),l=parseFloat(c[4]),d=parseFloat(c[6]);h=this.glyphs[a],h!==null&&typeof h<"u"&&h.setKerning(l,d)}else{h=new Ua;var p=parseFloat(c[2]);h.id=p,h.x=parseFloat(c[4]),h.y=parseFloat(c[6]),h.width=parseFloat(c[8]),h.height=parseFloat(c[10]),h.xoffset=parseFloat(c[12]),h.yoffset=parseFloat(c[14]),h.xadvance=parseFloat(c[16]),h.width>0&&h.height>0&&(this.descent=Math.min(n+h.yoffset,this.descent)),this.glyphs[p]=h}}this.descent+=this.padBottom,Kc(this.glyphs);var y=null;for(u=0;u<rn.length;u++){var m=rn[u];if(y=this.glyphs[m.charCodeAt(0)],y)break}if(y)this.capHeight=y.height;else for(var v in this.glyphs)if(this.glyphs.hasOwnProperty(v)){if(h=this.glyphs[v],h.height===0||h.width===0)continue;this.capHeight=Math.max(this.capHeight,h.height)}this.capHeight-=o}}const xr=-1,Zc=0,wr=1;var M=[];for(var an=0;an<10;an++)M.push(new C);var Ot=[];for(var on=0;on<5;on++)Ot.push([]);function hn(s,t,e){for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=s.length,o=0;o<n;o++){var h=s[o].dot(t);h<i&&(i=h),h>r&&(r=h)}e[0]=i,e[1]=r}function ln(s,t,e,i,r,n){var o=Ot.pop(),h=Ot.pop(),u=M.pop().copy(t).sub(s),f=u.dot(r);if(hn(e,r,o),hn(i,r,h),h[0]+=f,h[1]+=f,o[0]>h[1]||h[0]>o[1])return M.push(u),Ot.push(o),Ot.push(h),!0;if(n){var c=0;if(o[0]<h[0])if(n.aInB=!1,o[1]<h[1])c=o[1]-h[0],n.bInA=!1;else{var a=o[1]-h[0],l=h[1]-o[0];c=a<l?a:-l}else if(n.bInA=!1,o[1]>h[1])c=o[0]-h[1],n.aInB=!1;else{var d=o[1]-h[0],p=h[1]-o[0];c=d<p?d:-p}var y=Math.abs(c);y<n.overlap&&(n.overlap=y,n.overlapN.copy(r),c<0&&n.overlapN.negateSelf())}return M.push(u),Ot.push(o),Ot.push(h),!1}function Vi(s,t){var e=s.length2(),i=t.dot(s);return i<0?xr:i>e?wr:Zc}function Qc(s,t,e,i,r){var n=t.points,o=t.normals,h=o.length,u=i.points,f=i.normals,c=f.length,a=M.pop().copy(s.pos).add(s.ancestor.getAbsolutePosition()).add(t.pos),l=M.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos),d;for(d=0;d<h;d++)if(ln(a,l,n,u,o[d],r))return M.push(a),M.push(l),!1;for(d=0;d<c;d++)if(ln(a,l,n,u,f[d],r))return M.push(a),M.push(l),!1;return r&&(r.a=s,r.b=e,r.overlapV.copy(r.overlapN).scale(r.overlap)),M.push(a),M.push(l),!0}function Jc(s,t,e,i,r){var n=M.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(t.pos),o=t.radius,h=i.radius,u=o+h,f=u*u,c=n.length2();if(c>f)return M.push(n),!1;if(r){var a=Math.sqrt(c);r.a=s,r.b=e,r.overlap=u-a,r.overlapN.copy(n.normalize()),r.overlapV.copy(n).scale(r.overlap),r.aInB=o<=h&&a<=h-o,r.bInA=h<=o&&a<=o-h}return M.push(n),!0}function Ga(s,t,e,i,r){for(var n=M.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(t.pos),o=i.radius,h=o*o,u=t.points,f=t.edges,c=f.length,a=M.pop(),l=M.pop(),d=M.pop(),p=0,y=0;y<c;y++){var m=y===c-1?0:y+1,v=y===0?c-1:y-1,_=0,x=null;a.copy(f[y]),d.copy(n).sub(u[y]),r&&d.length2()>h&&(r.aInB=!1);var w=Vi(a,d),b=!0;if(w===xr){var S=null;if(c>1&&(a.copy(f[v]),S=M.pop().copy(n).sub(u[v]),w=Vi(a,S),w!==wr&&(b=!1)),b){if(p=d.length(),p>o)return M.push(n),M.push(a),M.push(l),M.push(d),S&&M.push(S),!1;r&&(r.bInA=!1,x=d.normalize(),_=o-p)}S&&M.push(S)}else if(w===wr){if(c>1&&(a.copy(f[m]),d.copy(n).sub(u[m]),w=Vi(a,d),w!==xr&&(b=!1)),b){if(p=d.length(),p>o)return M.push(n),M.push(a),M.push(l),M.push(d),!1;r&&(r.bInA=!1,x=d.normalize(),_=o-p)}}else{l.copy(t.normals[y]),p=d.dot(l);var E=Math.abs(p);if((c===1||p>0)&&E>o)return M.push(n),M.push(a),M.push(l),M.push(d),!1;r&&(x=l,_=o-p,(p>=0||_<2*o)&&(r.bInA=!1))}x&&r&&Math.abs(_)<Math.abs(r.overlap)&&(r.overlap=_,r.overlapN.copy(x))}return r&&(r.a=s,r.b=e,r.overlapV.copy(r.overlapN).scale(r.overlap)),M.push(n),M.push(a),M.push(l),M.push(d),!0}function tp(s,t,e,i,r){var n=Ga(e,i,s,t,r);if(n&&r){var o=r.a,h=r.aInB;r.overlapN.negateSelf(),r.overlapV.negateSelf(),r.a=r.b,r.b=o,r.aInB=r.bInA,r.bInA=h}return n}var un=Object.freeze({__proto__:null,testEllipseEllipse:Jc,testEllipsePolygon:tp,testPolygonEllipse:Ga,testPolygonPolygon:Qc});class ep{constructor(){this.a=null,this.b=null,this.overlapN=new C,this.overlapV=new C,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}let ip={pos:new C(0,0),ancestor:{_absPos:new C(0,0),getAbsolutePosition:function(){return this._absPos}}},Ni=new Y,Ui=new Y;class rp{constructor(t){this.world=t,this.response=new ep}shouldCollide(t,e){var i=t.body,r=e.body;return typeof i=="object"&&typeof r=="object"&&t!==e&&t.isKinematic!==!0&&e.isKinematic!==!0&&i.shapes.length>0&&r.shapes.length>0&&!(i.isStatic===!0&&r.isStatic===!0)&&(i.collisionMask&r.collisionType)!==0&&(i.collisionType&r.collisionMask)!==0}collides(t,e,i=this.response){for(var r=t.shapes.length,n;r--,n=t.shapes[r];)for(var o=e.shapes.length,h;o--,h=e.shapes[o];)if(un["test"+n.shapeType+h.shapeType].call(this,t.ancestor,n,e.ancestor,h,i.clear())===!0)return i.indexShapeA=r,i.indexShapeB=o,!0;return!1}collisions(t){var e=0,i=this.world.broadphase.retrieve(t);return Ni.addBounds(t.getBounds(),!0),Ni.addBounds(t.body.getBounds()),i.forEach(r=>{this.shouldCollide(t,r)&&(Ui.addBounds(r.getBounds(),!0),Ui.addBounds(r.body.getBounds()),Ni.overlaps(Ui)&&this.collides(t.body,r.body)&&(e++,t.onCollision&&t.onCollision(this.response,r)!==!1&&t.body.isStatic===!1&&t.body.respondToCollision.call(t.body,this.response),r.onCollision&&r.onCollision(this.response,t)!==!1&&r.body.isStatic===!1&&r.body.respondToCollision.call(r.body,this.response)))}),e>0}rayCast(t,e=[]){for(var i=0,r=this.world.broadphase.retrieve(t),n=r.length,o;n--,o=r[n];)if(o.body&&t.getBounds().overlaps(o.getBounds())){var h=o.body.shapes.length;if(o.body.shapes.length===0)continue;var u=t,f=0;do{var c=o.body.getShape(f);un["test"+u.shapeType+c.shapeType].call(this,ip,u,o,c)&&(e[i]=o,i++),f++}while(f<h)}return e.length=i,e}}class sp extends ft{constructor(t=0,e=0,i=1/0,r=1/0){super(t,e,i,r,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=void 0,this.fps=60,this.gravity=new C(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Va(this,this.getBounds().clone(),Z.maxChildren,Z.maxDepth),this.detector=new rp(this),B(ri,this.reset,this),B(kr,()=>{this.broadphase.clear(this.getBounds())})}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return this.bodies.add(t),this}removeBody(t){return this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&t.gravityScale!==0){var e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){var e=nt.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),this.bodies.forEach(i=>{if(!i.isStatic){var r=i.ancestor;!(e&&!r.updateWhenPaused)&&(r.inViewport||r.alwaysUpdate)&&(this.bodyApplyGravity(i),i.update(t)===!0&&(r.isDirty=!0),this.detector.collisions(r),i.force.set(0,0))}}),super.update(t)}}class fn extends D{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){e===!1?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=g.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,typeof t.settings.tint=="string"&&this.tint.parseCSS(t.settings.tint),t.settings.textureAdditive===!0&&(this.blendMode="additive"),t.settings.blendMode!=="normal"&&(this.blendMode=t.settings.blendMode);var i=t.settings.angle+(t.settings.angleVariation>0?($t(0,2)-1)*t.settings.angleVariation:0),r=t.settings.speed+(t.settings.speedVariation>0?($t(0,2)-1)*t.settings.speedVariation:0);this.vel.set(r*Math.cos(i),-r*Math.sin(i)),this.life=$t(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=A($t(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=A($t(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=W.maxfps/1e3,t.settings.followTrajectory||(this.angle=$t(t.settings.minRotation,t.settings.maxRotation))}update(t){var e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;var i=this.life/this.startLife,r=this.startScale;this.startScale>this.endScale?(r*=i,r=r<this.endScale?this.endScale:r):this.startScale<this.endScale&&(r/=i,r=r>this.endScale?this.endScale:r),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;var n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(r,0,0,0,r,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){var e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class dn extends D{constructor(t,e,i){if(typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new yt(0,0,i)),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),typeof i.name=="string"&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,typeof i.shapes>"u"&&(i.shapes=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])),this.body=new Tt(this,i.shapes,this.onBodyUpdate.bind(this)),this.width===0&&this.height===0&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(t instanceof D)this.children[0]=t,this.children[0].ancestor=this;else throw new Error(t+"should extend me.Renderable")}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}onBodyUpdate(t){this.getBounds().addBounds(t.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof D&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){var i=this.renderable;i instanceof D&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function np(s){try{if(dd(s))return new Ke(s)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new Gr(s)}function cn(s,t,e){var i=s.renderer,r=i.getCanvas(),n=i.getContext(),o=i.settings,h=xa,u=o.zoomX=r.width*t*h,f=o.zoomY=r.height*e*h;i.scaleRatio.set(t*h,e*h),r.style.width=u/h+"px",r.style.height=f/h+"px",i.setAntiAlias(n,o.antiAlias),i.setBlendMode(o.blendMode,n),s.repaint()}function Fe(s){var t=s.renderer,e=t.settings,i=1,r=1;if(e.autoScale){var n=1/0,o=1/0;if(globalThis.getComputedStyle){var h=globalThis.getComputedStyle(t.getCanvas(),null);n=parseInt(h.maxWidth,10)||1/0,o=parseInt(h.maxHeight,10)||1/0}var u=fd(s.getParentElement()),f=Math.min(n,u.width),c=Math.min(o,u.height),a=f/c;if(e.scaleMethod==="fill-min"&&a>t.designRatio||e.scaleMethod==="fill-max"&&a<t.designRatio||e.scaleMethod==="flex-width"){var l=Math.min(n,e.height*a);i=r=f/l,t.resize(Math.floor(l),e.height)}else if(e.scaleMethod==="fill-min"&&a<t.designRatio||e.scaleMethod==="fill-max"&&a>t.designRatio||e.scaleMethod==="flex-height"){var d=Math.min(o,e.width*(c/f));i=r=c/d,t.resize(e.width,Math.floor(d))}else e.scaleMethod==="flex"?t.resize(Math.floor(f),Math.floor(c)):e.scaleMethod==="stretch"?(i=f/e.width,r=c/e.height):a<t.designRatio?i=r=f/e.width:i=r=c/e.height;cn(s,i,r)}else cn(s,e.scale,e.scale)}const ap={parent:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",transparent:!1,premultipliedAlpha:!0,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0,legacy:!1};function op(s){var t=s.renderer.type,e=typeof s.renderer.GPURenderer=="string"?" ("+s.renderer.GPURenderer+")":"",i=sd?"Web Audio":"HTML5 Audio";console.log(t+" renderer"+e+" | "+i+" | pixel ratio "+xa+" | "+(ye.nodeJS?"node.js":ye.isMobile?"mobile":"desktop")+" | "+ld()+" | "+ad),console.log("resolution: requested "+s.settings.width+"x"+s.settings.height+", got "+s.renderer.getWidth()+"x"+s.renderer.getHeight())}class hp{constructor(t,e,i){this.parentElement=void 0,this.renderer=void 0,this.viewport=void 0,this.world=void 0,this.mergeGroup=!0,this.sortOn="z",this.lastUpdate=0,this.isInitialized=!1,this.settings=void 0,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0,i.legacy!==!0&&this.init(t,e,i)}init(t,e,i){this.settings=Object.assign(ap,i||{}),this.settings.width=t,this.settings.height=e,this.settings.transparent=!!this.settings.transparent,this.settings.antiAlias=!!this.settings.antiAlias,this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat,this.settings.subPixel=!!this.settings.subPixel,this.settings.verbose=!!this.settings.verbose,this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)!==-1?this.settings.autoScale=this.settings.scale==="auto"||!0:(this.settings.scaleMethod="fit",this.settings.autoScale=this.settings.scale==="auto"||!1);var r=q.getUriFragment();if(r.webgl===!0||r.webgl1===!0||r.webgl2===!0?(this.settings.renderer=ar,r.webgl1===!0&&(this.settings.preferWebGL1=!0)):r.canvas===!0&&(this.settings.renderer=Ta),this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1,this.settings.zoomX=t*this.settings.scale,this.settings.zoomY=e*this.settings.scale,typeof this.settings.renderer=="number")switch(this.settings.renderer){case Aa:case ar:this.renderer=np(this.settings);break;default:this.renderer=new Gr(this.settings);break}else{var n=this.settings.renderer;this.renderer=new n(this.settings)}if(B(oa,()=>{Fe(this)},this),B(Ne,()=>{Fe(this)},this),this.parentElement=wa(this.settings.parent),this.parentElement.appendChild(this.renderer.getCanvas()),ye.isMobile&&hd(!1),Fe(this),"MutationObserver"in globalThis){var o=new MutationObserver(Fe.bind(this,this));o.observe(this.parentElement,{attributes:!1,childList:!0,subtree:!0})}this.settings.consoleHeader!==!1&&op(this),this.world=new sp,this.world.app=this,this.lastUpdate=globalThis.performance.now(),this.isInitialized=!0,I(mf,this)}reset(){var t=nt.get();typeof t<"u"&&(this.viewport=t.cameras.get("default")),I(ri),this.updateFrameRate()}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/W.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=this.stepSize*10,this.isAlwaysDirty=W.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=!0}update(t,e){if(++this.frameCounter%this.frameRate===0){for(this.frameCounter=0,I(aa,t),this.accumulator+=W.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=W.interpolation?W.getDelta():this.stepSize,this.accumulatorUpdateDelta=W.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||W.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),nt.isPaused()!==!0&&I(xf,t),this.isDirty=e.update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,W.interpolation){this.accumulator=0;break}I(_f,this.lastUpdate)}}draw(t){this.renderer.isContextValid===!0&&(this.isDirty||this.isAlwaysDirty)&&(I(wf,globalThis.performance.now()),this.renderer.clear(),t.draw(this.renderer),this.isDirty=!1,this.renderer.flush(),I(bf,globalThis.performance.now()))}}Object.defineProperty(Ae.prototype,"Texture",{get:function(){return vi("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),_e}});Ae.prototype.getScreenCanvas=function(){return vi("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()};Ae.prototype.getScreenContext=function(){return vi("getScreenContext","getContext","13.1.0"),this.getContext()};const lp="14.4.0";var br=!1;const T=new hp(0,0,{legacy:!0});function up(){br!==!0&&(console.log("melonJS 2 (v"+lp+") | http://melonjs.org"),g.register("me.Entity",dn),g.register("me.Collectable",Qs),g.register("me.Trigger",Js),g.register("me.Light2d",tn),g.register("me.Tween",Ys,!0),g.register("me.Color",N,!0),g.register("me.Particle",fn,!0),g.register("me.Sprite",yt),g.register("me.NineSliceSprite",Ks),g.register("me.Renderable",D),g.register("me.Text",Qe,!0),g.register("me.BitmapText",Zs),g.register("me.BitmapTextData",nn,!0),g.register("me.ImageLayer",qs),g.register("me.ColorLayer",Ws,!0),g.register("me.Vector2d",C,!0),g.register("me.Vector3d",pt,!0),g.register("me.ObservableVector2d",ct,!0),g.register("me.ObservableVector3d",gt,!0),g.register("me.Matrix2d",Vt,!0),g.register("me.Matrix3d",zt,!0),g.register("me.Rect",J,!0),g.register("me.RoundRect",te,!0),g.register("me.Polygon",vt,!0),g.register("me.Line",me,!0),g.register("me.Point",Zt,!0),g.register("me.Ellipse",At,!0),g.register("me.Bounds",Y,!0),g.register("Entity",dn),g.register("Collectable",Qs),g.register("Trigger",Js),g.register("Light2d",tn),g.register("Tween",Ys,!0),g.register("Color",N,!0),g.register("Particle",fn,!0),g.register("Sprite",yt),g.register("NineSliceSprite",Ks),g.register("Renderable",D),g.register("Text",Qe,!0),g.register("BitmapText",Zs),g.register("BitmapTextData",nn,!0),g.register("ImageLayer",qs),g.register("ColorLayer",Ws,!0),g.register("Vector2d",C,!0),g.register("Vector3d",pt,!0),g.register("ObservableVector2d",ct,!0),g.register("ObservableVector3d",gt,!0),g.register("Matrix2d",Vt,!0),g.register("Matrix3d",zt,!0),g.register("Rect",J,!0),g.register("RoundRect",te,!0),g.register("Polygon",vt,!0),g.register("Line",me,!0),g.register("Point",Zt,!0),g.register("Ellipse",At,!0),g.register("Bounds",Y,!0),g.register("CanvasTexture",$c,!0),I(ii),z.setNocache(q.getUriFragment().nocache||!1),tc(),br=!0)}od(()=>{up()});class fp extends D{constructor(t){super(0,0,t.width,t.heigth),this.engine=t,this.anchorPoint.set(0,0);const e=new Array(t.count),i=[1,-1];for(let r=0;r<t.count;r++){const n=10+Math.random()*80,o=Math.random()*t.width,h=Math.random()*(t.height-n),[u,f]=[3*Math.random()*i[Math.floor(Math.random()*2)],3*Math.random()*i[Math.floor(Math.random()*2)]];e[r]={x:o,y:h,size:n,dx:u,dy:f}}this.particles=e}update(){return!0}draw(t){t.clearColor("#1a1a1a"),t.setColor("#ffffff");const e=this.particles;for(let i=0;i<this.engine.count;i++){const r=e[i];r.x-=r.dx,r.y-=r.dy,r.x+r.size<0?r.dx*=-1:r.y+r.size<0&&(r.dy*=-1),r.x>this.engine.width?r.dx*=-1:r.y>this.engine.height&&(r.dy*=-1),this.engine.type==="stroke"&&t.strokeArc(r.x,r.y,r.size,0,Math.PI*2),this.engine.type==="fill"&&(t.setColor("#ffffff"),t.fillArc(r.x,r.y,r.size,0,Math.PI*2,!1),t.setColor("#000000"),t.strokeArc(r.x,r.y,r.size,0,Math.PI*2,!1))}this.engine.fpsmeter.tick()}}class dp extends Ha{constructor(){super()}init(){if(super.init(),this.canvas.innerHTML="",window.cancelAnimationFrame(this.request),T.world)T.world.reset();else{const t=document.querySelector("main");t.removeChild(t.lastElementChild),Es.init(this.width,this.height,{parent:"main",renderer:Es.AUTO,preferWebGL1:!1,subPixel:!1})}}render(){T.world.addChild(new fp(this))}}document.addEventListener("DOMContentLoaded",()=>{new dp().render()});
